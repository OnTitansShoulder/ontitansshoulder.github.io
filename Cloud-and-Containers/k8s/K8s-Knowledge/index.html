<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We are all standing on the shoulders of the giants..."><meta name=author content="Zhongkai Liu"><link rel="shortcut icon" href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.6"><title>K8s Knowledge - Ontitansshoulder</title><link rel=stylesheet href=../../../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.39b8e14a.min.css><meta name=theme-color content=#4051b5><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#breif-kubernetes-overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title=Ontitansshoulder class="md-header-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Ontitansshoulder </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> K8s Knowledge </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class="md-tabs__link md-tabs__link--active"> Notes </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Ontitansshoulder class="md-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Ontitansshoulder </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1 checked> <label class=md-nav__link for=nav-1> Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Notes data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Welcome </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <label class=md-nav__link for=nav-1-2> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Foundamental/Data_Structures_and_Algos/ class=md-nav__link> Data Structures and Algos </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-1 type=checkbox id=nav-1-3-1> <label class=md-nav__link for=nav-1-3-1> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=3> <label class=md-nav__title for=nav-1-3-1> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation/ class=md-nav__link> Linux Foundation </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_System_Admin/ class=md-nav__link> Linux System Administration </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_Network_Admin/ class=md-nav__link> Linux Network Administration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-2 type=checkbox id=nav-1-3-2> <label class=md-nav__link for=nav-1-3-2> Practical References <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Practical References" data-md-level=3> <label class=md-nav__title for=nav-1-3-2> <span class="md-nav__icon md-icon"></span> Practical References </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Commands/Freq-Used-Shell-Cmds/ class=md-nav__link> Freq Used Shell Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Networking-Shell-Cmds/ class=md-nav__link> Freq Used Network Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Text-Manipulating-Cmds/ class=md-nav__link> Text Manipulating Cmds </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-3 type=checkbox id=nav-1-3-3> <label class=md-nav__link for=nav-1-3-3> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=3> <label class=md-nav__title for=nav-1-3-3> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/References/Freq-Tasks/ class=md-nav__link> Freq Linux Tasks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Terminal-Tricks/ class=md-nav__link> Linux Terminal Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Vim-Tricks/ class=md-nav__link> Vim Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Account-Administration/ class=md-nav__link> Manage Accounts & Groups </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-4 type=checkbox id=nav-1-4 checked> <label class=md-nav__link for=nav-1-4> Cloud <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Cloud data-md-level=2> <label class=md-nav__title for=nav-1-4> <span class="md-nav__icon md-icon"></span> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Architecture/Cloud-App-Architecture/ class=md-nav__link> Cloud App Architecture </a> </li> <li class=md-nav__item> <a href=../../Docker/Docker/ class=md-nav__link> Docker and Containers </a> </li> <li class=md-nav__item> <a href=../../Docker/Docker-Practical/ class=md-nav__link> Docker Practical </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> K8s Knowledge <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> K8s Knowledge </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#breif-kubernetes-overview class=md-nav__link> Breif Kubernetes Overview </a> </li> <li class=md-nav__item> <a href=#kubernetes-components class=md-nav__link> Kubernetes Components </a> <nav class=md-nav aria-label="Kubernetes Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#control-plane-components class=md-nav__link> Control Plane Components </a> <nav class=md-nav aria-label="Control Plane Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kube-apiserver class=md-nav__link> kube-apiserver </a> </li> <li class=md-nav__item> <a href=#etcd class=md-nav__link> etcd </a> </li> <li class=md-nav__item> <a href=#kube-scheduler class=md-nav__link> kube-scheduler </a> </li> <li class=md-nav__item> <a href=#kube-controller-manager class=md-nav__link> kube-controller-manager </a> </li> <li class=md-nav__item> <a href=#cloud-controller-manager class=md-nav__link> cloud-controller-manager </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-components class=md-nav__link> Node Components </a> <nav class=md-nav aria-label="Node Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubelet class=md-nav__link> kubelet </a> </li> <li class=md-nav__item> <a href=#kube-proxy class=md-nav__link> kube-proxy </a> </li> <li class=md-nav__item> <a href=#container-runtime class=md-nav__link> container runtime </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addons class=md-nav__link> Addons </a> <nav class=md-nav aria-label=Addons> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-dns class=md-nav__link> Cluster DNS </a> </li> <li class=md-nav__item> <a href=#web-ui-dashboard class=md-nav__link> Web UI Dashboard </a> </li> <li class=md-nav__item> <a href=#container-resource-monitoring class=md-nav__link> Container Resource Monitoring </a> </li> <li class=md-nav__item> <a href=#cluster-level-logging class=md-nav__link> Cluster-level logging </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-kubernetes-api class=md-nav__link> The Kubernetes API </a> </li> <li class=md-nav__item> <a href=#kubernetes-objects class=md-nav__link> Kubernetes Objects </a> <nav class=md-nav aria-label="Kubernetes Objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#namespaces class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=#labels-and-selectors class=md-nav__link> Labels and Selectors </a> </li> <li class=md-nav__item> <a href=#annotations class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=#field-selectors class=md-nav__link> Field Selectors </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-architecture class=md-nav__link> Cluster Architecture </a> <nav class=md-nav aria-label="Cluster Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nodes class=md-nav__link> Nodes </a> </li> <li class=md-nav__item> <a href=#control-plane-node-communication class=md-nav__link> Control Plane &lt;--&gt; Node Communication </a> </li> <li class=md-nav__item> <a href=#controllers class=md-nav__link> Controllers </a> </li> <li class=md-nav__item> <a href=#cloud-controller-manager_1 class=md-nav__link> Cloud Controller Manager </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#containers class=md-nav__link> Containers </a> <nav class=md-nav aria-label=Containers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#images class=md-nav__link> Images </a> </li> <li class=md-nav__item> <a href=#container-environment class=md-nav__link> Container Environment </a> </li> <li class=md-nav__item> <a href=#runtime-class class=md-nav__link> Runtime Class </a> </li> <li class=md-nav__item> <a href=#container-lifecycle-hooks class=md-nav__link> Container Lifecycle Hooks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workloads class=md-nav__link> Workloads </a> <nav class=md-nav aria-label=Workloads> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pods class=md-nav__link> Pods </a> <nav class=md-nav aria-label=Pods> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#pod-lifecycle class=md-nav__link> Pod lifecycle </a> </li> <li class=md-nav__item> <a href=#probe class=md-nav__link> Probe </a> </li> <li class=md-nav__item> <a href=#initcontainers class=md-nav__link> initContainers </a> </li> <li class=md-nav__item> <a href=#pod-disruptions class=md-nav__link> Pod Disruptions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployments class=md-nav__link> Deployments </a> <nav class=md-nav aria-label=Deployments> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_1 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#rollingupdate-vs-recreate class=md-nav__link> RollingUpdate vs. Recreate </a> </li> <li class=md-nav__item> <a href=#deployment-statuses class=md-nav__link> Deployment statuses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replicaset class=md-nav__link> ReplicaSet </a> <nav class=md-nav aria-label=ReplicaSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#replicaset-and-its-links-with-pods class=md-nav__link> ReplicaSet and its Links with Pods </a> </li> <li class=md-nav__item> <a href=#schema-reference_2 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#replicaset-as-a-horizontal-pod-autoscaler-hpa-target class=md-nav__link> ReplicaSet as a Horizontal Pod Autoscaler (HPA) Target </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#statefulsets class=md-nav__link> StatefulSets </a> <nav class=md-nav aria-label=StatefulSets> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitationsbehaviors class=md-nav__link> Limitations/Behaviors </a> </li> <li class=md-nav__item> <a href=#schema-reference_3 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#statefulset-pods class=md-nav__link> StatefulSet Pods </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> Scaling </a> </li> <li class=md-nav__item> <a href=#parallel-pod-management class=md-nav__link> Parallel Pod Management </a> </li> <li class=md-nav__item> <a href=#update-strategies class=md-nav__link> Update Strategies </a> <nav class=md-nav aria-label="Update Strategies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ondelete class=md-nav__link> OnDelete </a> </li> <li class=md-nav__item> <a href=#rollingupdate class=md-nav__link> RollingUpdate </a> </li> <li class=md-nav__item> <a href=#partitions class=md-nav__link> Partitions </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#daemonset class=md-nav__link> DaemonSet </a> <nav class=md-nav aria-label=DaemonSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_4 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jobs class=md-nav__link> Jobs </a> <nav class=md-nav aria-label=Jobs> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parallel-executions class=md-nav__link> Parallel executions </a> </li> <li class=md-nav__item> <a href=#schema-reference_5 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#job-termination class=md-nav__link> Job termination </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cronjob class=md-nav__link> CronJob </a> <nav class=md-nav aria-label=CronJob> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_6 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#cronjob-limitations class=md-nav__link> CronJob limitations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replicationcontroller class=md-nav__link> ReplicationController </a> <nav class=md-nav aria-label=ReplicationController> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_7 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#garbage-collector class=md-nav__link> Garbage Collector </a> <nav class=md-nav aria-label="Garbage Collector"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ownership class=md-nav__link> Ownership </a> </li> <li class=md-nav__item> <a href=#schema-reference_8 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#cascading-deletion class=md-nav__link> Cascading Deletion </a> <nav class=md-nav aria-label="Cascading Deletion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#foreground class=md-nav__link> Foreground </a> </li> <li class=md-nav__item> <a href=#background class=md-nav__link> Background </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schema-reference_9 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ttl-controller class=md-nav__link> TTL Controller </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#services-lb-networking class=md-nav__link> Services, LB, Networking </a> <nav class=md-nav aria-label="Services, LB, Networking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service class=md-nav__link> Service </a> <nav class=md-nav aria-label=Service> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_10 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#servicetype class=md-nav__link> ServiceType </a> </li> <li class=md-nav__item> <a href=#application-protocol class=md-nav__link> Application protocol </a> </li> <li class=md-nav__item> <a href=#virtual-ips-and-proxies class=md-nav__link> Virtual IPs and proxies </a> <nav class=md-nav aria-label="Virtual IPs and proxies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#user-space-mode class=md-nav__link> User space mode </a> </li> <li class=md-nav__item> <a href=#iptables-mode class=md-nav__link> iptables mode </a> </li> <li class=md-nav__item> <a href=#ipvs-mode class=md-nav__link> IPVS mode </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#discovering-services class=md-nav__link> Discovering services </a> <nav class=md-nav aria-label="Discovering services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#env-vars class=md-nav__link> Env Vars </a> </li> <li class=md-nav__item> <a href=#dns class=md-nav__link> DNS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#headless-services class=md-nav__link> Headless Services </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-topology class=md-nav__link> Service Topology </a> <nav class=md-nav aria-label="Service Topology"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#yaml-reference class=md-nav__link> YAML Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kubernetes-dns class=md-nav__link> Kubernetes DNS </a> <nav class=md-nav aria-label="Kubernetes DNS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-services class=md-nav__link> for Services </a> <nav class=md-nav aria-label="for Services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#srv-records class=md-nav__link> SRV records </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#for-pods class=md-nav__link> for Pods </a> <nav class=md-nav aria-label="for Pods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aaaaa-records class=md-nav__link> A/AAAA records </a> </li> <li class=md-nav__item> <a href=#hostnmae-and-subdomain class=md-nav__link> hostnmae and subdomain </a> </li> <li class=md-nav__item> <a href=#sethostnameasfqdn class=md-nav__link> setHostnameAsFQDN </a> </li> <li class=md-nav__item> <a href=#dns-policy class=md-nav__link> DNS Policy </a> </li> <li class=md-nav__item> <a href=#dns-config class=md-nav__link> DNS Config </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#endpointslices class=md-nav__link> EndpointSlices </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../service_mesh/ class=md-nav__link> Service Mesh </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5 type=checkbox id=nav-1-5> <label class=md-nav__link for=nav-1-5> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=nav-1-5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5-1 type=checkbox id=nav-1-5-1> <label class=md-nav__link for=nav-1-5-1> Splunk <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Splunk data-md-level=3> <label class=md-nav__title for=nav-1-5-1> <span class="md-nav__icon md-icon"></span> Splunk </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-References/ class=md-nav__link> Splunk Knowledge </a> </li> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-Dashboarding/ class=md-nav__link> Splunk Dashboarding </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6 type=checkbox id=nav-1-6> <label class=md-nav__link for=nav-1-6> Programming Langs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Programming Langs" data-md-level=2> <label class=md-nav__title for=nav-1-6> <span class="md-nav__icon md-icon"></span> Programming Langs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-1 type=checkbox id=nav-1-6-1> <label class=md-nav__link for=nav-1-6-1> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-1-6-1> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Golang-Specs/ class=md-nav__link> Golang Language Reference </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Best-Practices/ class=md-nav__link> Effective Go </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Freq-Used-Libs/ class=md-nav__link> Go libraries and examples </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-2 type=checkbox id=nav-1-6-2> <label class=md-nav__link for=nav-1-6-2> Java <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Java data-md-level=3> <label class=md-nav__title for=nav-1-6-2> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Style-Guide/ class=md-nav__link> Style Guide </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Best-Practices/ class=md-nav__link> Effective Java </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Design-Patterns/ class=md-nav__link> Java Design Patterns </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Testing-Design-Patterns/ class=md-nav__link> Testing Design Patterns </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Java_Std_Lib_Cheatsheet/ class=md-nav__link> Java Std Lib Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-3 type=checkbox id=nav-1-6-3> <label class=md-nav__link for=nav-1-6-3> C++ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=C++ data-md-level=3> <label class=md-nav__title for=nav-1-6-3> <span class="md-nav__icon md-icon"></span> C++ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/CPP/CPlusPlus_Lang_Specs/ class=md-nav__link> C++ Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-4 type=checkbox id=nav-1-6-4> <label class=md-nav__link for=nav-1-6-4> Perl <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Perl data-md-level=3> <label class=md-nav__title for=nav-1-6-4> <span class="md-nav__icon md-icon"></span> Perl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Perl/Perl-Lang-Specs/ class=md-nav__link> Perl Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-5 type=checkbox id=nav-1-6-5> <label class=md-nav__link for=nav-1-6-5> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shell data-md-level=3> <label class=md-nav__title for=nav-1-6-5> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Shell/Shell-Scripting/ class=md-nav__link> Shell Scripting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Github-Markdown/ class=md-nav__link> Github Markdown Guide </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Regex-Specs/ class=md-nav__link> Regex Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-7 type=checkbox id=nav-1-7> <label class=md-nav__link for=nav-1-7> Reading Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reading Notes" data-md-level=2> <label class=md-nav__title for=nav-1-7> <span class="md-nav__icon md-icon"></span> Reading Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Reading-Notes/How-Netflix-Works/ class=md-nav__link> How Netflix Works </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/System-Design-Concepts/ class=md-nav__link> System Design Guide </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Why-Latency-Matters/ class=md-nav__link> Why Latency Matters </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/DevOps_SRE/ class=md-nav__link> Intro to DevOps and SRE </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Leading-without-formal-authority/ class=md-nav__link> Leading Without Formal Authority </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Google-SRE-Book/ class=md-nav__link> Google SRE Book </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Good-Reads/ class=md-nav__link> Good Reads </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#breif-kubernetes-overview class=md-nav__link> Breif Kubernetes Overview </a> </li> <li class=md-nav__item> <a href=#kubernetes-components class=md-nav__link> Kubernetes Components </a> <nav class=md-nav aria-label="Kubernetes Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#control-plane-components class=md-nav__link> Control Plane Components </a> <nav class=md-nav aria-label="Control Plane Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kube-apiserver class=md-nav__link> kube-apiserver </a> </li> <li class=md-nav__item> <a href=#etcd class=md-nav__link> etcd </a> </li> <li class=md-nav__item> <a href=#kube-scheduler class=md-nav__link> kube-scheduler </a> </li> <li class=md-nav__item> <a href=#kube-controller-manager class=md-nav__link> kube-controller-manager </a> </li> <li class=md-nav__item> <a href=#cloud-controller-manager class=md-nav__link> cloud-controller-manager </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-components class=md-nav__link> Node Components </a> <nav class=md-nav aria-label="Node Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubelet class=md-nav__link> kubelet </a> </li> <li class=md-nav__item> <a href=#kube-proxy class=md-nav__link> kube-proxy </a> </li> <li class=md-nav__item> <a href=#container-runtime class=md-nav__link> container runtime </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addons class=md-nav__link> Addons </a> <nav class=md-nav aria-label=Addons> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-dns class=md-nav__link> Cluster DNS </a> </li> <li class=md-nav__item> <a href=#web-ui-dashboard class=md-nav__link> Web UI Dashboard </a> </li> <li class=md-nav__item> <a href=#container-resource-monitoring class=md-nav__link> Container Resource Monitoring </a> </li> <li class=md-nav__item> <a href=#cluster-level-logging class=md-nav__link> Cluster-level logging </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-kubernetes-api class=md-nav__link> The Kubernetes API </a> </li> <li class=md-nav__item> <a href=#kubernetes-objects class=md-nav__link> Kubernetes Objects </a> <nav class=md-nav aria-label="Kubernetes Objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#namespaces class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=#labels-and-selectors class=md-nav__link> Labels and Selectors </a> </li> <li class=md-nav__item> <a href=#annotations class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=#field-selectors class=md-nav__link> Field Selectors </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-architecture class=md-nav__link> Cluster Architecture </a> <nav class=md-nav aria-label="Cluster Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nodes class=md-nav__link> Nodes </a> </li> <li class=md-nav__item> <a href=#control-plane-node-communication class=md-nav__link> Control Plane &lt;--&gt; Node Communication </a> </li> <li class=md-nav__item> <a href=#controllers class=md-nav__link> Controllers </a> </li> <li class=md-nav__item> <a href=#cloud-controller-manager_1 class=md-nav__link> Cloud Controller Manager </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#containers class=md-nav__link> Containers </a> <nav class=md-nav aria-label=Containers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#images class=md-nav__link> Images </a> </li> <li class=md-nav__item> <a href=#container-environment class=md-nav__link> Container Environment </a> </li> <li class=md-nav__item> <a href=#runtime-class class=md-nav__link> Runtime Class </a> </li> <li class=md-nav__item> <a href=#container-lifecycle-hooks class=md-nav__link> Container Lifecycle Hooks </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workloads class=md-nav__link> Workloads </a> <nav class=md-nav aria-label=Workloads> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pods class=md-nav__link> Pods </a> <nav class=md-nav aria-label=Pods> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#pod-lifecycle class=md-nav__link> Pod lifecycle </a> </li> <li class=md-nav__item> <a href=#probe class=md-nav__link> Probe </a> </li> <li class=md-nav__item> <a href=#initcontainers class=md-nav__link> initContainers </a> </li> <li class=md-nav__item> <a href=#pod-disruptions class=md-nav__link> Pod Disruptions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployments class=md-nav__link> Deployments </a> <nav class=md-nav aria-label=Deployments> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_1 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#rollingupdate-vs-recreate class=md-nav__link> RollingUpdate vs. Recreate </a> </li> <li class=md-nav__item> <a href=#deployment-statuses class=md-nav__link> Deployment statuses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replicaset class=md-nav__link> ReplicaSet </a> <nav class=md-nav aria-label=ReplicaSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#replicaset-and-its-links-with-pods class=md-nav__link> ReplicaSet and its Links with Pods </a> </li> <li class=md-nav__item> <a href=#schema-reference_2 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#replicaset-as-a-horizontal-pod-autoscaler-hpa-target class=md-nav__link> ReplicaSet as a Horizontal Pod Autoscaler (HPA) Target </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#statefulsets class=md-nav__link> StatefulSets </a> <nav class=md-nav aria-label=StatefulSets> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitationsbehaviors class=md-nav__link> Limitations/Behaviors </a> </li> <li class=md-nav__item> <a href=#schema-reference_3 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#statefulset-pods class=md-nav__link> StatefulSet Pods </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> Scaling </a> </li> <li class=md-nav__item> <a href=#parallel-pod-management class=md-nav__link> Parallel Pod Management </a> </li> <li class=md-nav__item> <a href=#update-strategies class=md-nav__link> Update Strategies </a> <nav class=md-nav aria-label="Update Strategies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ondelete class=md-nav__link> OnDelete </a> </li> <li class=md-nav__item> <a href=#rollingupdate class=md-nav__link> RollingUpdate </a> </li> <li class=md-nav__item> <a href=#partitions class=md-nav__link> Partitions </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#daemonset class=md-nav__link> DaemonSet </a> <nav class=md-nav aria-label=DaemonSet> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_4 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jobs class=md-nav__link> Jobs </a> <nav class=md-nav aria-label=Jobs> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parallel-executions class=md-nav__link> Parallel executions </a> </li> <li class=md-nav__item> <a href=#schema-reference_5 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#job-termination class=md-nav__link> Job termination </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cronjob class=md-nav__link> CronJob </a> <nav class=md-nav aria-label=CronJob> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_6 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#cronjob-limitations class=md-nav__link> CronJob limitations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replicationcontroller class=md-nav__link> ReplicationController </a> <nav class=md-nav aria-label=ReplicationController> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_7 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#garbage-collector class=md-nav__link> Garbage Collector </a> <nav class=md-nav aria-label="Garbage Collector"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ownership class=md-nav__link> Ownership </a> </li> <li class=md-nav__item> <a href=#schema-reference_8 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#cascading-deletion class=md-nav__link> Cascading Deletion </a> <nav class=md-nav aria-label="Cascading Deletion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#foreground class=md-nav__link> Foreground </a> </li> <li class=md-nav__item> <a href=#background class=md-nav__link> Background </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#schema-reference_9 class=md-nav__link> Schema Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ttl-controller class=md-nav__link> TTL Controller </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#services-lb-networking class=md-nav__link> Services, LB, Networking </a> <nav class=md-nav aria-label="Services, LB, Networking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service class=md-nav__link> Service </a> <nav class=md-nav aria-label=Service> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-reference_10 class=md-nav__link> Schema Reference </a> </li> <li class=md-nav__item> <a href=#servicetype class=md-nav__link> ServiceType </a> </li> <li class=md-nav__item> <a href=#application-protocol class=md-nav__link> Application protocol </a> </li> <li class=md-nav__item> <a href=#virtual-ips-and-proxies class=md-nav__link> Virtual IPs and proxies </a> <nav class=md-nav aria-label="Virtual IPs and proxies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#user-space-mode class=md-nav__link> User space mode </a> </li> <li class=md-nav__item> <a href=#iptables-mode class=md-nav__link> iptables mode </a> </li> <li class=md-nav__item> <a href=#ipvs-mode class=md-nav__link> IPVS mode </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#discovering-services class=md-nav__link> Discovering services </a> <nav class=md-nav aria-label="Discovering services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#env-vars class=md-nav__link> Env Vars </a> </li> <li class=md-nav__item> <a href=#dns class=md-nav__link> DNS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#headless-services class=md-nav__link> Headless Services </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-topology class=md-nav__link> Service Topology </a> <nav class=md-nav aria-label="Service Topology"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#yaml-reference class=md-nav__link> YAML Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kubernetes-dns class=md-nav__link> Kubernetes DNS </a> <nav class=md-nav aria-label="Kubernetes DNS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-services class=md-nav__link> for Services </a> <nav class=md-nav aria-label="for Services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#srv-records class=md-nav__link> SRV records </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#for-pods class=md-nav__link> for Pods </a> <nav class=md-nav aria-label="for Pods"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aaaaa-records class=md-nav__link> A/AAAA records </a> </li> <li class=md-nav__item> <a href=#hostnmae-and-subdomain class=md-nav__link> hostnmae and subdomain </a> </li> <li class=md-nav__item> <a href=#sethostnameasfqdn class=md-nav__link> setHostnameAsFQDN </a> </li> <li class=md-nav__item> <a href=#dns-policy class=md-nav__link> DNS Policy </a> </li> <li class=md-nav__item> <a href=#dns-config class=md-nav__link> DNS Config </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#endpointslices class=md-nav__link> EndpointSlices </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>K8s Knowledge</h1> <p>This set of notes is taken straight from <a href=https://kubernetes.io target=_blank>kubernetes.io</a></p> <h2 id=breif-kubernetes-overview>Breif Kubernetes Overview<a class=headerlink href=#breif-kubernetes-overview title="Permanent link">&para;</a></h2> <p><strong>Kubernetes</strong> is a portable, extensible, open-source platform for managing <strong>containerized</strong> workloads and services, that facilitates both declarative configuration and automation.</p> <p>k8s provides:</p> <ul> <li><strong>Service discovery and load balancing</strong><ul> <li>expose a container using DNS name or IP address</li> <li>balance loads among many instances of a service</li> </ul> </li> <li><strong>Storage orchestration</strong><ul> <li>mount storage from local or other cloud providers</li> </ul> </li> <li><strong>Automated rollouts and rollbacks</strong><ul> <li>describe desired state of containers and have k8s monitor it</li> </ul> </li> <li><strong>Automatic bin packing</strong><ul> <li>k8s can make the best use of resources by fitting containers among the nodes</li> </ul> </li> <li><strong>Self-healing</strong><ul> <li>k8s manages the avaibility, restart, replacement, and termination of containers</li> </ul> </li> <li><strong>Secret and configuration management</strong><ul> <li>k8s manages and stores sensitive info</li> </ul> </li> </ul> <p>k8s is not a traditional Platform as a Service system.</p> <p><img src=https://d33wubrfki0l68.cloudfront.net/26a177ede4d7b032362289c6fccd448fc4a91174/eb693/images/docs/container_evolution.svg alt="Deployment evolution"></p> <h2 id=kubernetes-components>Kubernetes Components<a class=headerlink href=#kubernetes-components title="Permanent link">&para;</a></h2> <p>When you deploy Kubernetes, you get a <strong>cluster</strong>. At an enterprise grade k8s deployment, there would be multiple clusters for <em>fault-tolerance</em> and <em>high availablility</em>.</p> <p>These components exist within a cluster:</p> <ul> <li><strong>nodes</strong> - a number of worker machines</li> <li><strong>control plane</strong> - a set of programs that together manages the nodes and the Pods<ul> <li>may span across multiple physical machines</li> <li>consists of: kube-apiserver, etcd, kube-scheduler, kube-controller-manager, cloud-controller-manager</li> </ul> </li> </ul> <p><img src=https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg alt="Components of Kubernetes"></p> <h3 id=control-plane-components>Control Plane Components<a class=headerlink href=#control-plane-components title="Permanent link">&para;</a></h3> <p>The control plane's components can be run on <em>any machine</em> in the cluster and they make <strong>global decisions</strong> about the cluster as well as detecting and responding to <strong>cluster events</strong>.</p> <p>See <a href=https://kubernetes.io/docs/admin/high-availability/ target=_blank>Building High-Availability Clusters</a> for an example multi-master-VM setup.</p> <h4 id=kube-apiserver>kube-apiserver<a class=headerlink href=#kube-apiserver title="Permanent link">&para;</a></h4> <p>The apiserver is the front end for the k8s control plane and it is designed to scale horizontally. Multiple <code>kube-apiserver</code> can be deployed to balance traffic.</p> <p><code>kube-apiserver</code> serves <strong>REST http requests</strong> which can be consumed from apps built by any languages. <code>kubectl</code> and <code>kubeadm</code> also consumes this API.</p> <p>List of <a href=https://kubernetes.io/docs/reference/using-api/client-libraries/ target=_blank>client libraries</a> for consuming k8s API.</p> <p>Full <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/ target=_blank>k8s API reference</a> is available, but it is better to use the client libraries.</p> <h4 id=etcd>etcd<a class=headerlink href=#etcd title="Permanent link">&para;</a></h4> <p><code>etcd</code> provides a <em>consistent</em> and <em>highly-available</em> <strong>key value store</strong> for <strong>all cluster data</strong>.</p> <p>K8s allows you to use alternative key-value store for the cluster data. Be sure to have <a href=https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster target=_blank>back up plan</a> for the data no matter which store you use.</p> <p><a href=https://etcd.io/docs/ target=_blank>etcd official documentation</a></p> <h4 id=kube-scheduler>kube-scheduler<a class=headerlink href=#kube-scheduler title="Permanent link">&para;</a></h4> <p><code>kube-scheduler</code> watches for newly created Pods with no assigned node and selects a node for them to run on. Some <strong>decision-making factors</strong>:</p> <ul> <li>collective resource requirements</li> <li>hardware/software/policy constraints</li> <li>affinity and anti-affinity specs</li> <li>data locality</li> <li>inter-workload interference</li> <li>deadlines</li> </ul> <h4 id=kube-controller-manager>kube-controller-manager<a class=headerlink href=#kube-controller-manager title="Permanent link">&para;</a></h4> <p><code>kube-controller-manager</code> runs controller processes, combined in a single binary.</p> <ul> <li><strong>Node controller</strong> - notices and reports when nodes go down</li> <li><strong>Replication controller</strong> - maintains the correct number of pods for every replication controller object</li> <li><strong>Endpoints controller</strong> - populates the endpoints object (joins Services &amp; Pods)</li> <li><strong>Service Account &amp; Token controller</strong> - creates default accounts and API access tokens for new namespaces</li> </ul> <h4 id=cloud-controller-manager>cloud-controller-manager<a class=headerlink href=#cloud-controller-manager title="Permanent link">&para;</a></h4> <p><code>cloud-controller-manager</code> has cloud-specific control logic. Lets you link your cluster into your external cloud provider's API.</p> <p>Only runs controllers that are specific to your cloud provider.</p> <h3 id=node-components>Node Components<a class=headerlink href=#node-components title="Permanent link">&para;</a></h3> <p>Node components run on <strong>every node</strong>, <strong>maintaining running pods</strong> and providing the Kubernetes runtime environment.</p> <h4 id=kubelet>kubelet<a class=headerlink href=#kubelet title="Permanent link">&para;</a></h4> <p><code>kubelet</code> makes sure containers are running healthy in a Pod described by the <strong>PodSpecs</strong>. It doesn't manage containers that were not create by Kubernetes.</p> <h4 id=kube-proxy>kube-proxy<a class=headerlink href=#kube-proxy title="Permanent link">&para;</a></h4> <p><code>kube-proxy</code> is a <strong>network proxy</strong> that maintains network rules, implementing part of the Kubernetes Service concept. It allows <strong>communication</strong> to Pods inside or outside the cluster.</p> <h4 id=container-runtime>container runtime<a class=headerlink href=#container-runtime title="Permanent link">&para;</a></h4> <p><code>container runtime</code> is the software responsible for running containers. Typically are one of: <strong>Docker, containerd, CRI-O</strong>, or any that implements <strong>Kubernetes CRI</strong> (Container Runtime Interface)</p> <h3 id=addons>Addons<a class=headerlink href=#addons title="Permanent link">&para;</a></h3> <p>Addons use Kubernetes resources to implement <strong>cluster features</strong>.</p> <h4 id=cluster-dns>Cluster DNS<a class=headerlink href=#cluster-dns title="Permanent link">&para;</a></h4> <p>A DNS server that <strong>serves DNS records</strong> for Kubernetes services. Containers started by Kubernetes automatically include this DNS server.</p> <h4 id=web-ui-dashboard>Web UI Dashboard<a class=headerlink href=#web-ui-dashboard title="Permanent link">&para;</a></h4> <p>The general web UI for clusters allow <strong>manage and troubleshoot applications</strong> running in the cluster.</p> <h4 id=container-resource-monitoring>Container Resource Monitoring<a class=headerlink href=#container-resource-monitoring title="Permanent link">&para;</a></h4> <p>Records generic time-series <strong>metrics about containers</strong>.</p> <h4 id=cluster-level-logging>Cluster-level logging<a class=headerlink href=#cluster-level-logging title="Permanent link">&para;</a></h4> <p>Saving <strong>container logs</strong> to a central log store with search/browsing interface.</p> <h2 id=the-kubernetes-api>The Kubernetes API<a class=headerlink href=#the-kubernetes-api title="Permanent link">&para;</a></h2> <p>The control plane is the apiserver and it exposes a HTTP API for querying and manipulating the state of objects in Kubernetes.</p> <p>Tools like kubectl and kubeadm use this API. You can also consume it with REST calls. Client libraries exist for many languages for consuming the API.</p> <p><strong>Extend Kubernetes API</strong> by adding <code>CustomResourceDefinition</code>.</p> <h2 id=kubernetes-objects>Kubernetes Objects<a class=headerlink href=#kubernetes-objects title="Permanent link">&para;</a></h2> <p>Kubernetes objects are persistent entities to represent <strong>state of your cluster</strong>.</p> <ul> <li>what <strong>applications</strong> are running</li> <li>the <strong>resources</strong> available to the applications</li> <li><strong>policies</strong> around how the applications behave</li> </ul> <p>Kubernetes objects are represented in the Kubernetes API and can be expressed in <code>.yaml</code> format. Kubernetes API consumes the <strong>converted JSON</strong> of the configs specified in the yaml file.</p> <p>Almost every k8s object includes <code>spec</code> and <code>status</code>. <code>spec</code> describes the <strong>desired state</strong> for the resource, and <code>status</code> describes the <strong>current state</strong> of the object. <code>spec</code> is done by you when the resource is first created, and <code>status</code> is updated by k8s. <code>metadata</code> is used to <strong>identify the resource</strong>.</p> <p>Required fields:</p> <ul> <li><strong>apiVersion</strong> - the version of the k8s API used when creating this object</li> <li><strong>kind</strong> - what kind of object</li> <li><strong>metadata</strong> - object identifier, usually a name, UID, and optional namespace<ul> <li>each object has a <strong>unique name</strong> for that <strong>specific type</strong> of resource in <strong>one cluster</strong><ul> <li>for name restriction check <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names target=_blank>here</a></li> </ul> </li> <li>each object has a <strong>unique UID</strong> that is unique across the <strong>whole cluster</strong><ul> <li>generated by k8s</li> </ul> </li> </ul> </li> <li><strong>spec</strong> - desired state for the object<ul> <li>precise spec is different for each k8s object</li> </ul> </li> </ul> <h3 id=namespaces>Namespaces<a class=headerlink href=#namespaces title="Permanent link">&para;</a></h3> <p>Kubernetes supports multiple <strong>virtual clusters</strong> backed by the same physical cluster. These virtual clusters are called <code>namespaces</code>.</p> <p>Namespaces are intended for use in environments with <strong>many users</strong> spread across <strong>multiple teams, or projects</strong>.</p> <p>Namespaces provide a <strong>scope for names</strong>. Names of resources need to be unique within a namespace, but not across namespaces.</p> <p>Namespaces provide a way to <strong>divide cluster resources</strong> between multiple users via <strong>resource quota</strong>.</p> <p>Some resources are in a namespace and some are not. To find out:</p> <div class=highlight><pre><span></span><code><span class=c1># In a namespace</span>
kubectl api-resources --namespaced<span class=o>=</span><span class=nb>true</span>
<span class=c1># Not in a namespace</span>
kubectl api-resources --namespaced<span class=o>=</span><span class=nb>false</span>
</code></pre></div> <h3 id=labels-and-selectors>Labels and Selectors<a class=headerlink href=#labels-and-selectors title="Permanent link">&para;</a></h3> <p><code>labels</code>, under <code>metadata</code>, are key-value pairs that are intended to be used to specify <strong>identifying attributes</strong> of objects that are <strong>meaningful and relevant to users</strong>, but do not directly imply semantics to the core system.</p> <p>Labels can be attached to objects at creation time and added/modified any time and can be used to <strong>organize and to select</strong> subsets of objects.</p> <ul> <li>Labels are made up from an <code>optional prefix</code> and a <code>name</code>, connected by a <code>slash</code>.<ul> <li>labels are <strong>NOT unique</strong> among multiple objects</li> </ul> </li> <li>prefix must be a <strong>DNS subdomain</strong><ul> <li>if prefix is omitted, label key is presumed to be <strong>private to the user</strong></li> <li><strong>automated system components</strong> must specify a prefix</li> </ul> </li> <li>name must be <strong>less or equals to 63 chars length</strong>, starts and ends with <code>alphanumerics</code> and can have <code>dashes, underscores, or dots</code> between.</li> </ul> <p>Using a <code>label selector</code> to identify a set of objects, which is the core grouping primitive in k8s.</p> <ul> <li>A label selector can be made of multiple requirements of <strong>comma-separated string</strong>, for which <em>all</em> must satisify.</li> <li>A label selector requirement can be specified with equality-based operators, <code>=, ==, !=</code><ul> <li>for inequality, resources without the label key (<strong>null</strong>) will also be selected.</li> <li>for objects definitions in JSON or YAML, some <strong>only</strong> support equality requirement selectors and some supports set requirements</li> <li>see https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements</li> </ul> </li> <li>A label selector requirement can also be a <strong>set of values</strong> with operators, <code>in, notin, exists</code><ul> <li>i.e. <code>environment in (prod, qa)</code>, <code>tier notin (fe, be)</code>, <code>partition</code> (only the key for exists), <code>!partition</code> (opposite of exists)</li> </ul> </li> </ul> <p>Common labels</p> <table> <thead> <tr> <th>Key</th> <th>Description</th> <th>Example</th> <th>Type</th> </tr> </thead> <tbody> <tr> <td>app.kubernetes.io/name</td> <td>The name of the application</td> <td>mysql</td> <td>string</td> </tr> <tr> <td>app.kubernetes.io/instance</td> <td>A unique name identifying the instance of an application</td> <td>mysql-abcxzy</td> <td>string</td> </tr> <tr> <td>app.kubernetes.io/version</td> <td>The current version of the application (e.g., a semantic version, revision hash, etc.)</td> <td>5.7.21</td> <td>string</td> </tr> <tr> <td>app.kubernetes.io/component</td> <td>The component within the architecture</td> <td>database</td> <td>string</td> </tr> <tr> <td>app.kubernetes.io/part-of</td> <td>The name of a higher level application this one is part of</td> <td>wordpress</td> <td>string</td> </tr> <tr> <td>app.kubernetes.io/managed-by</td> <td>The tool being used to manage the operation of an application</td> <td>helm</td> <td>string</td> </tr> </tbody> </table> <h3 id=annotations>Annotations<a class=headerlink href=#annotations title="Permanent link">&para;</a></h3> <p><code>annotations</code> are not used to identify and select objects. It serves as <strong>additional information</strong> for the application or for <strong>debugging</strong> purposes.</p> <p>The metadata in an annotation can be small or large, structured or unstructured, and CAN include characters not permitted by labels.</p> <p>The naming restrictions of annotation keys are the SAME as that for label keys.</p> <h3 id=field-selectors>Field Selectors<a class=headerlink href=#field-selectors title="Permanent link">&para;</a></h3> <p><code>field selectors</code> allow selecting resources based on the value of one or more <strong>resource fields</strong>. This is broader than the label selector, but it works <strong>only on API</strong> and can't be specified in the resource itself to select other objects.</p> <p>Supported field selectors vary by the resource type. Using unsupported field selectors produces an error. Operators <code>=, ==, !=</code> can be used; multiple requirements can be combined with a comma. i.e. <code>metadata.name=my-service,status.phase!=Running</code></p> <h2 id=cluster-architecture>Cluster Architecture<a class=headerlink href=#cluster-architecture title="Permanent link">&para;</a></h2> <h3 id=nodes>Nodes<a class=headerlink href=#nodes title="Permanent link">&para;</a></h3> <p>Kubernetes runs workload by placing <strong>containers into Pods</strong> that run on <code>Nodes</code>.</p> <p>A node can be a <strong>virtual or physical</strong> machine. Each node contains services necessary to run Pods which are managed by the <strong>control plane</strong>.</p> <p>A node has components: <strong>kubelet</strong>, a <strong>container runtime</strong>, and the <strong>kube-proxy</strong>.</p> <p>A node can be added to the k8s apiserver either by the kubelet self-register or by a mnaully-created Node resource object, for which the control plane server will validate and healthcheck. The Node object must have a <strong>valid DNS subdomain name</strong>.</p> <p>Node can be marked <strong>unscheduleable</strong> before maintenance or upgrades.</p> <p>The node lifecycle controller automatically creates <strong>taints</strong> that represent <strong>conditions</strong>. The Pod scheduler takes the Node's taints into consideration when assigning a Pod to a Node. Pods can also have <strong>tolerations</strong> which let them tolerate a Node's taints.</p> <p>The node controller is responsible for assigning <strong>Classless Inter-Domain Routing</strong> (CIDR) block to the node when it is registered, keeping the node controller's internal list of nodes up-to-date with the <strong>list of available machines</strong>, and monitoring the <strong>nodes' health</strong>.</p> <p>For <em>reliability</em>, spread your nodes across <strong>availability zones</strong> so that the workload can be shifted to healthy zones when one entire zone goes down.</p> <h3 id=control-plane-node-communication>Control Plane &lt;--&gt; Node Communication<a class=headerlink href=#control-plane-node-communication title="Permanent link">&para;</a></h3> <p>All <strong>API usage</strong> from nodes terminate at the <code>apiserver</code>. The apiserver is configured to listen for remote connections on a secure HTTPS port (typically 443) with one or more forms of client authentication enabled.</p> <p>Nodes should be provisioned with the <strong>public root certificate</strong> for the cluster such that they can connect securely to the apiserver along with valid client credentials.</p> <p>Pods that wish to connect to the apiserver can do so securely by leveraging a <strong>service account</strong> so that Kubernetes will automatically inject the public root certificate and a valid bearer token into the pod when it is instantiated. </p> <p>The kubernetes service (in all namespaces) is configured with a virtual IP address that is <strong>redirected</strong> (via kube-proxy) to the HTTPS endpoint on the apiserver.</p> <p>Control Plane can talk to the nodes from the apiserver to the kubelet process on each node in the cluster, or from the apiserver to <strong>any node, pod, or service</strong> through the apiserver's proxy.</p> <p>Kubernetes supports <strong>SSH tunnels</strong> to protect the control plane to nodes communication paths but it is deprecated. <code>Konnectivity</code> service is the replacement for this communication channel.</p> <h3 id=controllers>Controllers<a class=headerlink href=#controllers title="Permanent link">&para;</a></h3> <p>In Kubernetes, <code>controllers</code> are control loops that <strong>watch the state</strong> of your cluster, then make or request changes where needed. Each controller tries to move the current cluster state closer to the desired state.</p> <p>A controller might handle the action itself or messages the apiserver to do so. Built-in controllers run inside the kube-controller-manager and manage state by interacting with the cluster apiserver.</p> <p>Controllers that interact with external state find their desired state from the apiserver, then communicate directly with an external system to bring the current state closer in line.</p> <p>There can be several controllers that create or update the same kind of object. Behind the scenes, Kubernetes controllers make sure that they only change the resources linked to their controlling resource.</p> <p>You can find controllers that run outside the control plane, to extend Kubernetes. Or, if you want, you can write a new controller yourself. You can run your own controller as a set of Pods, or externally to Kubernetes (via CustomResourceDefinition).</p> <h3 id=cloud-controller-manager_1>Cloud Controller Manager<a class=headerlink href=#cloud-controller-manager_1 title="Permanent link">&para;</a></h3> <p>The <code>cloud-controller-manager</code> is a Kubernetes control plane component that embeds cloud-specific control logic and allow linking your cluster into your cloud provider's API. It works like an <strong>adaptor</strong>.</p> <p>The cloud-controller-manager is structured using a plugin mechanism that allows different cloud providers to integrate their platforms with Kubernetes. The cloud controller manager runs in the control plane as a replicated set of processes and each cloud-controller-manager implements multiple controllers in a single process. It can also run as a k8s addon rather than part of the control plane.</p> <h2 id=containers>Containers<a class=headerlink href=#containers title="Permanent link">&para;</a></h2> <h3 id=images>Images<a class=headerlink href=#images title="Permanent link">&para;</a></h3> <p>A <code>container image</code> is a <strong>ready-to-run software package</strong>, containing everything needed to run an application: the code and any runtime it requires, application and system libraries, and default values for any essential settings. An image makes very well defined assumptions about their runtime environment.</p> <p>You typically create a container image of your application and push it to a <strong>registry</strong> before referring to it in a Pod.</p> <p>An image name can include a registry hostname and an optional port number. If you don't specify a registry hostname, Kubernetes assumes that you mean the Docker public registry. After the image name part you can add a tag to identify different versions of that image. If you don't specify a tag, Kubernetes assumes you mean the tag latest.</p> <p><strong>Avoid using latest</strong> tag when deploying containers in production, as it is harder to track which version of the image is running and more difficult to roll back to a working version. Use a <strong>pinned version</strong> instead.</p> <p>A container registry can also serve a container image index to allow different systems to fetch the right binary image for the <strong>machine architecture</strong> they are using. Kubernetes itself typically names container images with a suffix -$(ARCH).</p> <p>A container is <strong>immutable</strong>: you cannot change the code of a container that is already running. To do so you need to build a new image that includes the change, then recreate the container to start from the updated image.</p> <p>The <code>container runtime</code> is the software that is responsible for running containers. K8s suports Docker, containerd, CRI-O, and any implementation of the Kubernetes CRI.</p> <h3 id=container-environment>Container Environment<a class=headerlink href=#container-environment title="Permanent link">&para;</a></h3> <p>The resources available to containers in the <code>container environment</code>:</p> <ul> <li><strong>filesystem</strong>, a combination of image and volumes</li> <li>information about the <strong>container</strong><ul> <li>i.e. env variables like Pod name and namespace, other user defined env variables and others statically specified in the image</li> </ul> </li> <li>information about other <strong>objects</strong> in the cluster<ul> <li>a list of all services that were running when the container is created, available as env variables<ul> <li>i.e. <code>FOO_SERVICE_HOST</code> and <code>FOO_SERVICE_PORT</code> is available as env variables for a service named <code>foo</code> that maps to that container</li> </ul> </li> </ul> </li> </ul> <h3 id=runtime-class>Runtime Class<a class=headerlink href=#runtime-class title="Permanent link">&para;</a></h3> <p><code>RuntimeClass</code> is a feature for selecting the container runtime configuration, which is used to run a Pod's containers.</p> <p>You can set a different RuntimeClass between different Pods to balance <strong>performance and security</strong>.</p> <p>You can also use RuntimeClass to run different Pods with the same container runtime but with different settings.</p> <h3 id=container-lifecycle-hooks>Container Lifecycle Hooks<a class=headerlink href=#container-lifecycle-hooks title="Permanent link">&para;</a></h3> <p>kubelet managed containers can use the <code>container lifecycle hook</code> framework to run code triggered by events during their management lifecycle.</p> <p>The hooks enable containers to be <strong>aware of events</strong> in their management lifecycle and run code implemented in a <strong>handler</strong> when the corresponding lifecycle hook is executed.</p> <p>Two hooks exposed to containers:</p> <ul> <li><strong>PostStart</strong> - executed immediately after a container is <strong>created</strong></li> <li><strong>PreStop</strong> - called immediately before a container is <strong>terminated</strong> due to an API request or management event such as <strong>liveness probe failure</strong>, <strong>preemption</strong>, <strong>resource contention</strong>, <strong>cordon</strong>, <strong>container exit</strong>, and others.</li> </ul> <p>Containers can access a hook by implementing and registering a handler for that hook.</p> <p>Two types of hook handlers:</p> <ul> <li><strong>exec</strong> - executes a specific <strong>command or script</strong>, such as pre-stop.sh, inside the cgroups and namespaces of the container</li> <li><strong>http</strong> - executes an <strong>HTTP request</strong> against a specific <strong>endpoint on the container</strong></li> </ul> <p>Hook handler calls are <strong>synchronous</strong> within the context of the Pod containing the container. The hook need to finish before the container reach a running state. Users should make their hook handlers <strong>as lightweight as possible</strong>.</p> <p>PostStart or PreStop <strong>hook failures kills the container</strong>. Hook delivery is intended to be at least once and <strong>generally only once</strong>. It doesn't get resend if delivery fails. If a handler fails for some reason, it broadcasts an event, which is viewable by <code>kubectl describe</code>.</p> <h2 id=workloads>Workloads<a class=headerlink href=#workloads title="Permanent link">&para;</a></h2> <p>A <code>workload</code> is an application running on Kubernetes, usually in <strong>a set of Pods</strong>. A Pod represents a set of running containers on your cluster. You can use workload resources that manage a set of Pods on your behalf.</p> <p>Workload resources:</p> <ul> <li><code>Deployment</code> and <code>ReplicaSet</code></li> <li><code>StatefulSet</code></li> <li><code>DaemonSet</code></li> <li><code>Job</code> and <code>CronJob</code></li> </ul> <p>Garbage collection tidies up objects from your cluster after their owning resource has been removed.</p> <p>The time-to-live after finished controller removes Jobs once a defined time has passed since they completed.</p> <p>Once your application is running, you might want to make it available on the internet as a <code>Service</code> or, for web application only, using an <code>Ingress</code>.</p> <h3 id=pods>Pods<a class=headerlink href=#pods title="Permanent link">&para;</a></h3> <p><code>Pods</code> are the smallest deployable units of computing that you can create and manage in Kubernetes.</p> <p>A Pod is a <strong>group</strong> of one or more <strong>containers</strong>, with <strong>shared</strong> storage/network resources, and a specification for how to run the containers. A Pod's contents are always co-located and co-scheduled, and run in a shared context. </p> <p>A Pod models an application-specific "<strong>logical host</strong>": it contains one or more application containers which are relatively <strong>tightly coupled</strong>.</p> <p>A Pod can contain <code>init containers</code> that run during Pod startup. You can also inject ephemeral containers for debugging if your cluster offers this. Init containers run and complete before the app containers are started.</p> <p>The shared context of a Pod is a set of Linux namespaces, cgroups, and potentially other facets of isolation.</p> <p>Pods are generally used to run a single container or run multiple containers that need to work together. For example, one container serving data stored in a shared volume to the public, while a separate <strong>sidecar container</strong> refreshes or updates those files.</p> <p>The containers in a Pod are automatically <strong>co-located and co-scheduled</strong> on the same physical or virtual machine in the cluster. The containers can share resources and dependencies, communicate with one another, and coordinate when and how they are terminated.</p> <p>A Pod is not a process, but an <strong>environment for running container(s)</strong>. A Pod persists until it is deleted.</p> <p>Within a Pod, containers <strong>share an IP address and port space</strong>, and can find each other via localhost. The containers in a Pod can also communicate with each other using <strong>standard inter-process communications</strong> like SystemV semaphores or POSIX shared memory. Containers that want to interact with a container running in a different Pod can use IP networking to communicate.</p> <h4 id=schema-reference>Schema Reference<a class=headerlink href=#schema-reference title="Permanent link">&para;</a></h4> <details class=note open=open><summary>Pod Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pod-example</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>containers</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu:trusty</span>
    <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">]</span>
    <span class=nt>args</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;Hello</span><span class=nv> </span><span class=s>World&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div> </details> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code>kubectl get pods
kubectl get pods --show-labels
kubectl describe pod/&lt;pod&gt;
kubectl <span class=nb>exec</span> -it pod/&lt;pod&gt; -c &lt;container&gt; &lt;command&gt;
kubectl logs pod/&lt;pod&gt; -c &lt;container&gt;
</code></pre></div> </details> <p><code>Static Pods</code> are managed directly by the <strong>kubelet daemon</strong> on a specific node, without the API server observing them. The main use for static Pods is to run a <strong>self-hosted control plane</strong> (or manage its components).</p> <h4 id=pod-lifecycle>Pod lifecycle<a class=headerlink href=#pod-lifecycle title="Permanent link">&para;</a></h4> <p><strong>Pod lifecycle</strong>: starting in the Pending phase, moving through Running if at least one of its primary containers starts OK, and then through either the Succeeded or Failed phases depending on whether any container in the Pod terminated in failure.</p> <p>Pods are considered to be <strong>relatively ephemeral</strong> (rather than durable) entities. Pods do not, by themselves, self-heal. If a Pod is scheduled to a node that then fails, or if the scheduling operation itself fails, the Pod is deleted.</p> <p>A given Pod (as defined by a UID) is never "rescheduled" to a different node; instead, that Pod can be replaced by a new, near-identical Pod, with even the same name if desired, but with a different UID. The same rule applies to the volumes attached to a given Pod.</p> <p>You can use container lifecycle hooks to trigger events to run at certain points in a container's lifecycle.</p> <p>Pod has three states:</p> <ul> <li><strong>Waiting</strong> - a container is running the operations it requires in order to complete start up</li> <li><strong>Running</strong> - a container is executing without issues, and the postStart hook has been executed and finished</li> <li><strong>Terminated</strong> - a container has begun execution and either ran to completion or failed for some reason. The preStop hook is executed and finished before a container enters the Terminated state</li> </ul> <p>A Pod's <code>restartPolicy</code> controls restarts of Terminated containers.</p> <p>A Pod has <code>PodStatus</code>, which contains an array of PodConditions which the Pod has/hasn't passed:</p> <ul> <li><strong>PodScheduled</strong> - the Pod has been scheduled to a node</li> <li><strong>ContainersReady</strong> - all containers in the Pod are ready</li> <li><strong>Initialized</strong> - all init containers have started successfully</li> <li><strong>Ready</strong> - the Pod is able to serve requests and should be added to the load balancing pools of all matching Services</li> </ul> <h4 id=probe>Probe<a class=headerlink href=#probe title="Permanent link">&para;</a></h4> <p>A <code>Probe</code> is a diagnostic performed periodically by the kubelet on a container. To perform a diagnostic, the kubelet calls a Handler implemented by the container. There are three types of handlers:</p> <ul> <li><strong>ExecAction</strong> - Executes a specified command or script inside the container and expects it exits with 0</li> <li><strong>TCPSocketAction</strong> - Performs a TCP check against the Pod's IP address on a specified port and expects the port to be open</li> <li><strong>HTTPGetAction</strong> - Performs an HTTP GET request against the Pod's IP address on a specified port and path and expect response status code, x, to be <code>200 &lt;= x &lt; 400</code></li> </ul> <p>The kubelet can optionally perform and react to three kinds of probes on running containers:</p> <ul> <li><strong>livenessProbe</strong> - whether the container is <strong>running</strong>. kubelet kills the container according to its restart policy if the probe fails</li> <li><strong>readinessProbe</strong> - whether the container is <strong>ready to respond to requests</strong>.The endpoints controller removes the Pod's IP from the Services that match the Pod, if the probe fails.</li> <li><strong>startupProbe</strong> - whether the application within the container is started. Other probes are disabled until this probe succeeds. kubelet kills the container according to its restart policy if the probe fails</li> </ul> <p>Pods represent processes running on nodes in the cluster, it is important to allow those processes to gracefully terminate when they are no longer needed. The container runtime sends a <strong>TERM signal to the main process</strong> (PID=1) in each container. Once the <code>PodTerminationGracePeriod</code> has expired, the KILL signal is sent to <strong>any remaining processes</strong>, and the Pod is then deleted from the API Server.</p> <p>If the <strong>order</strong> of shutting down the containers within a Pod matters, consider using the preStop hook to <strong>synchronize</strong>.</p> <h4 id=initcontainers>initContainers<a class=headerlink href=#initcontainers title="Permanent link">&para;</a></h4> <p><code>initContainers</code> can contain utilities or setup scripts not present in an app image, which are run before the app containers are started. They always <strong>run to completion</strong> and must complete <strong>sequentially</strong> and successfully before next one starts. If one fails, the kubelet repeatedly restarts that init container until it succeeds unless the restartPolicy is Never, then the Pod fails to start and pending deletion.</p> <p>Init containers offer a mechanism to block or <strong>delay app container startup</strong> until a set of preconditions are met, and can securely run utilities or custom code that would otherwise make an app container image less secure, as they access to Secrets that app containers cannot access.</p> <p>You can use <code>topology spread constraints</code> to control how Pods are spread across your cluster among failure-domains such as regions, zones, nodes, and other user-defined topology domains. This can help to achieve high availability as well as efficient resource utilization.</p> <p>Directives related to "Affinity" control how Pods are scheduled - more packed or more scattered.</p> <p><code>PodPresets</code> are API resource objects for injecting additional runtime information such as secrets, volumes, volume mounts, and environment variables, into pods at creation time. Pod template authors to not have to explicitly provide all information for every pod.</p> <h4 id=pod-disruptions>Pod Disruptions<a class=headerlink href=#pod-disruptions title="Permanent link">&para;</a></h4> <p>Pods do not disappear until someone (a person or a controller) destroys them, or there is an unavoidable hardware or system software error.</p> <p>Unavoidable Pod disruptions are <code>involuntary disruptions</code>. Examples:</p> <ul> <li>hardware failure from physical machine</li> <li>cluster admin deletes VM by mistake</li> <li>cloud provider hypervisor failure causes VM disappear</li> <li>kernel panic</li> <li>node disappears from the cluster due to network partition</li> <li>eviction of Pods due to out-of-resource errors</li> </ul> <p>Other cases are <code>voluntary disruptions</code>. Examples:</p> <ul> <li>deleting a deployment or the controller that manages the Pods</li> <li>updating a deployment's Pod template causing a restart</li> <li>directly deleting a Pod by accident</li> <li>cluster admin drain a node for maintenance</li> <li>removing a Pod from a node to free up resource</li> </ul> <p>To mitigate involuntary disruptions</p> <ul> <li>ensure the Pod requests just enough resources it needs</li> <li>replicate application for higher availability</li> <li>spread applications across racks or across zones</li> </ul> <p>A <code>PodDisruptionBudget(PDB)</code> limits the number of Pods of a replicated application that are down simultaneously from voluntary disruptions. However, deleting deployments or pods bypasses this rule. When a pod is evicted using the eviction API, it is gracefully terminated.</p> <p>As a cluster admin to perform a disruptive action on all the nodes in your cluster, some options:</p> <ul> <li>accept downtime during the upgrade</li> <li>failover to another complete replica cluster, maybe costly</li> <li>write disruption-rolerant applications and use PDBs, can be tricky on the application effort</li> </ul> <p>Ephemeral containers are intended to help troubleshoot a hard-to-reproduce bug through running within a Pod and inspect its state and run arbitrary commands. It is a way to run containers with many limitations and has to be added to a Pod through k8s API.</p> <h3 id=deployments>Deployments<a class=headerlink href=#deployments title="Permanent link">&para;</a></h3> <p>A <code>Deployment</code> provides declarative updates for <code>Pods</code> and <code>ReplicaSets</code>.</p> <p>Creating a new Deployment creates a ReplicaSet, which in turn creates Pods per the <code>PodTemplateSpec</code> of the Deployment. With a Deployment:</p> <ul> <li>Scale up/down the Deployment</li> <li>Rollback the Deployment and apply an earlier ReplicaSet</li> <li>Make changes to PodTemplateSpec and rollout new a RelicaSet</li> </ul> <h4 id=schema-reference_1>Schema Reference<a class=headerlink href=#schema-reference_1 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>Deployment Template</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>         <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>            <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                   <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
  <span class=nt>labels</span><span class=p>:</span>                   <span class=c1># must match spec.template.metadata.labels</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=nt>spec</span><span class=p>:</span>                       <span class=c1># required</span>
  <span class=nt>minReadySeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>            <span class=c1># default 0, time that newly created Pod should be</span>
                                <span class=c1>#   ready without any of its containers crashing</span>
                                <span class=c1>#   for it to be considered available </span>
  <span class=nt>progressDeadlineSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>  <span class=c1># default 600, time to wait for your Deployment to</span>
                                <span class=c1>#   progress before the system reports back that</span>
                                <span class=c1>#   the Deployment has failed progressing</span>
                                <span class=c1>#   must &gt; minReadySeconds</span>
  <span class=nt>paused</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>             <span class=c1># default false, for pausing and resuming a Deployment</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>               <span class=c1># default 1</span>
  <span class=nt>revisionHistoryLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>  <span class=c1># default 10, number of old ReplicaSets kept for rollback</span>
  <span class=nt>selector</span><span class=p>:</span>                 <span class=c1># required</span>
    <span class=nt>matchLabels</span><span class=p>:</span>            <span class=c1># must match spec.template.metadata.labels</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class=nt>strategy</span><span class=p>:</span>                 <span class=c1># strategy used to replace old Pods by new ones</span>
    <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>     <span class=c1># default RollingUpdate, also possible: Recreate</span>
    <span class=nt>rollingUpdate</span><span class=p>:</span>
      <span class=nt>maxUnavailable</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>   <span class=c1># default 25%, max number of Pods over desired replicas</span>
                            <span class=c1>#   that can be unavailable during the update process</span>
                            <span class=c1>#   can be an absolute number or percentage (rounding down)</span>
      <span class=nt>maxSurge</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>         <span class=c1># default 25%, max number of Pods that can be created</span>
                            <span class=c1>#   over desired replicas</span>
                            <span class=c1>#   can be an absolute number or percentage (rounding up)</span>
  <span class=nt>template</span><span class=p>:</span>                 <span class=c1># required, aka Pod template, </span>
                            <span class=c1>#   same schema as Pod, apiVersion and kind excluded</span>
    <span class=nt>metadata</span><span class=p>:</span>               <span class=c1># required</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class=nt>spec</span><span class=p>:</span>                   <span class=c1># required</span>
      <span class=nt>containers</span><span class=p>:</span>           <span class=c1># required</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.14.2</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span> <span class=c1># default Always, also available: Never, OnFailure</span>
</code></pre></div> </details> <p>A Deployment may <strong>terminate</strong> Pods whose labels match the selector if their template is different from <code>.spec.template</code> or if the total number of such Pods exceeds <code>.spec.replicas</code>. For labels, make sure not to overlap with other controllers, otherwise the controllers won't behave correctly </p> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code>kubectl apply -f &lt;.yaml&gt;
kubectl get deployment
kubectl describe deployment/&lt;deployment_name&gt;
kubectl scale deployment/&lt;deployment_name&gt; --replicas<span class=o>=</span><span class=m>10</span>
kubectl autoscale deployment/&lt;deployment_name&gt; --min<span class=o>=</span><span class=m>10</span> --max<span class=o>=</span><span class=m>15</span> --cpu-percent<span class=o>=</span><span class=m>80</span>
kubectl rollout status deployment/&lt;deployment_name&gt;
kubectl rollout <span class=nb>history</span> deployment/&lt;deployment_name&gt;
kubectl rollout undo deployment/&lt;deployment_name&gt; --to-revision<span class=o>=</span><span class=m>2</span>
kubectl rollout pause/resume deployment/&lt;deployment_name&gt;
kubectl edit deployment/&lt;deployment_name&gt;
kubectl get rs
</code></pre></div> </details> <h4 id=rollingupdate-vs-recreate>RollingUpdate vs. Recreate<a class=headerlink href=#rollingupdate-vs-recreate title="Permanent link">&para;</a></h4> <p>A Deployment's <code>revision</code> is created when a Deployment's rollout is triggered. New revision is created each time the PodTemplate (.spec.templates) is changed. Set <code>.spec.revisionHistoryLimit</code> field (default 10) to specify how many old ReplicaSets for this Deployment you want to retain.</p> <p>During a <strong>RollingUpdate</strong>, <code>Deployment controller</code> creates new Pods per the new ReplicaSet and termiantes existing replicas in the active ReplicaSets, in a controlled rate in order to mitigate risk.</p> <p>With <code>propertional scaling</code>, Deployment controller decide where to add new replicas instead of adding all blindly to the new ReplicaSet. Parameters affecting this are <code>maxSurge</code> and <code>maxUnavailable</code></p> <p>When setting <code>.spec.strategy.type</code> to <strong>Recreate</strong>, existing Pods are killed before new ones are created, which guarantee Pod termination previous to creation for upgrades. Successful removal is awaited before any Pod of the new revision is created.</p> <h4 id=deployment-statuses>Deployment statuses<a class=headerlink href=#deployment-statuses title="Permanent link">&para;</a></h4> <p>A Deployment can have various states during its lifecycle: progressing, complete, fail to progress</p> <p><strong>Progressing</strong> state:</p> <ul> <li>creating a new ReplicaSet</li> <li>scaling up newest ReplicaSet</li> <li>scaling down older ReplicaSet(s)</li> <li>wait new Pods to become Ready</li> </ul> <p><strong>Complete</strong> state:</p> <ul> <li>all replicas updated to latest version per the PodTemplateSpec and Ready</li> <li>no old replicas present</li> </ul> <p><strong>Failed</strong> state:</p> <ul> <li>progressing got stuck for a while and cannot complete by the <code>.spec.progressDeadlineSeconds</code> configured<ul> <li>Possible causes:<ul> <li>insufficient quota</li> <li>readiness probe fails</li> <li>image pull errors</li> <li>insufficient permissions</li> <li>application runtime misconfiguration causing container exits</li> </ul> </li> </ul> </li> <li>Kubernetes takes <strong>NO action</strong> on a stalled Deployment other than to report a status condition <code>.status.conditions</code>:<ul> <li>"Type=Progressing"</li> <li>"Status=False"</li> <li>"Reason=ProgressDeadlineExceeded"</li> </ul> </li> <li>Higher level orchestrators can take advantage of it and act accordingly, such as rollback to previous version</li> </ul> <h3 id=replicaset>ReplicaSet<a class=headerlink href=#replicaset title="Permanent link">&para;</a></h3> <p>A <strong>ReplicaSet</strong> maintains a stable set of replica Pods running at any given time. When a ReplicaSet needs to create new Pods, it uses its <code>Pod template</code>.</p> <h4 id=replicaset-and-its-links-with-pods>ReplicaSet and its Links with Pods<a class=headerlink href=#replicaset-and-its-links-with-pods title="Permanent link">&para;</a></h4> <p>A ReplicaSet is <strong>linked</strong> to its Pods via the Pods' <code>metadata.ownerReferences</code> field, which specifies what resource the current object is owned by. A ReplicaSet identifies new Pods to <strong>acquire</strong> by using its selector on Pods missing <code>metadata.ownerReferences</code> or the reference is an invalid controller, for which the reference is established.</p> <p>While you can create <code>bare Pods</code>, it is important to make sure they DO NOT have labels which match the selector of one of exiting ReplicaSets, otherwise they can be acquired by the ReplicaSets and got deleted (because exceeding the desired number of replica).</p> <p>You can remove Pods from a ReplicaSet (<code>orphan Pods</code>) by changing their labels so they do not match any ReplicaSet's selector. This technique may be used to remove Pods from service for <strong>debugging, data recovery, etc</strong>.</p> <p><code>Deployment</code> is a higher-level resource that manages ReplicaSets, and you may never need to manipulate ReplicaSet objects directly. Use a Deployment instead, and define your application in the <code>spec</code> section.</p> <h4 id=schema-reference_2>Schema Reference<a class=headerlink href=#schema-reference_2 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>ReplicaSet Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">guestbook</span>
    <span class=nt>tier</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>tier</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>tier</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">php-redis</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/google_samples/gb-frontend:v3</span>
</code></pre></div> </details> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code>kubectl get rs
kubectl delete rs/&lt;rs_name&gt;
kubectl delete replicaset/&lt;rs_name&gt;
kubectl delete replicaset/&lt;rs_name&gt; --cascade<span class=o>=</span>orphan <span class=c1># keep the Pods managed by this ReplicaSet</span>
</code></pre></div> </details> <h4 id=replicaset-as-a-horizontal-pod-autoscaler-hpa-target>ReplicaSet as a Horizontal Pod Autoscaler (HPA) Target<a class=headerlink href=#replicaset-as-a-horizontal-pod-autoscaler-hpa-target title="Permanent link">&para;</a></h4> <p>ReplicaSet can be auto-scaled by an HPA according to settings such as CPU usage, cron expression, etc.</p> <details class=note open=open><summary>HPA Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">autoscaling/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend-scaler</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>scaleTargetRef</span><span class=p>:</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
  <span class=nt>minReplicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class=nt>maxReplicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class=nt>targetCPUUtilizationPercentage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
</code></pre></div> </details> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code>kubectl autoscale rs frontend --max<span class=o>=</span><span class=m>10</span> --min<span class=o>=</span><span class=m>3</span> --cpu-percent<span class=o>=</span><span class=m>50</span>
</code></pre></div> </details> <h3 id=statefulsets>StatefulSets<a class=headerlink href=#statefulsets title="Permanent link">&para;</a></h3> <p><strong>StatefulSets</strong> are like Deployments that manages the deployment and scaling of a set of Pods, while providing guarantees about the <strong>ordering</strong> and <strong>uniqueness</strong> of these Pods. Pods created are not interchangeable and each has a <strong>persistent identifier</strong> that it maintains across any rescheduling.</p> <p>StatefulSets are valuable for applications that require one or more of:</p> <ul> <li>Stable, unique network identifiers.</li> <li>Stable, persistent storage.</li> <li>Ordered, graceful deployment and scaling.</li> <li>Ordered, automated rolling updates.</li> </ul> <h4 id=limitationsbehaviors>Limitations/Behaviors<a class=headerlink href=#limitationsbehaviors title="Permanent link">&para;</a></h4> <ul> <li>Storage for a Pod must be provisioned by a <code>PersistentVolumeProvisioner</code> based on the <code>storage class</code>, or pre-provisioned by an admin</li> <li>Deleting/scaling down StatefulSet will NOT delete the volumes to ensure data safety</li> <li>A Headless Service is required for the network identity of the Pods</li> <li>Deletion of the Pods when a StatefulSet is deleted, is not guaranteed.<ul> <li>try scale down the StatefulSet to 0 prior its deletion</li> </ul> </li> <li>RollingUpdates with default <code>podManagementPolicy</code> as <code>OrderedReady</code> can run into a broken state that requires <a href=https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#forced-rollback target=_blank>manual intervention</a></li> </ul> <h4 id=schema-reference_3>Schema Reference<a class=headerlink href=#schema-reference_3 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>StatefulSet Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>                       <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>                         <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                                 <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
<span class=nt>spec</span><span class=p>:</span>                                     <span class=c1># required</span>
  <span class=nt>podManagementPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">OrderedReady</span>       <span class=c1># default OrderedReady, also possible: Parallel</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>                             <span class=c1># default 1</span>
  <span class=nt>selector</span><span class=p>:</span>                               <span class=c1># required</span>
    <span class=nt>matchLabels</span><span class=p>:</span>                          <span class=c1># must match spec.template.metadata.labels</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class=nt>serviceName</span><span class=p>:</span> <span class=s>&quot;nginx&quot;</span>                    <span class=c1># must match the Service name</span>
  <span class=nt>template</span><span class=p>:</span>                               <span class=c1># required</span>
    <span class=nt>metadata</span><span class=p>:</span>                             <span class=c1># required</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>   <span class=c1># should be non-0</span>
      <span class=nt>containers</span><span class=p>:</span>                         <span class=c1># required</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/nginx-slim:0.8</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
        <span class=nt>volumeMounts</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">www</span>
          <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
  <span class=nt>updateStrategy</span><span class=p>:</span>
    <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>                   <span class=c1># default RollingUpdate, also possible: OnDelete, Partitions</span>
  <span class=nt>volumeClaimTemplates</span><span class=p>:</span>                   <span class=c1># provide stable storage using PersistentVolumes</span>
  <span class="p p-Indicator">-</span> <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">www</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>accessModes</span><span class=p>:</span> <span class="p p-Indicator">[</span> <span class=s>&quot;ReadWriteOnce&quot;</span> <span class="p p-Indicator">]</span>
      <span class=nt>storageClassName</span><span class=p>:</span> <span class=s>&quot;my-storage-class&quot;</span>
      <span class=nt>resources</span><span class=p>:</span>
        <span class=nt>requests</span><span class=p>:</span>
          <span class=nt>storage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class=nn>---</span>
<span class=c1># Headless Service</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>ports</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
  <span class=nt>clusterIP</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">None</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div> </details> <h4 id=statefulset-pods>StatefulSet Pods<a class=headerlink href=#statefulset-pods title="Permanent link">&para;</a></h4> <p>StatefulSet Pods have a unique identity that is comprised of an <strong>ordinal</strong>: each Pod assigned an integer ordinal from <code>0</code> up through <code>N-1</code>, for N replicas.</p> <p>Pod will be named <code>$(statefulset name)-$(ordinal)</code> and getting a matching DNS subdomain <code>$(podname).$(governing service domain)</code>.</p> <p>The domain managed by the Headless Service has form <code>$(service name).$(namespace).svc.$(cluster_domain)</code>. cluster_domain will be <code>cluster.local</code> unless <a href=https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/ target=_blank>configured</a>.</p> <p>Pod will also be added a label <code>statefulset.kubernetes.io/pod-name</code> with it name, for attaching a Service to specific Pods.</p> <h4 id=scaling>Scaling<a class=headerlink href=#scaling title="Permanent link">&para;</a></h4> <p>StatefulSet being deployed will do updates to the Pods sequentially in the order from <strong>{0..N-1}</strong>; and Pod N must wait ALL Pods N-1 and below to have started and available, before being created and replaced.</p> <p>Upon StatefulSet deletion, the Pods will be terminatated sequentially in the order from <strong>{N-1..0}</strong>; and Pod N must wait ALL Pods N+1 and above to have completed terminated and deleted, before going into termination.</p> <h4 id=parallel-pod-management>Parallel Pod Management<a class=headerlink href=#parallel-pod-management title="Permanent link">&para;</a></h4> <p>Specifying <code>.spec.podManagementPolicy</code> with <code>Parallel</code> will launch or terminate all Pods in parallel regardless the ordering.</p> <h4 id=update-strategies>Update Strategies<a class=headerlink href=#update-strategies title="Permanent link">&para;</a></h4> <p>StatefulSet's <code>.spec.updateStrategy</code> field allows you to <strong>configure and disable</strong> automated rolling updates for containers, labels, resource request/limits, and annotations for the Pods in a StatefulSet.</p> <h5 id=ondelete>OnDelete<a class=headerlink href=#ondelete title="Permanent link">&para;</a></h5> <p><strong>OnDelete</strong> tells StatefulSet controller to not automatically update Pods; users must manually delete Pods to cause new Pods being created to reflect changes to <code>.spec.template</code>.</p> <h5 id=rollingupdate>RollingUpdate<a class=headerlink href=#rollingupdate title="Permanent link">&para;</a></h5> <p><strong>RollingUpdate</strong> strategy implements automated, rolling update for the Pods in a StatefulSet.</p> <h5 id=partitions>Partitions<a class=headerlink href=#partitions title="Permanent link">&para;</a></h5> <p><strong>Partitions</strong> is a setting under RollingUpdate, by specifying a <code>.spec.updateStrategy.rollingUpdate.partition</code> number. All Pods with an ordinal <strong>&gt;= partition number</strong> will be updated when the StatefulSet's <code>.spec.template</code> is updated; the rest won't ever be updated even on deletion (recreated at previous version)</p> <h3 id=daemonset>DaemonSet<a class=headerlink href=#daemonset title="Permanent link">&para;</a></h3> <p><strong>DaemonSet</strong> ensures that all (or some) Nodes run a <strong>copy</strong> of a Pod. As nodes are added to the cluster, Pods are added to them, and vice-versa.</p> <p>Deleting a DaemonSet will clean up the Pods it created.</p> <p>Typical use of DaemonSet:</p> <ul> <li>running a cluster storage daemon on every node</li> <li>running a logs collection daemon on every node</li> <li>running a node monitoring daemon on every node</li> </ul> <h4 id=schema-reference_4>Schema Reference<a class=headerlink href=#schema-reference_4 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>DaemonSet Template</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>                       <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>                           <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                                 <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>k8s-app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fluentd-logging</span>
<span class=nt>spec</span><span class=p>:</span>                                     <span class=c1># required</span>
  <span class=nt>selector</span><span class=p>:</span>                               <span class=c1># required, if both types of matchers specified, ANDed</span>
    <span class=nt>matchLabels</span><span class=p>:</span>                          <span class=c1># must match spec.template.metadata.labels</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span>
    <span class=nt>matchExpressions</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>                 <span class=c1># allows more sophisticated selectors by key or list values</span>
  <span class=nt>template</span><span class=p>:</span>                               <span class=c1># required</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fluentd-elasticsearch</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">quay.io/fluentd_elasticsearch/fluentd:v2.5.2</span>
        <span class=nt>resources</span><span class=p>:</span>
          <span class=nt>limits</span><span class=p>:</span>
            <span class=nt>memory</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
          <span class=nt>requests</span><span class=p>:</span>
            <span class=nt>cpu</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100m</span>
            <span class=nt>memory</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
        <span class=nt>volumeMounts</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">varlog</span>
          <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
          <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
          <span class=nt>readOnly</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>affinity</span><span class=p>:</span>                             <span class=c1># default unset, decide what nodes to schedule Pods</span>
        <span class=nt>nodeAffinity</span><span class=p>:</span>
          <span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
            <span class=nt>nodeSelectorTerms</span><span class=p>:</span>
            <span class="p p-Indicator">-</span> <span class=nt>matchFields</span><span class=p>:</span>
              <span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">metadata.name</span>
                <span class=nt>operator</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class=nt>values</span><span class=p>:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">target-host-name</span>
      <span class=nt>nodeName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>                         <span class=c1># default unset (schedule on all nodes)</span>
      <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>                 <span class=c1># default Always, must be Always</span>
      <span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class=nt>tolerations</span><span class=p>:</span>                          <span class=c1># have the daemonset runnable on master nodes</span>
                                            <span class=c1># remove if your masters can&#39;t run pods</span>
      <span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/master</span>
        <span class=nt>effect</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
      <span class=nt>volumes</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">varlog</span>
        <span class=nt>hostPath</span><span class=p>:</span>
          <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">varlibdockercontainers</span>
        <span class=nt>hostPath</span><span class=p>:</span>
          <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers</span>
</code></pre></div> </details> <p>Once a DaemonSet is created, do not edit its <code>.spec.selector</code> as it creates orphaned Pods. Instead, delete the old DaemonSet and deploy a new one if it is necessary to update the selector.</p> <p>Normally, the node that a Pod runs on is selected by the Kubernetes scheduler. DaemonSet pods are created and scheduled by the <strong>DaemonSet controller</strong>. By adding the NodeAffinity term to the DaemonSet pods, <code>ScheduleDaemonSetPods</code> allows you to schedule DaemonSets using the default scheduler instead of the DaemonSet controller.</p> <h3 id=jobs>Jobs<a class=headerlink href=#jobs title="Permanent link">&para;</a></h3> <p>A <strong>Job</strong> creates one or more Pods and will continue to <strong>retry execution</strong> of the Pods until a specified number of them successfully terminate. Deleting a Job cleans up the Pods created.</p> <p>Job is used to run some task to completion, and run multiple tasks in parallel from multiple Pods. Parallel Jobs are good for processing of a set of independent but related work items.</p> <h4 id=parallel-executions>Parallel executions<a class=headerlink href=#parallel-executions title="Permanent link">&para;</a></h4> <ol> <li>Non-parallel <strong>default</strong> Jobs<ul> <li>only one Pod started, Job completes as soon as the Pod terminates successfully</li> </ul> </li> <li>Parallel Jobs with a <strong>fixed completion</strong> count<ul> <li>Multiple Pods started, each successful Pod termination get completion count increment by 1</li> <li>Job completes when there is one successful Pod for each value in the range 1 to <code>.spec.completions</code></li> <li>you may specify <code>.spec.parallelism</code> to speed up Job completion<ul> <li>actual number of pods running in parallel will not exceed the number of remaining completions</li> </ul> </li> </ul> </li> <li>Parallel Jobs with a <strong>work queue</strong><ul> <li>specify <code>.spec.parallelism</code>, leave <code>.spec.completions</code> unset</li> <li>Multiple Pods started, Job completes only when at least one Pod terminates successfully and all Pods are terminated<ul> <li>requires Pods coordinate amongst themselves or an external service to determine what each should work on</li> <li>requires each Pod independently capable of determining whether or not all its peers are done</li> </ul> </li> <li>No new Pods scheduled once one of the Pods terminates successfully</li> </ul> </li> </ol> <p>When running a Job in parallel, the Pods should be tolerant to concurrency.</p> <h4 id=schema-reference_5>Schema Reference<a class=headerlink href=#schema-reference_5 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>Job example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1</span>            <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Job</span>                       <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                       <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pi</span>
<span class=nt>spec</span><span class=p>:</span>                           <span class=c1># required</span>
  <span class=nt>activeDeadlineSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>    <span class=c1># default unset, Job must complete within this period</span>
  <span class=nt>ttlSecondsAfterFinished</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>  <span class=c1># default unset, time to delete Job after its completion</span>
                                <span class=c1>#   currently an Alpha feature, needs feature gate</span>
  <span class=nt>backoffLimit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>               <span class=c1># default 6, fail a Job after some amount of retries</span>
                                <span class=c1>#   with an exponential back-off delay</span>
  <span class=nt>completions</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>                <span class=c1># default 1, run parallel jobs for fixed completion count</span>
  <span class=nt>parallelism</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>                <span class=c1># default 1, run parallel jobs with work queue</span>
  <span class=nt>manualSelector</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>         <span class=c1># only when manually specifying the selector</span>
                                <span class=c1>#   optional and best to omit</span>
  <span class=nt>selector</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class=nt>template</span><span class=p>:</span>                     <span class=c1># required</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pi</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">perl</span>
        <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;perl&quot;</span><span class="p p-Indicator">,</span>  <span class=s>&quot;-Mbignum=bpi&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;-wle&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;print</span><span class=nv> </span><span class=s>bpi(2000)&quot;</span><span class="p p-Indicator">]</span>
      <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>      <span class=c1># only Never or OnFailure allowed</span>
</code></pre></div> </details> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code>kubectl get <span class=nb>jobs</span>
kubectl get pods --selector<span class=o>=</span>job-name<span class=o>=</span>pi --output<span class=o>=</span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[*].metadata.name}&#39;</span>
</code></pre></div> </details> <h4 id=job-termination>Job termination<a class=headerlink href=#job-termination title="Permanent link">&para;</a></h4> <p>When a Job completes, no more Pods are created, and the terminated Pods are around for viewing the logs and diagnostics. The job object also <strong>remains</strong> after it is completed. It must be manually cleaned up or set <code>ttlSecondsAfterFinished</code> for auto cleanup. Or switch to a <code>CronJob</code> instead.</p> <p>If <code>.spec.activeDeadlineSeconds</code> is set, the Job must complete within the period and will fail otherwise and terminate all its running Pods.</p> <h3 id=cronjob>CronJob<a class=headerlink href=#cronjob title="Permanent link">&para;</a></h3> <p>A <strong>CronJob</strong> creates Jobs on a repeating schedule. One CronJob object is like one line of a <code>crontab</code> (cron table) file.</p> <p>All CronJob <code>schedule:</code> times are based on the <strong>timezone</strong> of the <code>kube-controller-manager</code>.</p> <p>CronJob name must be <strong>&lt;= 52 chars</strong> because 11 chars are usually generated and the max length for name is 63 chars.</p> <p>A cron job creates a job object about <strong>once per execution time</strong> of its schedule. CronJobs scheduled should be idempotent since in rare circumstances it might be that 2 jobs are created or none created.</p> <h4 id=schema-reference_6>Schema Reference<a class=headerlink href=#schema-reference_6 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>CronJob Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span>                   <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CronJob</span>                               <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                                   <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
<span class=nt>spec</span><span class=p>:</span>                                       <span class=c1># required</span>
  <span class=nt>schedule</span><span class=p>:</span> <span class=s>&quot;*/1</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span>                   <span class=c1># required: minute[0-59], hour[0-23], day of the month[1-31], month[1-12], day of week[0-6](Sunday to Saturday)</span>
                                            <span class=c1>#   consult tool at https://crontab.guru/</span>
  <span class=nt>concurrencyPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>                  <span class=c1># default Forbid</span>
  <span class=nt>startingDeadlineSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>              <span class=c1># default unset</span>
  <span class=nt>jobTemplate</span><span class=p>:</span>                              <span class=c1># required</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>template</span><span class=p>:</span>
        <span class=nt>spec</span><span class=p>:</span>
          <span class=nt>containers</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
            <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">busybox</span>
            <span class=nt>imagePullPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
            <span class=nt>args</span><span class=p>:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span>
          <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div> </details> <h4 id=cronjob-limitations>CronJob limitations<a class=headerlink href=#cronjob-limitations title="Permanent link">&para;</a></h4> <ul> <li>A CronJob is counted as <strong>missed</strong> if it has <strong>failed to create</strong> Job at its scheduled time.<ul> <li>If concurrencyPolicy is set to Forbid and a CronJob was attempted to be scheduled when there was a previous schedule still running, then it would count as missed.</li> </ul> </li> <li>CronJob Controller checks how many schedules it missed in the duration from its last scheduled time until now.<ul> <li>If there are more than <strong>100 missed</strong> schedules, then it does not start the job and logs an error.</li> <li>If the <code>startingDeadlineSeconds</code> field is set, controller counts how many missed jobs occurred from this value rather than from the last scheduled time until now.</li> <li>If <code>startingDeadlineSeconds</code> is set to a large value or left unset (the default) and if <code>concurrencyPolicy</code> is set to Allow, the jobs will always run <strong>at least once</strong>.</li> </ul> </li> </ul> <h3 id=replicationcontroller>ReplicationController<a class=headerlink href=#replicationcontroller title="Permanent link">&para;</a></h3> <p><strong>ReplicationController</strong> ensures that a specified number of pod replicas are running and available <strong>at any time</strong>. Extra Pods are terminated to match the desired number of Pods and vice-versa.</p> <p>ReplicationController supervises multiple pods across <strong>multiple nodes</strong>. The ReplicationController is <strong>designed</strong> to facilitate simple rolling updates to a service by replacing pods <strong>one-by-one</strong>, and does NOT perform readiness nor liveness probes. </p> <p>ReplicationController is intended to be managed by external auto-scaler and not he HPA and used as a composable building-block primitive.</p> <h4 id=schema-reference_7>Schema Reference<a class=headerlink href=#schema-reference_7 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>ReplicationController example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>                  <span class=c1># required</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>     <span class=c1># required</span>
<span class=nt>metadata</span><span class=p>:</span>                       <span class=c1># required</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=nt>spec</span><span class=p>:</span>                           <span class=c1># required</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>                   <span class=c1># default 1</span>
  <span class=nt>selector</span><span class=p>:</span>                     <span class=c1># required</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>                  <span class=c1># default spec.template.metadata.labels and must match</span>
  <span class=nt>template</span><span class=p>:</span>                     <span class=c1># required</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class=nt>restartPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>     <span class=c1># default Always and must be Always</span>
</code></pre></div> </details> <h3 id=garbage-collector>Garbage Collector<a class=headerlink href=#garbage-collector title="Permanent link">&para;</a></h3> <p>Kubernetes <strong>garbage collector</strong> (GC) deletes certain objects that <strong>no longer</strong> have an <strong>owner</strong>.</p> <p>The k8s GC does NOT delete bare Pods or orphan Pods since they are not the case of losing the ownership.</p> <h4 id=ownership>Ownership<a class=headerlink href=#ownership title="Permanent link">&para;</a></h4> <p>Objects can <strong>own</strong> other objects within the same namespace. Owned objects are <strong>dependents</strong> of the owner object and must have a <code>metadata.ownerReferences</code> field point to its owner.</p> <p>The <code>metadata.ownerReferences</code> is automatically set for objects created or adopted by ReplicationController, ReplicaSet, StatefulSet, DaemonSet, Deployment, Job, and CronJob. It can also be manually set on objects to establish ownership.</p> <h4 id=schema-reference_8>Schema Reference<a class=headerlink href=#schema-reference_8 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>Ownership Example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">ownerReferences</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
    <span class=nt>controller</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>blockOwnerDeletion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-repset</span>
    <span class=nt>uid</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">d9607e19-f88f-11e6-a518-42010a800195</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div> </details> <h4 id=cascading-deletion>Cascading Deletion<a class=headerlink href=#cascading-deletion title="Permanent link">&para;</a></h4> <p>When you delete an object, the object's <strong>dependents</strong> are also deleted automatically if <strong>Cascading Deletion</strong> is enabled, otherwise the dependents are <strong>orphaned</strong>.</p> <h5 id=foreground>Foreground<a class=headerlink href=#foreground title="Permanent link">&para;</a></h5> <p>In foreground cascading deletion, root object enters a "deletion in progress" state:</p> <ul> <li>object still <strong>visible</strong> in API</li> <li>object <code>deletionTimestamp</code> is set</li> <li>object <code>metadata.finalizers</code> contains "<strong>foregroundDeletion</strong>"</li> <li>next, GC deletes root object's <strong>dependents</strong></li> <li>once ALL dependents are deleted, GC deletes the root object<ul> <li>only blocked by dependents with <code>ownerReference.blockOwnerDeletion=true</code></li> </ul> </li> </ul> <h5 id=background>Background<a class=headerlink href=#background title="Permanent link">&para;</a></h5> <p>In background cascading deletion, Kubernetes deletes the owner object <strong>immediately</strong> and the garbage collector then deletes the dependents in the <strong>background</strong>.</p> <h4 id=schema-reference_9>Schema Reference<a class=headerlink href=#schema-reference_9 title="Permanent link">&para;</a></h4> <p>The json example is for when calling k8s API to delete an object while setting the deletion options.</p> <details class=note open=open><summary>DeleteOptions example</summary><div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;kind&quot;</span><span class=p>:</span> <span class=s2>&quot;DeleteOptions&quot;</span><span class=p>,</span>
    <span class=nt>&quot;apiVersion&quot;</span><span class=p>:</span> <span class=s2>&quot;v1&quot;</span><span class=p>,</span>
    <span class=nt>&quot;propagationPolicy&quot;</span><span class=p>:</span> <span class=s2>&quot;Orphan&quot;</span> <span class=err>//</span> <span class=err>also</span> <span class=err>possible</span><span class=p>:</span> <span class=err>Foregrou</span><span class=kc>n</span><span class=err>d</span><span class=p>,</span> <span class=err>Backgrou</span><span class=kc>n</span><span class=err>d</span>
<span class=p>}</span>
</code></pre></div> </details> <details class=note open=open><summary>Frequently used commands</summary><div class=highlight><pre><span></span><code><span class=c1># call k8s API</span>
kubectl proxy --port<span class=o>=</span><span class=m>8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span class=se>\</span>
  -d <span class=s1>&#39;{&quot;kind&quot;:&quot;DeleteOptions&quot;,&quot;apiVersion&quot;:&quot;v1&quot;,&quot;propagationPolicy&quot;:&quot;Foreground&quot;}&#39;</span> <span class=se>\</span>
  -H <span class=s2>&quot;Content-Type: application/json&quot;</span>

<span class=c1># directly use kubectl delete</span>
kubectl delete replicaset my-repset --cascade<span class=o>=</span>orphan
</code></pre></div> </details> <h3 id=ttl-controller>TTL Controller<a class=headerlink href=#ttl-controller title="Permanent link">&para;</a></h3> <p><strong>TTL controller</strong> provides a TTL (<strong>time to live</strong>) mechanism to limit the lifetime of resource objects that have <strong>finished execution</strong>. It only handles Jobs for now, specified with <code>.spec.ttlSecondsAfterFinished</code>, and it is currently an alpha feature.</p> <p>The <code>.spec.ttlSecondsAfterFinished</code> of a Job can be modified after the resource is created or has finished. The Job's existance will NOT be guaranteed after its TTL (if set) expires.</p> <p>TTL controller will assume that a resource is eligible to be cleaned up when its TTL has expired, and will delete it cascadingly.</p> <h2 id=services-lb-networking>Services, LB, Networking<a class=headerlink href=#services-lb-networking title="Permanent link">&para;</a></h2> <h3 id=service>Service<a class=headerlink href=#service title="Permanent link">&para;</a></h3> <p><strong>Service</strong> is an <strong>abstract</strong> way to expose an application running on a set of Pods as a <strong>network service</strong>. It defines a logical set of Pods (governed by a selector) and a policy by which to access them.</p> <p>Kubernetes creates <strong>Endpoint</strong> objects and associates them with the Service objects. This is done automatically when a Service has a selector defined.</p> <p>Kubernetes gives Pods their own IP addresses. With Service, Kubernetes assigns this Service an IP address (<strong>cluster IP</strong>) and a <strong>single DNS name</strong> to represent the set of Pods matching its selector, and can <strong>load-balance</strong> among the Pods.</p> <h4 id=schema-reference_10>Schema Reference<a class=headerlink href=#schema-reference_10 title="Permanent link">&para;</a></h4> <details class=note open=open><summary>Service template</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>       <span class=c1># default ClusterIP, also possible: NodePort, LoadBalancer, ExternalName</span>
  <span class=nt>externalName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>     <span class=c1># required only when using ExternalName as type</span>
  <span class=nt>clusterIP</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>        <span class=c1># optional and only when specifying your own cluster IP address</span>
                        <span class=c1>#   must be a valid IPv4 or IPv6 address from within </span>
                        <span class=c1>#   the service-cluster-ip-range CIDR range configured</span>
                        <span class=c1>#   for the API server</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">MyApp</span>
  <span class="l l-Scalar l-Scalar-Plain">sessionAffinityConfig:# default unset</span>
    <span class="l l-Scalar l-Scalar-Plain">clientIP</span><span class="p p-Indicator">:</span>           <span class=c1># pass particular client request to the same Pod each time</span>
      <span class=nt>timeoutSeconds</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>
  <span class=nt>ports</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>        <span class=c1># required if specifying multiple ports</span>
      <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>     <span class=c1># default TCP, also possible: UDP, SCTP (alpha), HTTP, PROXY</span>
      <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>          <span class=c1># incoming port</span>
      <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">9376</span>  <span class=c1># default same as port, the target port within Pod</span>
      <span class=nt>nodePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">30007</span>   <span class=c1># optional and only when using NodePort as type</span>
  <span class=nt>externalIPs</span><span class=p>:</span>          <span class=c1># optional and only when forcing on external nodes</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80.11.12.11</span>
<span class=nt>status</span><span class=p>:</span>
  <span class=nt>loadBalancer</span><span class=p>:</span>         <span class=c1># available when using LoadBalancer and after being provisioned</span>
    <span class=nt>ingress</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">192.0.2.127</span>
</code></pre></div> </details> <p>If you created a Service <strong>without a selector</strong>, you need to manually map the Service to the network address and port where it's running, by adding an Endpoint object manually.</p> <details class=note open=open><summary>Endpoint template</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Endpoints</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class=nt>subsets</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>addresses</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">192.0.2.42</span>
    <span class=nt>ports</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">9376</span>
</code></pre></div> </details> <div class="admonition warn"> <p class=admonition-title>Note</p> <p>The endpoint IPs must NOT be: <strong>loopback</strong> (127.0.0.0/8 for IPv4, ::1/128 for IPv6), or <strong>link-local</strong> (169.254.0.0/16 and 224.0.0.0/24 for IPv4, fe80::/64 for IPv6).</p> <p>Endpoint IP addresses CANNOT be the <strong>cluster IP</strong>s of other Kubernetes Services, because kube-proxy does NOT support virtual IPs as a destination.</p> <p>kubectl port-forward --address 0.0.0.0 <resource> 8080:8080</p> </div> <h4 id=servicetype>ServiceType<a class=headerlink href=#servicetype title="Permanent link">&para;</a></h4> <p>Service's <code>ServiceTypes</code> allow you to specify what kind of Service you want. The default is ClusterIP.</p> <ul> <li><strong>ClusterIP</strong> - Exposes the Service on a cluster-internal (virtual) IP.<ul> <li>Service is only reachable from <strong>within</strong> the cluster</li> </ul> </li> <li><strong>NodePort</strong> - Exposes the Service on <strong>each Node's IP</strong> at a <strong>static port</strong><ul> <li>Service reachable from <strong>outside</strong> the cluster, by requesting <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>.</li> <li>The port allocated is from a <strong>range</strong> specified by <code>--service-node-port-rang</code>, default 30000-32767<ul> <li>reported to the Service object in <code>.spec.ports[*].nodePort</code></li> <li>can request specific port number from the valid range with <code>nodePort</code>, but need to take care of <strong>port collision</strong> yourself</li> </ul> </li> <li>Use <code>--nodeport-addresses</code> in kube-proxy to specify only particular IP block(s) to proxy the port</li> <li>A ClusterIP is created to be routed from the NodePort Service.<ul> <li>each node proxies that port into this Service</li> </ul> </li> </ul> </li> <li><strong>LoadBalancer</strong> - Exposes the Service externally using a <strong>cloud provider</strong>'s load balancer.<ul> <li>A NodePort and a ClusterIP is created to be routed from the external load balancer<ul> <li>NodePort allocation can be disabled via an alpha feature <code>ServiceLBNodePortControl</code> with <code>spec.allocateLoadBalancerNodePorts=false</code></li> </ul> </li> <li>Internal load balancer support see <a href=https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer target=_blank>here</a></li> <li>Actual creation of the load balancer happens asynchronously and available after it is provisioned, in <code>.status.loadBalancer</code> field<ul> <li>Some cloud providers allow you to specify the <code>loadBalancerIP</code></li> </ul> </li> <li>All ports must have the same protocol on the LoadBalancer Service<ul> <li>available protocol is defined by the cloud provider</li> <li>alpha feature <code>MixedProtocolLBService</code> allows different protocols</li> </ul> </li> </ul> </li> <li><strong>ExternalName</strong> - Maps the Service to the contents of the <code>.spec.externalName</code> field<ul> <li>Value should be a canonical DNS name</li> <li>Returning a CNAME record with its value</li> <li>NO proxy is set up</li> <li><a href=https://akomljen.com/kubernetes-tips-part-1/ target=_blank>Read more</a></li> </ul> </li> </ul> <p>Alternative to a Service is the Ingress. It acts as the entry point for your cluster and lets you consolidate your routing rules into a single resource as it can expose multiple services under the same IP address.</p> <p>If there are <strong>external IP</strong>s that route to one or more <strong>cluster nodes</strong>, Kubernetes Services can be exposed on these nodes via <code>.spec.externalIPs</code></p> <h4 id=application-protocol>Application protocol<a class=headerlink href=#application-protocol title="Permanent link">&para;</a></h4> <p>This is an alpha feature, by specifying <code>appProtocol</code>, you can specify an application protocol for each Service port. For example, an application can serve 8889 with ftp and 8090 with smtp. The value must be valid <a href=https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml target=_blank>IANA standard service names</a></p> <h4 id=virtual-ips-and-proxies>Virtual IPs and proxies<a class=headerlink href=#virtual-ips-and-proxies title="Permanent link">&para;</a></h4> <p>Every node in a Kubernetes cluster runs a <strong>kube-proxy</strong>, which is responsible for implementing a form of <strong>virtual IP</strong> (cluster IP) for Services of type other than <strong>ExternalName</strong>.</p> <p>kube-proxy uses <strong>iptables</strong> (packet processing logic in Linux) to define virtual IP addresses which are transparently redirected as needed.</p> <p>kube-proxy can run in several modes.</p> <h5 id=user-space-mode>User space mode<a class=headerlink href=#user-space-mode title="Permanent link">&para;</a></h5> <p>In this mode, kube-proxy <strong>on each node</strong> watches the Kubernetes control plane for the <strong>addition</strong> and <strong>removal</strong> of Service and Endpoint objects. For each new Service it opens a <strong>randomly chosen</strong> proxy port on the <strong>local</strong> node. It then adds new <strong>iptables rules</strong> which capture traffic to the Service's clusterIP and port (<code>request -&gt; clusterIP:port -&gt; nodeIP:proxy_port</code>), which <strong>redirect</strong> that traffic to the <strong>proxy port</strong> which proxies to the Service's backend Pod (through Endpoints), using a <strong>round-robin</strong> algorithm.</p> <p>Service owners can choose ANY port they want without risk of collision.</p> <p>The <code>.spec.sessionAffinity</code> setting on the Service affects which Pod gets the traffic at any moment.</p> <h5 id=iptables-mode>iptables mode<a class=headerlink href=#iptables-mode title="Permanent link">&para;</a></h5> <p>In this mode, kube-proxy also does the watches on the Service and Endpoint objects and install <strong>iptable rules</strong> which capture traffic to the Service's clusterIP and port. Additionally, it installs iptables rules which redirect from the clusterIP and port to per-Service rules, which further link to backend Pods <strong>for each Endpoint object</strong> using destination NAT. When a Service is accessed, kube-proxy redirects the packets to a backend Pod at <strong>random</strong> or via <strong>session affinity</strong>.</p> <p>This mode is likely more reliable since traffic is handled by <strong>Linux netfilter</strong> without the need to switch between userspace and the <strong>kernel space</strong>. Packets are never copied to userspace, the kube-proxy does NOT have to be running for the virtual IP address to work, and Nodes see traffic arriving from the <strong>unaltered client IP address</strong>.</p> <p>However if traffic comes in through a node-port or through a load-balancer, the client IP does get altered.</p> <h5 id=ipvs-mode>IPVS mode<a class=headerlink href=#ipvs-mode title="Permanent link">&para;</a></h5> <p>In this mode, kube-proxy watches Kubernetes Services and Endpoints, calls <strong>netlink</strong> interface to create IPVS rules accordingly and <strong>synchronizes</strong> IPVS rules with Kubernetes Services and Endpoints <strong>periodically</strong>. When accessing a Service, IPVS directs traffic to one of the backend Pods.</p> <p>This mode is based on <strong>netfilter hook function</strong> that is similar to iptables mode, but uses a <strong>hash table</strong> as the underlying data structure and works in the <strong>kernel space</strong>.</p> <p>This mode is likely better, serves with lower latency, higher throughput, better performance in synchronization of rules, and provides more load-balancing algorithms.</p> <p>IPVS kernel modules must be installed before enabling kube-proxy with this mode.</p> <div class="admonition warn"> <p class=admonition-title>Note</p> <p>Both the userspace proxy mode and the iptables proxy mode <strong>obscures</strong> the source (external client) IP address of a packet accessing a Service. One way to fight this is to add a proxy before Kubernetes Network and filtering each request and add source IP address as a header.</p> </div> <h4 id=discovering-services>Discovering services<a class=headerlink href=#discovering-services title="Permanent link">&para;</a></h4> <h5 id=env-vars>Env Vars<a class=headerlink href=#env-vars title="Permanent link">&para;</a></h5> <p>When a Pod is run on a Node, the kubelet adds a set of <strong>environment variables</strong> for <strong>each active Service</strong>: <code>{SVCNAME}_SERVICE_HOST</code> and <code>{SVCNAME}_SERVICE_PORT</code> variables, where the <strong>Service name</strong> is upper-cased and dashes are converted to underscores. i.e. <code>redis-master</code> which exposes TCP port <code>6379</code> will be available as:</p> <div class=highlight><pre><span></span><code><span class=nv>REDIS_MASTER_SERVICE_HOST</span><span class=o>=</span><span class=m>10</span>.0.0.11
<span class=nv>REDIS_MASTER_SERVICE_PORT</span><span class=o>=</span><span class=m>6379</span>
<span class=nv>REDIS_MASTER_PORT</span><span class=o>=</span>tcp://10.0.0.11:6379
<span class=nv>REDIS_MASTER_PORT_6379_TCP</span><span class=o>=</span>tcp://10.0.0.11:6379
<span class=nv>REDIS_MASTER_PORT_6379_TCP_PROTO</span><span class=o>=</span>tcp
<span class=nv>REDIS_MASTER_PORT_6379_TCP_PORT</span><span class=o>=</span><span class=m>6379</span>
<span class=nv>REDIS_MASTER_PORT_6379_TCP_ADDR</span><span class=o>=</span><span class=m>10</span>.0.0.11
</code></pre></div> <div class="admonition warn"> <p class=admonition-title>Note</p> <p>When you have a Pod that needs to access a Service via the environment variables, you must create the Service <strong>before</strong> the client Pods come into existence.</p> </div> <h5 id=dns>DNS<a class=headerlink href=#dns title="Permanent link">&para;</a></h5> <p>You should ALWAYS set up a <strong>DNS service</strong> for your Kubernetes cluster using an <strong>add-on</strong>, such as CoreDNS.</p> <p>Doing so will allow Pods within the same namespace as a Service to lookup its IP using its DNS name. Pods within a different namespace can also do with its full DNS name.</p> <p>The Kubernetes DNS server is the ONLY way to access <strong>ExternalName Services</strong>.</p> <h4 id=headless-services>Headless Services<a class=headerlink href=#headless-services title="Permanent link">&para;</a></h4> <p>When you do NOT need load-balancing and Service IP, you can create a <strong>Headless Service</strong> by explicitly specifying "<code>None</code>" for the cluster IP (<code>.spec.clusterIP</code>).</p> <p>For headless Services that <strong>define selectors</strong>, the endpoints controller creates Endpoints records in the API, and modifies the DNS configuration to return records (addresses) that point <strong>directly</strong> to the Pods backing the Service.</p> <p>For those that do not define selectors, no Endpoints created. However, the DNS system looks for and configures either:</p> <ul> <li><code>CNAME</code> records for ExternalName-type Services</li> <li><code>A</code> records for any Endpoints that share a name with the Service, for all other types.</li> </ul> <h3 id=service-topology>Service Topology<a class=headerlink href=#service-topology title="Permanent link">&para;</a></h3> <p><strong>Service Topology</strong> enables a service to route traffic based upon the <strong>Node topology</strong> of the <strong>cluster</strong>. A service can specify that traffic be preferentially routed to endpoints that are on the same <strong>Node</strong> as the client, or in the same <strong>availability zone</strong>.</p> <p>Service creator can define a policy for routing traffic based upon the <strong>Node labels</strong> for the <strong>originating and destination</strong> Nodes. You can control Service traffic routing by specifying the <code>.spec.topologyKeys</code> field on the Service object, which should be a <strong>preference-ordered</strong> list of Node labels to be used to sort endpoints when accessing the Service. If no match to any of the Node labels is found, the traffic will be <strong>rejected</strong>.</p> <p>The special value <code>*</code> may be used to mean "any topology" and only makes sense as the <strong>last value</strong> in the list, if used. If <code>.spec.topologyKeys</code> is not specified or empty, NO topology constraints will be applied.</p> <p>Consider a cluster with Nodes that are labeled with their <code>hostname, zone name, and region name</code>. Then you can set the topologyKeys values of a service to direct traffic:</p> <ul> <li>Only to endpoints on the same node, failing if no endpoint exists on the node: <code>["kubernetes.io/hostname"]</code></li> <li>Preferentially to endpoints on the same node, falling back to endpoints in the same zone, followed by the same region, and failing otherwise: <code>["kubernetes.io/hostname", "topology.kubernetes.io/zone", "topology.kubernetes.io/region"]</code></li> <li>Preferentially to the same zone, fallback on any available endpoint otherwise: <code>["topology.kubernetes.io/zone", "*"]</code></li> </ul> <p><strong>Valid topology</strong> keys are <strong>currently</strong> limited to <code>kubernetes.io/hostname</code>, <code>topology.kubernetes.io/zone</code>, and <code>topology.kubernetes.io/region</code></p> <h4 id=yaml-reference>YAML Reference<a class=headerlink href=#yaml-reference title="Permanent link">&para;</a></h4> <details class=node open=open><summary>Service Topology example</summary><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-app</span>
  <span class=nt>ports</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">9376</span>
  <span class=nt>topologyKeys</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=s>&quot;kubernetes.io/hostname&quot;</span>
    <span class="p p-Indicator">-</span> <span class=s>&quot;*&quot;</span>
</code></pre></div> </details> <h3 id=kubernetes-dns>Kubernetes DNS<a class=headerlink href=#kubernetes-dns title="Permanent link">&para;</a></h3> <p><strong>Kubernetes DNS</strong> schedules a <strong>DNS Pod and Service</strong> on the cluster, and configures the kubelets to tell individual containers to use the DNS Service's IP to resolve DNS names.</p> <p>Every Service defined in the cluster (including the DNS server itself) is assigned a <strong>DNS name</strong>. By default, a client Pod's DNS search list will include the <strong>Pod's own namespace</strong> and the cluster's <strong>default domain</strong>.</p> <h4 id=for-services>for Services<a class=headerlink href=#for-services title="Permanent link">&para;</a></h4> <p>Normal Services are assigned a <strong>DNS A or AAAA record</strong>, depending on the IP family of the service, in the form of <code>svc-name.namespace.svc.cluster-domain.example</code>, which resolves to the <strong>cluster IP</strong> of the Service. A Headless Service gets the same record, except that it resolves to the set of <strong>IPs of the pods</strong> selected by the Service. </p> <h5 id=srv-records>SRV records<a class=headerlink href=#srv-records title="Permanent link">&para;</a></h5> <p><strong>SRV Records</strong> are created for <strong>named ports</strong> that are part of normal or Headless Services, in the form of <code>_port-name._port-protocol.svc-name.namespace.svc.cluster-domain.example</code>.</p> <p>For a normal Service, it resolves to the domain name and the port number, <code>svc-name.namespace.svc.cluster-domain.example:port</code>. For a Headless Service, it resolves to multiple answers, one domain and port for each pod that is backing the service, <code>auto-generated-name.svc-name.namespace.svc.cluster-domain.example:port</code>.</p> <h4 id=for-pods>for Pods<a class=headerlink href=#for-pods title="Permanent link">&para;</a></h4> <h5 id=aaaaa-records>A/AAAA records<a class=headerlink href=#aaaaa-records title="Permanent link">&para;</a></h5> <p>A normal Pod gets DNS resolution in the form of <code>pod-ip-address.namespace.pod.cluster-domain.example</code>.</p> <p>Any pods created by a <strong>Deployment</strong> or <strong>DaemonSet</strong> exposed by a Service have the DNS resolution in the form of <code>pod-ip-address.deployment-name.namespace.svc.cluster-domain.example</code>.</p> <h5 id=hostnmae-and-subdomain>hostnmae and subdomain<a class=headerlink href=#hostnmae-and-subdomain title="Permanent link">&para;</a></h5> <p>When a Pod is created, its <strong>hostname</strong> is the Pod's <code>metadata.name</code> value. There is also <code>.spec.hostname</code> to be used to specify the Pod's hostname, which takes <strong>precedence</strong> over the Pod's name.</p> <p>The Pod also has an optional subdomain field <code>.spec.subdomain</code> which can be used to specify its <strong>subdomain</strong>. Then its fully qualified domain name (<strong>FQDN</strong>) becomes <code>hostname.subdomain.namespace.svc.cluster-domain.example</code></p> <p>Pod needs to become READY in order to have a record unless <code>publishNotReadyAddresses=True</code> is set on the Service.</p> <h5 id=sethostnameasfqdn>setHostnameAsFQDN<a class=headerlink href=#sethostnameasfqdn title="Permanent link">&para;</a></h5> <p>When a Pod is configured to have FQDN, its <code>hostname</code> command returns the short hostname set on the Pod, and the <code>hostname --fqdn</code> command returns the FQDN.</p> <p>When you set <code>.spec.setHostnameAsFQDN=true</code> on the Pod, both <code>hostname</code> and <code>hostname --fqdn</code> return the Pod's FQDN.</p> <div class="admonition warn"> <p class=admonition-title>Note</p> <p>In Linux, the hostname field of the kernel (the nodename field of struct utsname) is limited to <strong>64 characters</strong>. If a Pod enables <code>.spec.setHostnameAsFQDN</code> and its FQDN is longer than 64 character, it will stuck in Pending(ContainerCreating) status.</p> <p>One way to solve this issue is to create an <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#admission-webhooks target=_blank>admission webhook controller</a> to control FQDN size when users create top level objects ike Deployments.</p> </div> <h5 id=dns-policy>DNS Policy<a class=headerlink href=#dns-policy title="Permanent link">&para;</a></h5> <p>DNS policies can be set on a per-pod basis via <code>.spec.dnsPolicy</code>:</p> <ul> <li><strong>Default</strong> - Pod inherits the DNS name resolution configuration <strong>from the node</strong> that the pods run on</li> <li><strong>ClusterFirst</strong> (default policy) - Any DNS query that does NOT match the configured <strong>cluster domain suffix</strong>, such as "www.kubernetes.io", is <strong>forwarded</strong> to the <strong>upstream DNS nameserver</strong> inherited from the node<ul> <li>Cluster administrators may have extra stub-domain and upstream DNS servers configured</li> </ul> </li> <li><strong>ClusterFirstWithHostNet</strong> - only for Pods running with <strong>hostNetwork</strong></li> <li><strong>None</strong> - allows Pod to <strong>ignore</strong> DNS settings from the Kubernetes environment<ul> <li>All DNS settings are expected to be provided using the <code>.spec.dnsConfig</code> field in the Pod Spec</li> </ul> </li> </ul> <h5 id=dns-config>DNS Config<a class=headerlink href=#dns-config title="Permanent link">&para;</a></h5> <p>Pod's DNS Config is optional but it allows users more control on the DNS settings for a Pod. It will be required if <code>.spec.dnsPolicy=None</code>. Some properties:</p> <ul> <li><code>nameservers</code> - a list of DNS servers' IP addresses<ul> <li>at most 3 can be provided</li> <li>optional unless <code>.spec.dnsPolicy=None</code></li> <li>the list will be combined to the base nameservers generated from the DNS Policy</li> </ul> </li> <li><code>searches</code> - a list of DNS search domains for hostname lookup in the Pod.<ul> <li>at most 6 can be provided</li> <li>optional</li> <li>the list will be combined to the base search domains generated from the DNS Policy</li> </ul> </li> <li><code>options</code> - a list of objects where each object may have a name property (required) and a value property (optional)<ul> <li>optional</li> <li>the list will be combined to the base options generated from the DNS Policy</li> </ul> </li> </ul> <details class=note open=open><summary>DNS Config Example</summary><p><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">dns-example</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>containers</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
      <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class=nt>dnsPolicy</span><span class=p>:</span> <span class=s>&quot;None&quot;</span>
  <span class=nt>dnsConfig</span><span class=p>:</span>
    <span class=nt>nameservers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1.2.3.4</span>
    <span class=nt>searches</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ns1.svc.cluster-domain.example</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my.dns.search.suffix</span>
    <span class=nt>options</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ndots</span>
        <span class=nt>value</span><span class=p>:</span> <span class=s>&quot;2&quot;</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">edns0</span>
</code></pre></div> Will generate <code>/etc/resolv.conf</code>: <div class=highlight><pre><span></span><code>nameserver 1.2.3.4
search ns1.svc.cluster-domain.example my.dns.search.suffix
options ndots:2 edns0
</code></pre></div></p> </details> <h3 id=endpointslices>EndpointSlices<a class=headerlink href=#endpointslices title="Permanent link">&para;</a></h3> <p><strong>EndpointSlices</strong> allow for <strong>distributing</strong> network endpoints across <strong>multiple resources</strong>. Each slice can hold upto 100 endpoints.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../../Docker/Docker-Practical/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Docker Practical </div> </div> </a> <a href=../service_mesh/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Service Mesh </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.53cc9318.min.js></script> <script src=../../../assets/javascripts/bundle.e9c9f54f.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>