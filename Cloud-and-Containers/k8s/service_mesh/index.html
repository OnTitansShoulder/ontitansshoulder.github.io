<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We are all standing on the shoulders of the giants..."><meta name=author content="Zhongkai Liu"><link rel="shortcut icon" href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.6"><title>Service Mesh - Ontitansshoulder</title><link rel=stylesheet href=../../../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.39b8e14a.min.css><meta name=theme-color content=#4051b5><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#service-mesh-fundamentals class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title=Ontitansshoulder class="md-header-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Ontitansshoulder </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> Service Mesh </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class="md-tabs__link md-tabs__link--active"> Notes </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Ontitansshoulder class="md-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Ontitansshoulder </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1 checked> <label class=md-nav__link for=nav-1> Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Notes data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Welcome </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <label class=md-nav__link for=nav-1-2> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Foundamental/Data_Structures_and_Algos/ class=md-nav__link> Data Structures and Algos </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-1 type=checkbox id=nav-1-3-1> <label class=md-nav__link for=nav-1-3-1> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=3> <label class=md-nav__title for=nav-1-3-1> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation/ class=md-nav__link> Linux Foundation </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_System_Admin/ class=md-nav__link> Linux System Administration </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_Network_Admin/ class=md-nav__link> Linux Network Administration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-2 type=checkbox id=nav-1-3-2> <label class=md-nav__link for=nav-1-3-2> Practical References <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Practical References" data-md-level=3> <label class=md-nav__title for=nav-1-3-2> <span class="md-nav__icon md-icon"></span> Practical References </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Commands/Freq-Used-Shell-Cmds/ class=md-nav__link> Freq Used Shell Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Networking-Shell-Cmds/ class=md-nav__link> Freq Used Network Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Text-Manipulating-Cmds/ class=md-nav__link> Text Manipulating Cmds </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-3 type=checkbox id=nav-1-3-3> <label class=md-nav__link for=nav-1-3-3> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=3> <label class=md-nav__title for=nav-1-3-3> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/References/Freq-Tasks/ class=md-nav__link> Freq Linux Tasks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Terminal-Tricks/ class=md-nav__link> Linux Terminal Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Vim-Tricks/ class=md-nav__link> Vim Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Account-Administration/ class=md-nav__link> Manage Accounts & Groups </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-4 type=checkbox id=nav-1-4 checked> <label class=md-nav__link for=nav-1-4> Cloud <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Cloud data-md-level=2> <label class=md-nav__title for=nav-1-4> <span class="md-nav__icon md-icon"></span> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Architecture/Cloud-App-Architecture/ class=md-nav__link> Cloud App Architecture </a> </li> <li class=md-nav__item> <a href=../../Docker/Docker/ class=md-nav__link> Docker and Containers </a> </li> <li class=md-nav__item> <a href=../../Docker/Docker-Practical/ class=md-nav__link> Docker Practical </a> </li> <li class=md-nav__item> <a href=../K8s-Knowledge/ class=md-nav__link> K8s Knowledge </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Service Mesh <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Service Mesh </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#service-mesh-fundamentals class=md-nav__link> Service Mesh Fundamentals </a> <nav class=md-nav aria-label="Service Mesh Fundamentals"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cloud-native-applications class=md-nav__link> Cloud-native applications </a> <nav class=md-nav aria-label="Cloud-native applications"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-architectures class=md-nav__link> Common Architectures </a> </li> <li class=md-nav__item> <a href=#common-challenges class=md-nav__link> Common Challenges </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilience-for-distributed-systems class=md-nav__link> Resilience for distributed systems </a> <nav class=md-nav aria-label="Resilience for distributed systems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#load-balancing class=md-nav__link> Load Balancing </a> </li> <li class=md-nav__item> <a href=#timeouts-and-retries class=md-nav__link> Timeouts and Retries </a> </li> <li class=md-nav__item> <a href=#deadlines class=md-nav__link> Deadlines </a> </li> <li class=md-nav__item> <a href=#circuit-breakers class=md-nav__link> Circuit Breakers </a> </li> <li class=md-nav__item> <a href=#resilience-with-proxies class=md-nav__link> Resilience with Proxies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-planes-and-control-planes class=md-nav__link> Data Planes and Control Planes </a> <nav class=md-nav aria-label="Data Planes and Control Planes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#data-plane class=md-nav__link> Data Plane </a> </li> <li class=md-nav__item> <a href=#control-plane class=md-nav__link> Control Plane </a> </li> <li class=md-nav__item> <a href=#ingress-and-api-gateway class=md-nav__link> Ingress and API Gateway </a> <nav class=md-nav aria-label="Ingress and API Gateway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> Orchestration </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-benefits class=md-nav__link> Service Mesh Benefits </a> <nav class=md-nav aria-label="Service Mesh Benefits"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-discovery class=md-nav__link> Service Discovery </a> </li> <li class=md-nav__item> <a href=#resilience class=md-nav__link> Resilience </a> <nav class=md-nav aria-label=Resilience> <ul class=md-nav__list> <li class=md-nav__item> <a href=#timeouts-and-retries_1 class=md-nav__link> Timeouts and Retries </a> </li> <li class=md-nav__item> <a href=#circuit-breakers_1 class=md-nav__link> Circuit Breakers </a> </li> <li class=md-nav__item> <a href=#load-balancing_1 class=md-nav__link> Load Balancing </a> </li> <li class=md-nav__item> <a href=#fault-injection class=md-nav__link> Fault Injection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#observability class=md-nav__link> Observability </a> <nav class=md-nav aria-label=Observability> <ul class=md-nav__list> <li class=md-nav__item> <a href=#telemetry-and-metrics class=md-nav__link> Telemetry and Metrics </a> </li> <li class=md-nav__item> <a href=#distributed-tracing class=md-nav__link> Distributed Tracing </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> <nav class=md-nav aria-label=Security> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mutual-tls class=md-nav__link> Mutual TLS </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-disadvantages-and-costs class=md-nav__link> Service Mesh Disadvantages and Costs </a> <nav class=md-nav aria-label="Service Mesh Disadvantages and Costs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-consider-service-mesh class=md-nav__link> When to consider Service Mesh </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-interface class=md-nav__link> Service Mesh Interface </a> <nav class=md-nav aria-label="Service Mesh Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#traffic-specs-api class=md-nav__link> Traffic Specs API </a> </li> <li class=md-nav__item> <a href=#traffic-split-api class=md-nav__link> Traffic Split API </a> </li> <li class=md-nav__item> <a href=#traffic-access-control-api class=md-nav__link> Traffic Access Control API </a> </li> <li class=md-nav__item> <a href=#traffic-metrics-api class=md-nav__link> Traffic Metrics API </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-and-mitigate-app-failures class=md-nav__link> Debug and Mitigate App Failures </a> <nav class=md-nav aria-label="Debug and Mitigate App Failures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-mesh-status-checks class=md-nav__link> Service Mesh Status Checks </a> </li> <li class=md-nav__item> <a href=#service-route-metrics class=md-nav__link> Service Route Metrics </a> </li> <li class=md-nav__item> <a href=#request-logging class=md-nav__link> Request Logging </a> </li> <li class=md-nav__item> <a href=#service-proxy-logging class=md-nav__link> Service Proxy Logging </a> </li> <li class=md-nav__item> <a href=#inject-debug-container class=md-nav__link> Inject Debug Container </a> </li> <li class=md-nav__item> <a href=#telepresence-tool class=md-nav__link> Telepresence Tool </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5 type=checkbox id=nav-1-5> <label class=md-nav__link for=nav-1-5> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=nav-1-5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5-1 type=checkbox id=nav-1-5-1> <label class=md-nav__link for=nav-1-5-1> Splunk <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Splunk data-md-level=3> <label class=md-nav__title for=nav-1-5-1> <span class="md-nav__icon md-icon"></span> Splunk </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-References/ class=md-nav__link> Splunk Knowledge </a> </li> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-Dashboarding/ class=md-nav__link> Splunk Dashboarding </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6 type=checkbox id=nav-1-6> <label class=md-nav__link for=nav-1-6> Programming Langs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Programming Langs" data-md-level=2> <label class=md-nav__title for=nav-1-6> <span class="md-nav__icon md-icon"></span> Programming Langs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-1 type=checkbox id=nav-1-6-1> <label class=md-nav__link for=nav-1-6-1> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-1-6-1> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Golang-Specs/ class=md-nav__link> Golang Language Reference </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Best-Practices/ class=md-nav__link> Effective Go </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Golang/Freq-Used-Libs/ class=md-nav__link> Go libraries and examples </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-2 type=checkbox id=nav-1-6-2> <label class=md-nav__link for=nav-1-6-2> Java <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Java data-md-level=3> <label class=md-nav__title for=nav-1-6-2> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Style-Guide/ class=md-nav__link> Style Guide </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Best-Practices/ class=md-nav__link> Effective Java </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Design-Patterns/ class=md-nav__link> Java Design Patterns </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Testing-Design-Patterns/ class=md-nav__link> Testing Design Patterns </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Java/Java_Std_Lib_Cheatsheet/ class=md-nav__link> Java Std Lib Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-3 type=checkbox id=nav-1-6-3> <label class=md-nav__link for=nav-1-6-3> C++ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=C++ data-md-level=3> <label class=md-nav__title for=nav-1-6-3> <span class="md-nav__icon md-icon"></span> C++ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/CPP/CPlusPlus_Lang_Specs/ class=md-nav__link> C++ Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-4 type=checkbox id=nav-1-6-4> <label class=md-nav__link for=nav-1-6-4> Perl <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Perl data-md-level=3> <label class=md-nav__title for=nav-1-6-4> <span class="md-nav__icon md-icon"></span> Perl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Perl/Perl-Lang-Specs/ class=md-nav__link> Perl Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-5 type=checkbox id=nav-1-6-5> <label class=md-nav__link for=nav-1-6-5> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shell data-md-level=3> <label class=md-nav__title for=nav-1-6-5> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Shell/Shell-Scripting/ class=md-nav__link> Shell Scripting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Github-Markdown/ class=md-nav__link> Github Markdown Guide </a> </li> <li class=md-nav__item> <a href=../../../Programming-Lang-Reference/Regex-Specs/ class=md-nav__link> Regex Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-7 type=checkbox id=nav-1-7> <label class=md-nav__link for=nav-1-7> Reading Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reading Notes" data-md-level=2> <label class=md-nav__title for=nav-1-7> <span class="md-nav__icon md-icon"></span> Reading Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Reading-Notes/How-Netflix-Works/ class=md-nav__link> How Netflix Works </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/System-Design-Concepts/ class=md-nav__link> System Design Guide </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Why-Latency-Matters/ class=md-nav__link> Why Latency Matters </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/DevOps_SRE/ class=md-nav__link> Intro to DevOps and SRE </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Leading-without-formal-authority/ class=md-nav__link> Leading Without Formal Authority </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Google-SRE-Book/ class=md-nav__link> Google SRE Book </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Good-Reads/ class=md-nav__link> Good Reads </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#service-mesh-fundamentals class=md-nav__link> Service Mesh Fundamentals </a> <nav class=md-nav aria-label="Service Mesh Fundamentals"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cloud-native-applications class=md-nav__link> Cloud-native applications </a> <nav class=md-nav aria-label="Cloud-native applications"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-architectures class=md-nav__link> Common Architectures </a> </li> <li class=md-nav__item> <a href=#common-challenges class=md-nav__link> Common Challenges </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilience-for-distributed-systems class=md-nav__link> Resilience for distributed systems </a> <nav class=md-nav aria-label="Resilience for distributed systems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#load-balancing class=md-nav__link> Load Balancing </a> </li> <li class=md-nav__item> <a href=#timeouts-and-retries class=md-nav__link> Timeouts and Retries </a> </li> <li class=md-nav__item> <a href=#deadlines class=md-nav__link> Deadlines </a> </li> <li class=md-nav__item> <a href=#circuit-breakers class=md-nav__link> Circuit Breakers </a> </li> <li class=md-nav__item> <a href=#resilience-with-proxies class=md-nav__link> Resilience with Proxies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-planes-and-control-planes class=md-nav__link> Data Planes and Control Planes </a> <nav class=md-nav aria-label="Data Planes and Control Planes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#data-plane class=md-nav__link> Data Plane </a> </li> <li class=md-nav__item> <a href=#control-plane class=md-nav__link> Control Plane </a> </li> <li class=md-nav__item> <a href=#ingress-and-api-gateway class=md-nav__link> Ingress and API Gateway </a> <nav class=md-nav aria-label="Ingress and API Gateway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> Orchestration </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-benefits class=md-nav__link> Service Mesh Benefits </a> <nav class=md-nav aria-label="Service Mesh Benefits"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-discovery class=md-nav__link> Service Discovery </a> </li> <li class=md-nav__item> <a href=#resilience class=md-nav__link> Resilience </a> <nav class=md-nav aria-label=Resilience> <ul class=md-nav__list> <li class=md-nav__item> <a href=#timeouts-and-retries_1 class=md-nav__link> Timeouts and Retries </a> </li> <li class=md-nav__item> <a href=#circuit-breakers_1 class=md-nav__link> Circuit Breakers </a> </li> <li class=md-nav__item> <a href=#load-balancing_1 class=md-nav__link> Load Balancing </a> </li> <li class=md-nav__item> <a href=#fault-injection class=md-nav__link> Fault Injection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#observability class=md-nav__link> Observability </a> <nav class=md-nav aria-label=Observability> <ul class=md-nav__list> <li class=md-nav__item> <a href=#telemetry-and-metrics class=md-nav__link> Telemetry and Metrics </a> </li> <li class=md-nav__item> <a href=#distributed-tracing class=md-nav__link> Distributed Tracing </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> <nav class=md-nav aria-label=Security> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mutual-tls class=md-nav__link> Mutual TLS </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-disadvantages-and-costs class=md-nav__link> Service Mesh Disadvantages and Costs </a> <nav class=md-nav aria-label="Service Mesh Disadvantages and Costs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-consider-service-mesh class=md-nav__link> When to consider Service Mesh </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-mesh-interface class=md-nav__link> Service Mesh Interface </a> <nav class=md-nav aria-label="Service Mesh Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#traffic-specs-api class=md-nav__link> Traffic Specs API </a> </li> <li class=md-nav__item> <a href=#traffic-split-api class=md-nav__link> Traffic Split API </a> </li> <li class=md-nav__item> <a href=#traffic-access-control-api class=md-nav__link> Traffic Access Control API </a> </li> <li class=md-nav__item> <a href=#traffic-metrics-api class=md-nav__link> Traffic Metrics API </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-and-mitigate-app-failures class=md-nav__link> Debug and Mitigate App Failures </a> <nav class=md-nav aria-label="Debug and Mitigate App Failures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-mesh-status-checks class=md-nav__link> Service Mesh Status Checks </a> </li> <li class=md-nav__item> <a href=#service-route-metrics class=md-nav__link> Service Route Metrics </a> </li> <li class=md-nav__item> <a href=#request-logging class=md-nav__link> Request Logging </a> </li> <li class=md-nav__item> <a href=#service-proxy-logging class=md-nav__link> Service Proxy Logging </a> </li> <li class=md-nav__item> <a href=#inject-debug-container class=md-nav__link> Inject Debug Container </a> </li> <li class=md-nav__item> <a href=#telepresence-tool class=md-nav__link> Telepresence Tool </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Service Mesh</h1> <p>This set of notes was taken from a Linux Foundation course.</p> <h2 id=service-mesh-fundamentals>Service Mesh Fundamentals<a class=headerlink href=#service-mesh-fundamentals title="Permanent link">&para;</a></h2> <h3 id=cloud-native-applications>Cloud-native applications<a class=headerlink href=#cloud-native-applications title="Permanent link">&para;</a></h3> <p>A <strong>cloud-native app</strong> is those apps designed to run in the cloud and take advantage of the cloud infrastructure properties and features, often packaged and run in <strong>containers</strong>.</p> <p>The underlying cloud infrastructure often runs on <strong>shared</strong> commodity hardware that is <strong>regularly changing, restarting, or failing</strong>. The microservice should be designed to be <strong>ephemeral</strong> in nature. It should start up quickly, locate its dependent network services rapidly, and fail fast.</p> <p>In addition to developing cloud-native app, a cloud-native <strong>organization</strong> should also have adopted development and operational practices that enable <strong>agility</strong> for both the app and the organization itself.</p> <h4 id=common-architectures>Common Architectures<a class=headerlink href=#common-architectures title="Permanent link">&para;</a></h4> <p>In its architectures, each cloud-native app is composed of a number of <strong>loosely-coupled</strong> and <strong>highly-cohesive</strong> microservices working together to form a <strong>distributed system</strong>.</p> <ul> <li>loosely-coupled - the microservice can be changed internally with minimal impact on any other microservices</li> <li>highly-cohesive - microservices are built around a well-defined business context, and typically any modifications required are <strong>focused around a single area of responsibility or functionality</strong></li> </ul> <p>Developer's primary benefit of cloud-native apps development is that each app can be developed and deployed <strong>separately</strong> from the others, which enables faster development and release of apps.</p> <p>Operation's primary benefit of cloud-native apps is the ability to easily deploy, scale up or down, upgrade, and replace those apps.</p> <h4 id=common-challenges>Common Challenges<a class=headerlink href=#common-challenges title="Permanent link">&para;</a></h4> <p>Challenge 1: <strong>service discovery</strong> - being able to find all the microservices that are dynamically deployed. It becomes increasingly difficult to keep track of where all the instances are currently deployed at any given time.</p> <p>Challenge 2: <strong>security and observability</strong> - cloud-native apps have larger attack surfaces and more logical pieces to protect, and it is harder to understand what's happening when things go wrong.</p> <p>Challenge 3: <strong>system-wide fault-tolerance</strong> - while its architecture enables a crash in one service to be isolated, it is quite possible that a failure in one service can cascade throughout the entire application if this is not handled properly.</p> <h3 id=resilience-for-distributed-systems>Resilience for distributed systems<a class=headerlink href=#resilience-for-distributed-systems title="Permanent link">&para;</a></h3> <p><strong>Resilience</strong> is the use of strategies for improving <strong>availability</strong>. Ensuring the distributed system is available by <strong>reducing its downtime</strong> increases the system's resilience.</p> <p>The ultimate goal of resilience is to ensure that <strong>failures or degradations</strong> of particular microservice instances don't cause <strong>cascading failures</strong> that cause downtime for the entire distributed system.</p> <p>(<strong>Application Layer</strong>) Developers could design and code an app so it will continue to work in a degraded state, providing vital functions, even when other functions have failed due to bugs, compromises, or other issues with one or more of the microservices.</p> <p>(<strong>Network Layer</strong>) Network-level resilience strategies work to monitor the network performance of deployed instances of each microservice. Requests should be redirected to avoid unresponsive instances automatically to ensure availbility.</p> <h4 id=load-balancing>Load Balancing<a class=headerlink href=#load-balancing title="Permanent link">&para;</a></h4> <p><strong>Load blalancing</strong> (LB) for cloud-native apps can be performed at both the Network Layer or the Application Layer. The key difference is that Network level LB is per <strong>connection</strong>, while Application level LB is per <strong>request</strong>. Service Mesh is Application level LB.</p> <p>For Kubernetes, Network Layer load balancing is by default implemented using <strong>kube-proxy</strong>. The management of Pod IP addresses and routing of traffic between virtual/physical network adapters is handled via the Container Networking Interface (CNI) implementation or an overlay network, such as Calico or Weave Net.</p> <p>For cloud-native apps, load balancing refers to balancing the app's requests amongst the <strong>running instances</strong> of the microservices. Having multiple instances of each microservice distributed on several machines or nodes provides <strong>redundancy</strong>.</p> <p>LB algorithms are mostly Round Robin, Least Request, Session Affinity (aka sticky sessions), and weighted versions of the first two.</p> <h4 id=timeouts-and-retries>Timeouts and Retries<a class=headerlink href=#timeouts-and-retries title="Permanent link">&para;</a></h4> <p>When part of the system fails to handle the request in a certain period of time, the request <strong>times out</strong> and the requester can retry the request with a <strong>redundant instance</strong> of the failed system.</p> <p>Requests should NOT ALWAYS be automatically retried. Main reason is to avoid duplicating a transaction that has already succeeded. A <strong>safe transaction</strong> (aka <strong>idempotent transaction</strong>) is that the same request causes the same result if ran multiple times.</p> <h4 id=deadlines>Deadlines<a class=headerlink href=#deadlines title="Permanent link">&para;</a></h4> <p><strong>Distributed timeouts</strong> (aka <strong>deadlines</strong>) involves more than one services that form a chain of requests. Each node of the <strong>chain</strong> adds processing time and needs to consider the time used from all of previous nodes' processing time against the deadline set when calling the first node. If the deadline is passed on any node from the call chain, the request should return as failure immediately.</p> <h4 id=circuit-breakers>Circuit Breakers<a class=headerlink href=#circuit-breakers title="Permanent link">&para;</a></h4> <p><strong>Circuit breaker</strong> works by setting a limit for the degree of <strong>service degradation</strong> or failures for a <strong>single instance</strong> of a microservice.</p> <p>The goal of a circuit breaker is to prevent an issue with one microservice instance from negatively affecting other microservices and potentially causing a <strong>cascading failure</strong>.</p> <h4 id=resilience-with-proxies>Resilience with Proxies<a class=headerlink href=#resilience-with-proxies title="Permanent link">&para;</a></h4> <p>Over time, library-based implementations of resilience strategies have been supplanted by <strong>proxy-based</strong> implementations. Proxies can implement resilience strategies between the instances of microservices.</p> <p>For example, when an instance of microservice A sends a request to microservice B, that request actually goes to a proxy (controlled with <strong>CNAMEs</strong>). The proxy would process A's request and decide which instance of microservice B it should go to (through <strong>endpoint mappings</strong> and LB), and then it would issue the request on A's behalf where some <strong>minor-altering</strong> to the request can happen such as special heads to indicate source IP, or upgrade request with mTLS.</p> <p>Using proxy may also do cached responses for heavily requested contents to reduce the load on downstream requests.</p> <h3 id=data-planes-and-control-planes>Data Planes and Control Planes<a class=headerlink href=#data-planes-and-control-planes title="Permanent link">&para;</a></h3> <h4 id=data-plane>Data Plane<a class=headerlink href=#data-plane title="Permanent link">&para;</a></h4> <p>The <strong>data plane</strong> is a group of proxies directly <strong>manipulates traffic</strong> and is responsible for service discovery, resilience, observability, and security for the microservices. It consists of one or more <strong>service proxies</strong> within a cluster, each of which typically runs next to a single service or microservice of an app, called a <strong>service (mesh) proxy</strong>, or a <strong>sidecar proxy</strong> running alongside a service.</p> <p>A service proxy is actually <strong>both a proxy and a reverse proxy</strong>. It can accept incoming requests and make out-going requests, and handles proxy-to-proxy remote procedure calls (RPCs). Data plane features:</p> <ul> <li><strong>Service discovery</strong> - find suitable service proxies to make requests to</li> <li><strong>Resilience</strong> - implement resilience strategies</li> <li><strong>Observability</strong> - observe each request and reply that it receives, collect performance metrics (throughput, latency, failure rates, etc)</li> <li><strong>Security</strong> - reject requests that violate policies</li> </ul> <p>Common service mesh data plane solutions include Envoy Proxy, linkerd-proxy, NGINX, and HAProxy.</p> <h4 id=control-plane>Control Plane<a class=headerlink href=#control-plane title="Permanent link">&para;</a></h4> <p>The <strong>control plane</strong> manages and coordinates the data plane, and defines <strong>policy</strong> and ensuring every service proxy in the data plane <strong>follows</strong> that policy. Requests do NOT pass through the control plane.</p> <p>A service mesh is one of the patterns for architecture designs considering control plane and data plane together.</p> <h4 id=ingress-and-api-gateway>Ingress and API Gateway<a class=headerlink href=#ingress-and-api-gateway title="Permanent link">&para;</a></h4> <p>A service mesh handles an app's <strong>service-to-service</strong> (east-west) traffic within a cluster. An <strong>Ingress controller</strong> manages the app's ingress (north-south), <strong>traffic entering the cluster</strong>.</p> <p>The integration between an Ingress controller and a service mesh:</p> <ul> <li>at control plane - share <strong>service discovery information</strong> so that traffic is consistently routed to the correct target</li> <li>at data plane - share <strong>encryption secrets</strong> so that all communications can be trusted and secured</li> </ul> <p>Some Ingress controllers also function as <strong>API Gateways</strong>. An API Gateway provides additional <strong>management capabilities</strong> such as authentication, rate limiting, and API management.</p> <p>An Ingress controller is particular to Kubernetes, while API gateways are used in many environments and for purposes in addition to Ingress control.</p> <p>Common Ingress controllers: Ambassador, Contour, ingress-nginx</p> <h5 id=orchestration>Orchestration<a class=headerlink href=#orchestration title="Permanent link">&para;</a></h5> <p>The service mesh control plane frequently updates the Ingress controller on the state of the microservices in its data plane. The Ingress controller uses that information to decide how to handle incoming requests entering the cluster from the external load balancer.</p> <p><img src=https://d36ai2hkxl16us.cloudfront.net/course-uploads/e0df7fbf-a057-42af-8a1f-590912be5460/qgxp8x7qsnlv-LFS243_CourseGraphics_1.png></p> <p>Ingress controllers provide a feature known as <strong>TLS termination</strong>. This is the process of serving <strong>digital certificates</strong> to clients so that they can use TLS and also decrypt the TLS connections, and let the Ingress controller read the contents of incoming requests.</p> <h3 id=service-mesh-benefits>Service Mesh Benefits<a class=headerlink href=#service-mesh-benefits title="Permanent link">&para;</a></h3> <h4 id=service-discovery>Service Discovery<a class=headerlink href=#service-discovery title="Permanent link">&para;</a></h4> <p>In a service mesh, service discovery refers to the processes that find microservices and <strong>keep track of</strong> where they are on the network. It can be performed in many ways, inluding a <strong>DNS</strong> infrastructure, a consistent <strong>key value datastore</strong>, or a specialized solution.</p> <p>Service mesh needs to have <strong>up-to-date</strong> information on what microservices are currently <strong>deployed</strong> and <strong>how to communicate</strong> with them. Ensure as each microservice instance is deployed, it is automatically assigned a service proxy (aka automatic sidecar/proxy injection) that is deployed within its pod.</p> <p>The communications between the microservice and the service proxy in a pod utilize the <strong>localhost loopback adapter</strong>, 127.0.0.1.</p> <h4 id=resilience>Resilience<a class=headerlink href=#resilience title="Permanent link">&para;</a></h4> <h5 id=timeouts-and-retries_1>Timeouts and Retries<a class=headerlink href=#timeouts-and-retries_1 title="Permanent link">&para;</a></h5> <p><strong>Timeouts and automatic retries</strong> need proper configurations, otherwise can cause <strong>large number of retries</strong> that overwhelm systems and slow down all services.</p> <p>Service meshes can address these problems, methods commonly used are known as using a <strong>service profile</strong> (Linkerd) or a <strong>virtual service</strong> (Istio). They both define <strong>routes</strong> for a microservice.</p> <p>Another method is called a <strong>retry budget</strong>, for which the service mesh keeps track of the <strong>first-time requests</strong> and <strong>retried requests</strong>, then make sure the <strong>ratio</strong> of first-time requests to concurrently retried requests stays at an acceptable level.</p> <h5 id=circuit-breakers_1>Circuit Breakers<a class=headerlink href=#circuit-breakers_1 title="Permanent link">&para;</a></h5> <p><strong>Circuit breakers</strong> are defined through groups of configuration settings in the service mesh, and closely monitor those conditions and trip the actions from the configuration.</p> <h5 id=load-balancing_1>Load Balancing<a class=headerlink href=#load-balancing_1 title="Permanent link">&para;</a></h5> <p>Every service mesh supports at least one type of <strong>load balancing</strong> for requests, or using the general terms: <strong>traffic shifting or traffic splitting</strong>.</p> <p><strong>Blue-green</strong> deployment refers to having two <strong>production</strong> environments, one designated by blue and the other by green. When users are interacting with the blue, new deployments and testing will be done in green, then switch users to green.</p> <p><strong>Canary deployment, canary rollout, and canary release</strong> all refer to testing a new microservice release (called canary) by sending a <strong>percentage of production requests</strong> to the new microservice and <strong>gradually increasing</strong> that percentage over time. The older version ends when all requests are going to the new version.</p> <h5 id=fault-injection>Fault Injection<a class=headerlink href=#fault-injection title="Permanent link">&para;</a></h5> <p>Service mesh technologies support <strong>Fault injection</strong>, which means that you can test your app by having faults or errors <strong>purposely generated</strong> to see how they affect the app. This can be a great way to <strong>simulate various conditions</strong> and ensure that the app behaves the way you expect it to.</p> <p>The service mesh can inject many of the error conditions and other adverse circumstances on its own without having to alter the app code at all.</p> <h4 id=observability>Observability<a class=headerlink href=#observability title="Permanent link">&para;</a></h4> <h5 id=telemetry-and-metrics>Telemetry and Metrics<a class=headerlink href=#telemetry-and-metrics title="Permanent link">&para;</a></h5> <p><strong>Observability</strong> is being able to monitor an app's <strong>state</strong> and to determine a high level cause when there was a system failure in the microservice.</p> <p><strong>Telemetry</strong> (aka <strong>Metrics</strong>) means the collection of data that measures something. Google's Four Goden Signals, those metrics important to collect when monitoring distributed systems:</p> <ul> <li>Latency - time takes to receive a reply for a request</li> <li>Traffic, rps - requests per second, or what reflects the demand of the system</li> <li>Errors - percentage of requests result in an error</li> <li>Saturation - the utilization of resources such as CPU and Memory allocated</li> </ul> <p>Service mesh technologies offer multiple ways to access their metrics, such as a GUI or API.</p> <h5 id=distributed-tracing>Distributed Tracing<a class=headerlink href=#distributed-tracing title="Permanent link">&para;</a></h5> <p><strong>Distributed tracing</strong> is to have a special and unique ID-based <strong>trace header</strong> added to each request. Typically this unique ID is a <strong>universally unique identifier</strong> (UUID) that is added at the point of <strong>Ingress</strong> and binds to a user-initiated request, which can be useful for troubleshooting.</p> <p>Distributed tracing is intended to be used when metrics and other information already collected by the service mesh doesn't provide enough information to troubleshoot a problem or understand an unexpected behavior.</p> <p>All the service meshes use the same specification for their trace headers: <strong>B3</strong>. Read more about <a href=https://github.com/openzipkin/b3-propagation target=_blank>openzipkin/b3-propagation</a></p> <h4 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h4> <h5 id=mutual-tls>Mutual TLS<a class=headerlink href=#mutual-tls title="Permanent link">&para;</a></h5> <p>Service meshes can protect the communications between pods by using <strong>Transport Layer Security</strong> (TLS). TLS uses <strong>cryptography</strong> to ensure that the information being communicated can't be <strong>monitored or altered</strong> by others.</p> <p>In service meshes, TLS is used between service proxies in the form called <strong>mutual TLS</strong>:</p> <ul> <li>Each service proxy has a secret <strong>cryptographic key</strong> that <strong>confirms its identity</strong> and allows it to <strong>decrypt the communications</strong> it receives.</li> <li>Each service proxy also has a <strong>certificate</strong> (aka <strong>public key</strong>) for <strong>every other service proxy</strong> that allows it to <strong>encrypt the communications</strong> it sends out to other service proxies.</li> <li>When initiating pod-to-pod communications, each service proxy first <strong>verifies the identity</strong> of the other service proxy through authentication, then <strong>encrypts</strong> their communications.<ul> <li>Because each microservice instance has a <strong>unique private key</strong>, each session is encrypted in a way that only that <strong>particular</strong> microservice instance can <strong>decrypt</strong>.</li> </ul> </li> </ul> <p>Instead of the old security models that enforced policies based on <strong>IP address</strong>, new security models can enforce policies based on <strong>service proxy identity</strong>. Enforcing trust boundaries through identities verified by mutual TLS helps prevent attackers from laterally moving through microservices to reach the assets of greatest value.</p> <h3 id=service-mesh-disadvantages-and-costs>Service Mesh Disadvantages and Costs<a class=headerlink href=#service-mesh-disadvantages-and-costs title="Permanent link">&para;</a></h3> <p><strong>Increased complexity</strong> - more components in the architecture, and tasks like configuring the components properly and troubleshooting problems will be more challenging.</p> <p><strong>More overhead</strong> - more compute resources and other resources will be needed, and higher latency in communications.</p> <p><strong>Rapid evolution</strong> - service mesh technologies are still frequently evolving and not necessarily stable. Need to make a conscious effort to keep up with the latest developments in your service mesh technology.</p> <h4 id=when-to-consider-service-mesh>When to consider Service Mesh<a class=headerlink href=#when-to-consider-service-mesh title="Permanent link">&para;</a></h4> <p>As the <strong>number of microservices</strong> in an app <strong>increases</strong>, the growing complexity of the app makes a service mesh more beneficial for supporting resilience, observability, and security among all the microservices and their interrelationships.</p> <p>Also in <strong>deeper microservice topologies</strong>, with many microservices sending requests to each other, service meshes can be invaluable in having visibility into these requests, as well as securing the communications and adding resilience features to prevent cascading failures and other issues.</p> <p>If you're not sure if a service mesh is needed for a particular situation, consider if an Ingress controller alone may be sufficient.</p> <h3 id=service-mesh-interface>Service Mesh Interface<a class=headerlink href=#service-mesh-interface title="Permanent link">&para;</a></h3> <p><strong>Service Mesh Interface</strong> (SMI) is a <strong>Kubernetes-native specification</strong> and supports <strong>interoperability</strong> for common service mesh features. It defines a standard set of Kubernetes <strong>Custom Resource Definitions</strong> (CRDs) and <strong>APIs</strong> for service meshes.</p> <p>Users can define applications that use service mesh technology without tightly binding to any specific implementation. Read more about <a href=https://smi-spec.io target=_blank>smi specifications</a>.</p> <h4 id=traffic-specs-api>Traffic Specs API<a class=headerlink href=#traffic-specs-api title="Permanent link">&para;</a></h4> <p>Allow you to <strong>define routes</strong> that an app can use.</p> <p>For example,</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">HTTPRouteGroup</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">m-routes</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>matches</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">metrics</span>
    <span class=nt>pathRegex</span><span class=p>:</span> <span class=s>&quot;/metrics&quot;</span>
    <span class=nt>methods</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
</code></pre></div> <p>defines a <code>HTTPRouteGroup</code> resource named m-routes, which will match on any HTTP GET request the app sees with the string "/metrics" in its path. By itself it doesn't do anything for the matched requests, other resources are responsible for acting on them.</p> <h4 id=traffic-split-api>Traffic Split API<a class=headerlink href=#traffic-split-api title="Permanent link">&para;</a></h4> <p>Allow you to implement <strong>traffic splitting</strong> and <strong>traffic shifting</strong> methods like <code>A/B testing</code>, <code>blue-green deployment</code>, and <code>canary deployment</code>.</p> <p>For example,</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TrafficSplit</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">e8-feature-test</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">e8app</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>service</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">e8-widget-svc</span>
  <span class=nt>backends</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>service</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">e8-widget-svc-current</span>
    <span class=nt>weight</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">75</span>
  <span class="p p-Indicator">-</span> <span class=nt>service</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">e8-widget-svc-patch</span>
    <span class=nt>weight</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>
</code></pre></div> <p>Specify services under <code>backends</code> and give them <code>weights</code> for amount of traffic shed to them. The weights are not percentage, but the number over their total gives exact percentage (25-75 is the same as 1-3, or 250-750). It will be easier to make sure they add up to 100, or 1000.</p> <h4 id=traffic-access-control-api>Traffic Access Control API<a class=headerlink href=#traffic-access-control-api title="Permanent link">&para;</a></h4> <p>Allow you to set <strong>access control policies</strong> for <strong>pod-to-pod</strong> (<strong>service proxy to service proxy</strong>) communications based on service proxy <strong>identity</strong>. By default ALL traffic is <strong>denied</strong> and need to explicitly grant permission for types of traffic to allow.</p> <p>For example,</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TrafficTarget</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">path-specific</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>destination</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">service-a</span>
    <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
  <span class=nt>rules</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">HTTPRouteGroup</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">m-routes</span>
    <span class=nt>matches</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">metrics</span>
  <span class=nt>sources</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</code></pre></div> <p>The <code>rules</code> defines the characteristics the source traffic must have in order to be allowed to reach its destination.</p> <h4 id=traffic-metrics-api>Traffic Metrics API<a class=headerlink href=#traffic-metrics-api title="Permanent link">&para;</a></h4> <p>Allow you to <strong>collect metrics</strong> on HTTP traffic and make those metrics available to other tools. Each metric involves a Kubernetes resource and limited to a particular source or destination (aka edge).</p> <p>For example,</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TrafficMetrics</span>
<span class=c1># See ObjectReference v1 core for full spec</span>
<span class=nt>resource</span><span class=p>:</span> <span class=c1># source of traffic</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">foo-775b9cbd88-ntxsl</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">foobar</span>
  <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>edge</span><span class=p>:</span> <span class=c1># destination of traffic</span>
  <span class=nt>direction</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">to</span>
  <span class=nt>side</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">client</span>
  <span class=nt>resource</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">baz-577db7d977-lsk2q</span>
    <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">foobar</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>timestamp</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2019-04-08T22:25:55Z</span>
<span class=nt>window</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class=nt>metrics</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">p99_response_latency</span>
  <span class=nt>unit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">seconds</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">p90_response_latency</span>
  <span class=nt>unit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">seconds</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">p50_response_latency</span>
  <span class=nt>unit</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">seconds</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">success_count</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">failure_count</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
</code></pre></div> <h3 id=debug-and-mitigate-app-failures>Debug and Mitigate App Failures<a class=headerlink href=#debug-and-mitigate-app-failures title="Permanent link">&para;</a></h3> <h4 id=service-mesh-status-checks>Service Mesh Status Checks<a class=headerlink href=#service-mesh-status-checks title="Permanent link">&para;</a></h4> <p>Check of the status of the service mesh components first, some app failures you are seeing may actually be caused by a problem in service mesh.</p> <p>This can be done with the service mesh's cli tool. For example, <code>linkerd check</code> does following checks:</p> <ul> <li>Can the service mesh communicate with Kubernetes?</li> <li>Is the Kubernetes version compatible with the service mesh version?</li> <li>Is the service mesh installed and running?</li> <li>Is the service mesh's control plane properly configured?</li> <li>Are the service mesh's credentials valid and up to date?</li> <li>Is the API for the control plane running and ready?</li> <li>Is the service mesh installation up to date?</li> <li>Is the service mesh control plane up to date?</li> </ul> <p>And <code>linkerd check --proxy</code> checks more things:</p> <ul> <li>Are the credentials for each of the data plane proxies valid and up to date?</li> <li>Are the data plane proxies running and working fine?</li> </ul> <h4 id=service-route-metrics>Service Route Metrics<a class=headerlink href=#service-route-metrics title="Permanent link">&para;</a></h4> <p>Check service app route metrics. Viewing the metrics for each route can indicate where slowdowns or failures are occurring within the mesh and narrow down the problem.</p> <h4 id=request-logging>Request Logging<a class=headerlink href=#request-logging title="Permanent link">&para;</a></h4> <p>Log individual requests and responses. Be causcious that log data can grow very large rapidly, selectively log requests may help.</p> <h4 id=service-proxy-logging>Service Proxy Logging<a class=headerlink href=#service-proxy-logging title="Permanent link">&para;</a></h4> <p>Configure the service proxy to record more events or record more details about each event. Be causcious as it may degrade the proxy's performance and also generate massive amount of logs.</p> <h4 id=inject-debug-container>Inject Debug Container<a class=headerlink href=#inject-debug-container title="Permanent link">&para;</a></h4> <p>Have your service mesh inject a debug container into bad pod. Debug container (debug sidecar) is designed to monitor the activity within the pod and to collect information on that activity, such as capturing network packets.</p> <h4 id=telepresence-tool>Telepresence Tool<a class=headerlink href=#telepresence-tool title="Permanent link">&para;</a></h4> <p>Using Telepresence, you can run a single process (a service or debug tool) locally, and a two-way network proxy enables that local service to effectively operate as part of the remote Kubernetes cluster. Telepresence is also intended for use in testing or staging.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../K8s-Knowledge/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> K8s Knowledge </div> </div> </a> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-References/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Splunk Knowledge </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.53cc9318.min.js></script> <script src=../../../assets/javascripts/bundle.e9c9f54f.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>