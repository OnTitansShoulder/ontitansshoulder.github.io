<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We are all standing on the shoulders of the giants..."><meta name=author content="Zhongkai Liu"><link rel="shortcut icon" href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.6"><title>Golang - Effective Go - Ontitansshoulder</title><link rel=stylesheet href=../../../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.39b8e14a.min.css><meta name=theme-color content=#4051b5><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#formatting-and-styles class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../../.. title=Ontitansshoulder class="md-header-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Ontitansshoulder </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> Golang - Effective Go </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class="md-tabs__link md-tabs__link--active"> Notes </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Ontitansshoulder class="md-nav__button md-logo" aria-label=Ontitansshoulder> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Ontitansshoulder </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1 checked> <label class=md-nav__link for=nav-1> Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Notes data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Welcome </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <label class=md-nav__link for=nav-1-2> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Foundamental/Data_Structures_and_Algos/ class=md-nav__link> Data Structures and Algos </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-1 type=checkbox id=nav-1-3-1> <label class=md-nav__link for=nav-1-3-1> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Concepts data-md-level=3> <label class=md-nav__title for=nav-1-3-1> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation/ class=md-nav__link> Linux Foundation </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_System_Admin/ class=md-nav__link> Linux System Administration </a> </li> <li class=md-nav__item> <a href=../../../Linux/Concepts/Linux_Foundation_Network_Admin/ class=md-nav__link> Linux Network Administration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-2 type=checkbox id=nav-1-3-2> <label class=md-nav__link for=nav-1-3-2> Practical References <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Practical References" data-md-level=3> <label class=md-nav__title for=nav-1-3-2> <span class="md-nav__icon md-icon"></span> Practical References </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/Commands/Freq-Used-Shell-Cmds/ class=md-nav__link> Freq Used Shell Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Networking-Shell-Cmds/ class=md-nav__link> Freq Used Network Cmds </a> </li> <li class=md-nav__item> <a href=../../../Linux/Commands/Text-Manipulating-Cmds/ class=md-nav__link> Text Manipulating Cmds </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3-3 type=checkbox id=nav-1-3-3> <label class=md-nav__link for=nav-1-3-3> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=3> <label class=md-nav__title for=nav-1-3-3> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Linux/References/Freq-Tasks/ class=md-nav__link> Freq Linux Tasks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Terminal-Tricks/ class=md-nav__link> Linux Terminal Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Vim-Tricks/ class=md-nav__link> Vim Tricks </a> </li> <li class=md-nav__item> <a href=../../../Linux/References/Account-Administration/ class=md-nav__link> Manage Accounts & Groups </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-4 type=checkbox id=nav-1-4> <label class=md-nav__link for=nav-1-4> Cloud <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Cloud data-md-level=2> <label class=md-nav__title for=nav-1-4> <span class="md-nav__icon md-icon"></span> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Cloud-and-Containers/Architecture/Cloud-App-Architecture/ class=md-nav__link> Cloud App Architecture </a> </li> <li class=md-nav__item> <a href=../../../Cloud-and-Containers/Docker/Docker/ class=md-nav__link> Docker and Containers </a> </li> <li class=md-nav__item> <a href=../../../Cloud-and-Containers/Docker/Docker-Practical/ class=md-nav__link> Docker Practical </a> </li> <li class=md-nav__item> <a href=../../../Cloud-and-Containers/k8s/K8s-Knowledge/ class=md-nav__link> K8s Knowledge </a> </li> <li class=md-nav__item> <a href=../../../Cloud-and-Containers/k8s/service_mesh/ class=md-nav__link> Service Mesh </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5 type=checkbox id=nav-1-5> <label class=md-nav__link for=nav-1-5> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=nav-1-5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5-1 type=checkbox id=nav-1-5-1> <label class=md-nav__link for=nav-1-5-1> Splunk <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Splunk data-md-level=3> <label class=md-nav__title for=nav-1-5-1> <span class="md-nav__icon md-icon"></span> Splunk </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-References/ class=md-nav__link> Splunk Knowledge </a> </li> <li class=md-nav__item> <a href=../../../Dev-Tools-Reference/Splunk/Splunk-Dashboarding/ class=md-nav__link> Splunk Dashboarding </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6 type=checkbox id=nav-1-6 checked> <label class=md-nav__link for=nav-1-6> Programming Langs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Programming Langs" data-md-level=2> <label class=md-nav__title for=nav-1-6> <span class="md-nav__icon md-icon"></span> Programming Langs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-1 type=checkbox id=nav-1-6-1 checked> <label class=md-nav__link for=nav-1-6-1> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-1-6-1> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Golang-Specs/ class=md-nav__link> Golang Language Reference </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Effective Go <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Effective Go </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#formatting-and-styles class=md-nav__link> Formatting and Styles </a> </li> <li class=md-nav__item> <a href=#commentary class=md-nav__link> Commentary </a> </li> <li class=md-nav__item> <a href=#names class=md-nav__link> Names </a> </li> <li class=md-nav__item> <a href=#semicolons class=md-nav__link> Semicolons </a> </li> <li class=md-nav__item> <a href=#control-structures class=md-nav__link> Control Structures </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> Functions </a> </li> <li class=md-nav__item> <a href=#data class=md-nav__link> Data </a> </li> <li class=md-nav__item> <a href=#initialization class=md-nav__link> Initialization </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> Methods </a> </li> <li class=md-nav__item> <a href=#interfaces-and-other-types class=md-nav__link> Interfaces and other types </a> </li> <li class=md-nav__item> <a href=#the-blank-identifier class=md-nav__link> The blank identifier </a> </li> <li class=md-nav__item> <a href=#embedding class=md-nav__link> Embedding </a> </li> <li class=md-nav__item> <a href=#concurrency class=md-nav__link> Concurrency </a> </li> <li class=md-nav__item> <a href=#errors class=md-nav__link> Errors </a> </li> <li class=md-nav__item> <a href=#web-server class=md-nav__link> Web Server </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Freq-Used-Libs/ class=md-nav__link> Go libraries and examples </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-2 type=checkbox id=nav-1-6-2> <label class=md-nav__link for=nav-1-6-2> Java <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Java data-md-level=3> <label class=md-nav__title for=nav-1-6-2> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Java/Style-Guide/ class=md-nav__link> Style Guide </a> </li> <li class=md-nav__item> <a href=../../Java/Best-Practices/ class=md-nav__link> Effective Java </a> </li> <li class=md-nav__item> <a href=../../Java/Design-Patterns/ class=md-nav__link> Java Design Patterns </a> </li> <li class=md-nav__item> <a href=../../Java/Testing-Design-Patterns/ class=md-nav__link> Testing Design Patterns </a> </li> <li class=md-nav__item> <a href=../../Java/Java_Std_Lib_Cheatsheet/ class=md-nav__link> Java Std Lib Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-3 type=checkbox id=nav-1-6-3> <label class=md-nav__link for=nav-1-6-3> C++ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=C++ data-md-level=3> <label class=md-nav__title for=nav-1-6-3> <span class="md-nav__icon md-icon"></span> C++ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CPP/CPlusPlus_Lang_Specs/ class=md-nav__link> C++ Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-4 type=checkbox id=nav-1-6-4> <label class=md-nav__link for=nav-1-6-4> Perl <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Perl data-md-level=3> <label class=md-nav__title for=nav-1-6-4> <span class="md-nav__icon md-icon"></span> Perl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Perl/Perl-Lang-Specs/ class=md-nav__link> Perl Language Reference </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-6-5 type=checkbox id=nav-1-6-5> <label class=md-nav__link for=nav-1-6-5> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shell data-md-level=3> <label class=md-nav__title for=nav-1-6-5> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Shell/Shell-Scripting/ class=md-nav__link> Shell Scripting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Github-Markdown/ class=md-nav__link> Github Markdown Guide </a> </li> <li class=md-nav__item> <a href=../../Regex-Specs/ class=md-nav__link> Regex Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-7 type=checkbox id=nav-1-7> <label class=md-nav__link for=nav-1-7> Reading Notes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reading Notes" data-md-level=2> <label class=md-nav__title for=nav-1-7> <span class="md-nav__icon md-icon"></span> Reading Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Reading-Notes/How-Netflix-Works/ class=md-nav__link> How Netflix Works </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/System-Design-Concepts/ class=md-nav__link> System Design Guide </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Why-Latency-Matters/ class=md-nav__link> Why Latency Matters </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/DevOps_SRE/ class=md-nav__link> Intro to DevOps and SRE </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Leading-without-formal-authority/ class=md-nav__link> Leading Without Formal Authority </a> </li> <li class=md-nav__item> <a href=../../../Reading-Notes/Google-SRE-Book/ class=md-nav__link> Google SRE Book </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Good-Reads/ class=md-nav__link> Good Reads </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#formatting-and-styles class=md-nav__link> Formatting and Styles </a> </li> <li class=md-nav__item> <a href=#commentary class=md-nav__link> Commentary </a> </li> <li class=md-nav__item> <a href=#names class=md-nav__link> Names </a> </li> <li class=md-nav__item> <a href=#semicolons class=md-nav__link> Semicolons </a> </li> <li class=md-nav__item> <a href=#control-structures class=md-nav__link> Control Structures </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> Functions </a> </li> <li class=md-nav__item> <a href=#data class=md-nav__link> Data </a> </li> <li class=md-nav__item> <a href=#initialization class=md-nav__link> Initialization </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> Methods </a> </li> <li class=md-nav__item> <a href=#interfaces-and-other-types class=md-nav__link> Interfaces and other types </a> </li> <li class=md-nav__item> <a href=#the-blank-identifier class=md-nav__link> The blank identifier </a> </li> <li class=md-nav__item> <a href=#embedding class=md-nav__link> Embedding </a> </li> <li class=md-nav__item> <a href=#concurrency class=md-nav__link> Concurrency </a> </li> <li class=md-nav__item> <a href=#errors class=md-nav__link> Errors </a> </li> <li class=md-nav__item> <a href=#web-server class=md-nav__link> Web Server </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Effective Go</h1> <p>This set of notes is taking from <a href=https://golang.org/doc/effective_go.html>golang.org</a></p> <p>Thinking about the problems from a Go's <em>perspective</em> could produce a successful but quite different program. To write Go well, it's important to understand its properties and idioms, to know its conventions for programming.</p> <p><br></p> <h3 id=formatting-and-styles>Formatting and Styles<a class=headerlink href=#formatting-and-styles title="Permanent link">&para;</a></h3> <p>Formatting issues are the most contentious but the least consequential. </p> <p>In Go we can let the machine to take care of most formatting issues, by using <code>gofmt</code> program.</p> <ul> <li><code>gofmt</code> is also available as command <code>go fmt</code></li> <li>operates at the <em>package level</em> rather than source file level</li> <li>reads a Go program and emits the source in a standard style of <em>indentation</em> and <em>vertical alignment</em> while retaining and <em>reformatting comments</em> if necessary</li> <li>a few formatting details<ul> <li>use tabs for indentation</li> <li>if a line feels too long, wrap it and indent with an extra tab</li> <li>use fewer parentheses; mathematic expression can be concise and clear without parentheses i.e. <code>x&lt;&lt;8 + y&lt;&lt;16</code></li> </ul> </li> </ul> <p>Therefore, don't spend time on formatting the comments, let Go do it by running <code>gofmt</code></p> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=nx>T</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>name</span> <span class=kt>string</span> <span class=c1>// name of the object</span>
    <span class=nx>value</span> <span class=kt>int</span> <span class=c1>// its value</span>
<span class=p>}</span>
<span class=c1>// after running gofmt</span>
<span class=kd>type</span> <span class=nx>T</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>name</span>    <span class=kt>string</span> <span class=c1>// name of the object</span>
    <span class=nx>value</span>   <span class=kt>int</span>    <span class=c1>// its value</span>
<span class=p>}</span>
</code></pre></div> <p><a href=https://github.com/uber-go/guide/blob/master/style.md>github.com/uber-go</a> offers a good style guide.</p> <p>Install some useful <a href=https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins>IDE plugins</a> to help lint styles and errors quicker and sooner. </p> <p><br></p> <h3 id=commentary>Commentary<a class=headerlink href=#commentary title="Permanent link">&para;</a></h3> <p>Go provides C-style <code>/* */</code> <em>block comments</em> and C++-style <code>//</code> <em>line comments</em>. Block comment is usually used for adding package comments.</p> <p><code>godoc</code> is a program (and web server) that processes Go source files to extract documentation about the contents of the package.</p> <ul> <li>Comments that appear immediately before <em>top-level declarations</em>, with NO intervening newlines, are extracted along with the declaration to serve as <em>explanatory text</em> or <em>doc comment</em> for the declaration.<ul> <li>every <strong>exported</strong> (capitalized) name in a program should have a <em>doc comment</em></li> <li>doc comments work best as complete sentences</li> <li>first sentence should be a one-sentence summary that starts with the <em>name</em> being declared<ul> <li>will allow docs search results to be more intuitive</li> <li>you can search docs to find a desired function by a command like <code>go doc -all regexp | grep -i parse</code></li> </ul> </li> </ul> </li> <li><code>godoc</code> displays <em>indented text</em> in a fixed-width font, suitable for <strong>program snippets</strong></li> </ul> <div class=highlight><pre><span></span><code><span class=c1>// Compile parses a regular expression and returns, if successful,</span>
<span class=c1>// a Regexp that can be used to match against text.</span>
<span class=kd>func</span> <span class=nx>Compile</span><span class=p>(</span><span class=nx>str</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>Regexp</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div> <p>Every package should have a <strong>package comment</strong>, a block comment preceding the <code>package</code> clause. However if the package is simple, the package comment can be brief and use line comments to serve the purpose</p> <div class=highlight><pre><span></span><code><span class=cm>/*</span>
<span class=cm>Package regexp implements a simple library for regular expressions.</span>
<span class=cm>The syntax of the regular expressions accepted is:</span>
<span class=cm>    regexp:</span>
<span class=cm>        concatenation { &#39;|&#39; concatenation }</span>
<span class=cm>    concatenation:</span>
<span class=cm>        { closure }</span>
<span class=cm>    closure:</span>
<span class=cm>        term [ &#39;*&#39; | &#39;+&#39; | &#39;?&#39; ]</span>
<span class=cm>    term:</span>
<span class=cm>        &#39;^&#39;</span>
<span class=cm>        &#39;$&#39;</span>
<span class=cm>        &#39;.&#39;</span>
<span class=cm>        character</span>
<span class=cm>        &#39;[&#39; [ &#39;^&#39; ] character-ranges &#39;]&#39;</span>
<span class=cm>        &#39;(&#39; regexp &#39;)&#39;</span>
<span class=cm>*/</span>
<span class=kn>package</span> <span class=nx>regexp</span>
</code></pre></div> <p>Go's declaration syntax allows grouping of declarations.</p> <ul> <li>a single doc comment can introduce a group of related constants or variables</li> <li>grouping can also indicate relationships between items, such as the fact that a set of variables is protected by a mutex.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>// Error codes returned by failures to parse an expression.</span>
<span class=kd>var</span> <span class=p>(</span>
    <span class=nx>ErrInternal</span>      <span class=p>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;regexp: internal error&quot;</span><span class=p>)</span>
    <span class=nx>ErrUnmatchedLpar</span> <span class=p>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;regexp: unmatched &#39;(&#39;&quot;</span><span class=p>)</span>
    <span class=nx>ErrUnmatchedRpar</span> <span class=p>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;regexp: unmatched &#39;)&#39;&quot;</span><span class=p>)</span>
    <span class=o>...</span>
<span class=p>)</span>
</code></pre></div> <p><br></p> <h3 id=names>Names<a class=headerlink href=#names title="Permanent link">&para;</a></h3> <p>In Go, the <strong>visibility</strong> of a name outside a package is determined by whether its <em>first character</em> is <em>upper case</em>. And naming convention matters.</p> <p><strong>Package Names</strong></p> <p>When a package is imported, the <em>package name</em> becomes an <strong>accessor</strong> for the contents with the package.</p> <ul> <li>when <code>import "bytes"</code>, can access <code>bytes.Buffer</code></li> <li>packages should be given <em>lower case</em>, <em>single-word</em> names and no need for <em>underscores</em> or <em>mixedCaps</em></li> <li>package name is only the <em>default name</em> for imports; it need not be unique across all source code<ul> <li>when there is a collision, a package can be given an alias for use locally</li> </ul> </li> <li>package name should be the <em>base name</em> of its <strong>source directory</strong><ul> <li>the package in <code>src/encoding/base64</code> is imported as <code>"encoding/base64"</code> but has name <code>base64</code>, NOT <code>encoding_base64</code> and NOT <code>encodingBase64</code></li> </ul> </li> <li>don't use the <code>import .</code> notation</li> <li>importer of a package will use the name to refer to its contents<ul> <li>give clear and concise names for things within a package</li> <li>i.e. <code>bufio.Reader</code>, so no need to name the <code>Reader</code> as <code>BufReader</code></li> <li>i.e. <code>ring.New</code>, not need to name the constructor as <code>NewRing</code></li> </ul> </li> <li>long names don't automatically make things more readable. A helpful doc comment can often be more valuable than an extra long name</li> </ul> <p>Go doesn't provide automatic <strong>Getters</strong> or <strong>Setters</strong>, but when writing ones on your own, it is best to omit the "Get" part, say <code>obj.Owner()</code> should be concise and straight-forward.</p> <p>By convention, one-method <strong>interfaces</strong> are named by the method name plus an <code>-er</code> suffix to construct an agent noun.</p> <p><code>Read, Write, Close, Flush, String</code> and so on have <em>canonical signatures and meanings</em>. To avoid confusion, don't give your method one of those names unless it has the same signature and meaning.</p> <p>The convention in Go is to use <code>MixedCaps</code> or <code>mixedCaps</code> rather than underscores to write <strong>multiword names</strong></p> <p><br></p> <h3 id=semicolons>Semicolons<a class=headerlink href=#semicolons title="Permanent link">&para;</a></h3> <p>Go's formal grammar uses <code>semicolons</code> to terminate statements but they do NOT appear in the source.</p> <ul> <li>“if the newline comes after a token that could end a statement, insert a semicolon”</li> <li>a semicolon can also be omitted immediately before a closing brace</li> <li>idiomatic Go programs have semicolons only in places such as <strong>for loop</strong> clauses, to separate the initializer, condition, and continuation elements</li> <li>semicolons are also necessary to separate multiple statements on a line</li> <li>you CANNOT put the <em>opening brace</em> of a control structure (<code>if, for, switch,</code> or <code>select</code>) on the next line because of the semicolon insertion rule</li> </ul> <p><br></p> <h3 id=control-structures>Control Structures<a class=headerlink href=#control-structures title="Permanent link">&para;</a></h3> <p>Control structures of Go are related to those of C but differ in important ways:</p> <ul> <li>there is no <code>do</code> or <code>while</code> loop, only a slightly generalized <code>for</code></li> <li><code>switch</code> is more flexible</li> <li><code>if</code> and <code>switch</code> accept an optional <strong>initialization statement</strong> like that of <code>for</code><ul> <li>mandatory braces encourage writing simple <code>if</code> statements on multiple lines</li> <li>when an <code>if</code> statement doesn't flow into the next statement—that is, the body ends in <code>break, continue, goto, or return</code>, the unnecessary <code>else</code> is omitted</li> </ul> </li> <li><code>break</code> and <code>continue</code> statements take an optional <strong>label</strong> to identify what to break or continue</li> <li>there are new control structures including a <code>type switch</code> and a multi-way communications multiplexer, <code>select</code><ul> <li>there are no parentheses and the bodies must always be brace-delimited</li> </ul> </li> </ul> <p>Three forms of <strong><code>for</code></strong> loops</p> <ul> <li><code>for init; condition; post {}</code></li> <li><code>for condition {}</code> is like a while loop<ul> <li>a <code>range</code> clause can manage the loop, i.e. <code>for key, value := range oldMap {}</code></li> <li><code>for _, value := range array {}</code> use <code>_</code> (aka the <strong>blank identifier</strong>) to discard UNWANTED return values</li> </ul> </li> <li><code>for {}</code> is like a while-true loop</li> <li>Go has NO <code>comma operator</code> and <code>++</code> and <code>--</code> are <strong>statements</strong>, NOT <strong>expressions</strong><ul> <li><code>for i, j := 0, len(a)-1; i &lt; j; i, j = i+1, j-1 {}</code></li> </ul> </li> </ul> <p>Go's <strong><code>switch</code></strong> evaluates the cases <em>top to bottom</em> UNTIL a match is found</p> <ul> <li>if the <code>switch</code> has NO <strong>expression</strong> it switches on <code>true</code></li> <li>it is idiomatic to write an <em>if-else-if-else</em> chain as a <code>switch</code></li> <li>there is NO automatic <strong>fall through</strong>, but cases can be presented in <strong>comma-separated lists</strong></li> <li><code>break</code> statements can be used to <strong>terminate</strong> a switch early<ul> <li>when trying to break out of a <em>surrounding loop</em>, not the <code>switch</code>, use a <code>label</code> on the loop and "breaking" to that <code>label</code></li> <li><code>continue</code> with <code>label</code> is specific to loops only</li> </ul> </li> <li>a <strong>type switch</strong> can also be used to discover the <strong>dynamic type</strong> of an <code>interface</code> variable<ul> <li>such a <code>type switch</code> uses the syntax of a <em>type assertion</em> with the keyword <code>type</code> inside the parentheses</li> </ul> </li> </ul> <div class=highlight><pre><span></span><code><span class=kd>var</span> <span class=nx>t</span> <span class=kd>interface</span><span class=p>{}</span>
<span class=nx>t</span> <span class=p>=</span> <span class=nx>functionOfSomeType</span><span class=p>()</span>
<span class=k>switch</span> <span class=nx>t</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
<span class=k>default</span><span class=p>:</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;unexpected type %T\n&quot;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>     <span class=c1>// %T prints whatever type t has</span>
<span class=k>case</span> <span class=kt>bool</span><span class=p>:</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;boolean %t\n&quot;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>             <span class=c1>// t has type bool</span>
<span class=k>case</span> <span class=kt>int</span><span class=p>:</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;integer %d\n&quot;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>             <span class=c1>// t has type int</span>
<span class=k>case</span> <span class=o>*</span><span class=kt>bool</span><span class=p>:</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;pointer to boolean %t\n&quot;</span><span class=p>,</span> <span class=o>*</span><span class=nx>t</span><span class=p>)</span> <span class=c1>// t has type *bool</span>
<span class=k>case</span> <span class=o>*</span><span class=kt>int</span><span class=p>:</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;pointer to integer %d\n&quot;</span><span class=p>,</span> <span class=o>*</span><span class=nx>t</span><span class=p>)</span> <span class=c1>// t has type *int</span>
<span class=p>}</span>
</code></pre></div> <p>In a <strong><code>:=</code> declaration</strong> a variable <code>v</code> may appear even if it has ALREADY been declared, when</p> <ul> <li>this declaration is in the same scope as the existing declaration of <code>v</code><ul> <li>if <code>v</code> is already declared in an outer scope, the declaration will create a NEW variable</li> <li>in Go the <em>scope</em> of <strong>function parameters</strong> and <strong>return values</strong> is the same as the <strong>function body</strong></li> </ul> </li> <li>the corresponding value in the initialization is assignable to v</li> <li>there is at least one other variable that is created by the declaration</li> </ul> <p><br></p> <h3 id=functions>Functions<a class=headerlink href=#functions title="Permanent link">&para;</a></h3> <p>In Go, functions and methods can return <strong>multiple values</strong>, which is convenient to report errors.</p> <ul> <li>i.e. <code>func (file *File) Write(b []byte) (n int, err error)</code> returns the number of bytes written and a non-nil error when n != len(b)</li> <li>i.e. a simple-minded function to grab a number from a position in a byte slice, returning the number and the next position</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=nx>nextInt</span><span class=p>(</span><span class=nx>b</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>i</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>for</span> <span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nx>isDigit</span><span class=p>(</span><span class=nx>b</span><span class=p>[</span><span class=nx>i</span><span class=p>]);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
    <span class=p>}</span>
    <span class=nx>x</span> <span class=o>:=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>isDigit</span><span class=p>(</span><span class=nx>b</span><span class=p>[</span><span class=nx>i</span><span class=p>]);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
        <span class=nx>x</span> <span class=p>=</span> <span class=nx>x</span><span class=o>*</span><span class=mi>10</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=nx>b</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>i</span>
<span class=p>}</span>
<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>);</span> <span class=p>{</span>
    <span class=nx>x</span><span class=p>,</span> <span class=nx>i</span> <span class=p>=</span> <span class=nx>nextInt</span><span class=p>(</span><span class=nx>b</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p>The return or <strong>result parameters</strong> of a Go function can be given <em>names</em> and used as regular variables, just like the incoming parameters</p> <ul> <li>when named, they are initialized to the <strong>zero values</strong> for their types when the function begins</li> <li>if the function executes a return statement with no arguments, the current values of the named result parameters are used as the returned values</li> <li>the names are not mandatory but they can make code shorter and clearer: they're <em>documentation</em></li> </ul> <p>Go's <code>defer</code> statement schedules a function call to be run immediately before the function returns</p> <ul> <li>it is effective for closing or releasing resources<ul> <li>it guarantees that you will never forget to close the file</li> <li>the <code>close</code> sits near the <code>open</code>, which is much clearer than placing it at the end of the function</li> </ul> </li> <li>the arguments to the deferred function (including the receiver if it is a method) are evaluated when the defer executes<ul> <li>if it is a variable, that variable value can change within the function body before the defer function is executed</li> </ul> </li> <li>a function can defer <em>multiple</em> function executions<ul> <li>deferred functions are executed in <strong>LIFO</strong> order</li> </ul> </li> </ul> <div class=highlight><pre><span></span><code><span class=c1>// simple ways to add function traces for debugging</span>
<span class=kd>func</span> <span class=nx>trace</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span>   <span class=p>{</span> <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;entering:&quot;</span><span class=p>,</span> <span class=nx>s</span><span class=p>)</span> <span class=p>}</span>
<span class=kd>func</span> <span class=nx>untrace</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span> <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;leaving:&quot;</span><span class=p>,</span> <span class=nx>s</span><span class=p>)</span> <span class=p>}</span>
<span class=kd>func</span> <span class=nx>a</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>trace</span><span class=p>(</span><span class=s>&quot;a&quot;</span><span class=p>)</span>
    <span class=k>defer</span> <span class=nx>untrace</span><span class=p>(</span><span class=s>&quot;a&quot;</span><span class=p>)</span>
    <span class=c1>// do something....</span>
<span class=p>}</span>

<span class=c1>// simple ways to time a function for debugging</span>
<span class=kd>func</span> <span class=nx>startTimer</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kt>string</span><span class=p>,</span> <span class=kt>int64</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=p>(</span><span class=nx>s</span><span class=p>,</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>().</span><span class=nx>UnixNano</span><span class=p>())</span> <span class=p>}</span>
<span class=kd>func</span> <span class=nx>timeIt</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>t</span> <span class=kt>int64</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>()</span>
    <span class=nx>t2</span> <span class=o>:=</span> <span class=nx>now</span><span class=p>.</span><span class=nx>UnixNano</span><span class=p>()</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Function &quot;</span><span class=p>,</span> <span class=nx>s</span><span class=p>,</span> <span class=s>&quot; run time is &quot;</span><span class=p>,</span> <span class=nx>t2</span><span class=p>,</span> <span class=s>&quot; nano seconds&quot;</span><span class=p>)</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=nx>b</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>defer</span> <span class=nx>timeIt</span><span class=p>(</span><span class=nx>startTimer</span><span class=p>(</span><span class=s>&quot;a&quot;</span><span class=p>))</span>
    <span class=c1>// do something....</span>
<span class=p>}</span>
</code></pre></div> <p><br></p> <h3 id=data>Data<a class=headerlink href=#data title="Permanent link">&para;</a></h3> <p>Go has two <strong>allocation primitives</strong>, the built-in functions <code>new</code> and <code>make</code></p> <ul> <li><strong><code>new(T)</code></strong> allocates memory and zeros it (uninitialized) and returns its address with type <code>*T</code> (pointer)</li> <li>it's helpful to arrange when designing your data structures that the zero value of each type can be used without further initialization</li> </ul> <div class=highlight><pre><span></span><code><span class=nx>p</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SyncedBuffer</span><span class=p>)</span>  <span class=c1>// type *SyncedBuffer</span>
<span class=kd>var</span> <span class=nx>v</span> <span class=nx>SyncedBuffer</span>      <span class=c1>// type  SyncedBuffer</span>
</code></pre></div> <p>Sometimes it is easier to use a <strong>composite literal</strong>, which is an expression that creates a new <em>instance</em> each time it is evaluated</p> <ul> <li>taking the address of a composite literal allocates a <em>fresh instance</em> each time it is evaluated</li> <li>fields of a <em>composite literal</em> are laid out <strong>in order</strong> and MUST ALL be present<ul> <li>by labeling the elements explicitly as field:value pairs, the initializers can appear in any order and the missing ones left as their zero values</li> </ul> </li> <li>if a composite literal contains no fields at all, it creates a zero value for the type<ul> <li>in other words, the expressions <code>new(File)</code> and <code>&amp;File{}</code> are equivalent</li> </ul> </li> <li>composite literals can also be created for <code>arrays, slices, and maps</code>, with the field labels being indices or map keys as appropriate</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=nx>NewFile</span><span class=p>(</span><span class=nx>fd</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>File</span> <span class=p>{</span>
    <span class=k>if</span> <span class=nx>fd</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=p>{</span>
        <span class=k>return</span> <span class=kc>nil</span>
    <span class=p>}</span>
    <span class=nx>f</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>File</span><span class=p>)</span>
    <span class=nx>f</span><span class=p>.</span><span class=nx>fd</span> <span class=p>=</span> <span class=nx>fd</span>
    <span class=nx>f</span><span class=p>.</span><span class=nx>name</span> <span class=p>=</span> <span class=nx>name</span>
    <span class=nx>f</span><span class=p>.</span><span class=nx>dirinfo</span> <span class=p>=</span> <span class=kc>nil</span>
    <span class=nx>f</span><span class=p>.</span><span class=nx>nepipe</span> <span class=p>=</span> <span class=mi>0</span>
    <span class=k>return</span> <span class=nx>f</span>
<span class=p>}</span>
<span class=c1>// vs.</span>
<span class=kd>func</span> <span class=nx>NewFile</span><span class=p>(</span><span class=nx>fd</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>File</span> <span class=p>{</span>
    <span class=k>if</span> <span class=nx>fd</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=p>{</span>
        <span class=k>return</span> <span class=kc>nil</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>fd</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>built-in function <strong><code>make(T, args)</code></strong> creates <code>slices, maps, and channels</code> only, and it returns an <em>initialized</em> (not zeroed) value of type <code>T</code> (not *T)</p> <ul> <li>these three types represent, under the covers, references to data structures that MUST be initialized before use<ul> <li>i.e. <code>make([]int, 10, 100)</code> allocates an array of 100 ints and then creates a slice structure with length 10 and a capacity of 100 pointing at the first 10 elements of the array</li> <li><code>new([]int)</code> returns a pointer to a newly allocated, zeroed slice structure, that is, a pointer to a nil slice value</li> </ul> </li> </ul> <p><strong>Arrays</strong> are useful when planning the detailed layout of memory - arrays are values and building block for slices - assigning one array to another <em>copies</em> ALL the elements - when passing an array to a function, it will receive a copy of the array - size of an array is part of its type - you can pass a pointer of an array - use slices whenever you can</p> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=nx>Sum</span><span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=kt>float64</span><span class=p>)</span> <span class=p>(</span><span class=nx>sum</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=o>*</span><span class=nx>a</span> <span class=p>{</span>
        <span class=nx>sum</span> <span class=o>+=</span> <span class=nx>v</span>
    <span class=p>}</span>
    <span class=k>return</span>
<span class=p>}</span>
<span class=nx>array</span> <span class=o>:=</span> <span class=p>[</span><span class=o>...</span><span class=p>]</span><span class=kt>float64</span><span class=p>{</span><span class=mf>7.0</span><span class=p>,</span> <span class=mf>8.5</span><span class=p>,</span> <span class=mf>9.1</span><span class=p>}</span>
<span class=nx>x</span> <span class=o>:=</span> <span class=nx>Sum</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>array</span><span class=p>)</span>
</code></pre></div> <p><strong>slices</strong> wrap arrays to give a more general, powerful, and convenient interface to sequences of data</p> <ul> <li>most array programming in Go is done with slices rather than simple arrays</li> <li>slices hold <em>references</em> to an underlying array</li> <li>if you assign one slice to another, both refer to the same array</li> <li><code>length</code> within the slice sets an UPPER LIMIT of how much data to read<ul> <li>length of a slice may be changed as long as it still fits within the limits of the underlying array</li> <li>do this by assigning it to a slice of itself</li> </ul> </li> <li><code>capacity</code> of a slice, accessible by the built-in function <code>cap</code>, reports the maximum length the slice may assume</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=nx>Append</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=nx>data</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>[]</span><span class=kt>byte</span> <span class=p>{</span>
    <span class=nx>l</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>l</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>&gt;</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>slice</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// reallocate</span>
        <span class=c1>// Allocate double what&#39;s needed, for future growth.</span>
        <span class=nx>newSlice</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=p>(</span><span class=nx>l</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=nx>data</span><span class=p>))</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span>
        <span class=c1>// The copy function is predeclared and works for any slice type.</span>
        <span class=nb>copy</span><span class=p>(</span><span class=nx>newSlice</span><span class=p>,</span> <span class=nx>slice</span><span class=p>)</span>
        <span class=nx>slice</span> <span class=p>=</span> <span class=nx>newSlice</span>
    <span class=p>}</span>
    <span class=nx>slice</span> <span class=p>=</span> <span class=nx>slice</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=nx>l</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=nx>data</span><span class=p>)]</span>
    <span class=nb>copy</span><span class=p>(</span><span class=nx>slice</span><span class=p>[</span><span class=nx>l</span><span class=p>:],</span> <span class=nx>data</span><span class=p>)</span>
    <span class=k>return</span> <span class=nx>slice</span>
<span class=p>}</span>
</code></pre></div> <p>slices are variable-length, it is possible to have each inner slice be a different length, when defining a 2D slice.</p> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=nx>Transform</span> <span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span><span class=kt>float64</span>  <span class=c1>// A 3x3 array, really an array of arrays.</span>
<span class=kd>type</span> <span class=nx>LinesOfText</span> <span class=p>[][]</span><span class=kt>byte</span>     <span class=c1>// A slice of byte slices.</span>
</code></pre></div> <p>The built-in data structure <code>map</code> associate values of one type (the key) with values of another type (the element or value)</p> <ul> <li>key can be of any type for which the <code>equality</code> operator is defined<ul> <li>integers, floating point and complex numbers, strings, pointers, interfaces (as long as the dynamic type supports equality), structs and arrays</li> </ul> </li> <li>maps hold <strong>references</strong> to an underlying data structure</li> <li>maps can be constructed using <code>composite literal</code> syntax with colon-separated key-value pairs</li> <li>attempt to fetch a map value with a key that is not present in the map will return the zero value for the type of the entries in the map</li> <li>use <code>delete</code> to unset a map entry, like this <code>delete(timeZone, "PDT")</code></li> </ul> <div class=highlight><pre><span></span><code><span class=kd>var</span> <span class=nx>timeZone</span> <span class=p>=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
    <span class=s>&quot;UTC&quot;</span><span class=p>:</span>  <span class=mi>0</span><span class=o>*</span><span class=mi>60</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span>
    <span class=s>&quot;EST&quot;</span><span class=p>:</span> <span class=o>-</span><span class=mi>5</span><span class=o>*</span><span class=mi>60</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span>
    <span class=s>&quot;CST&quot;</span><span class=p>:</span> <span class=o>-</span><span class=mi>6</span><span class=o>*</span><span class=mi>60</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span>
    <span class=s>&quot;MST&quot;</span><span class=p>:</span> <span class=o>-</span><span class=mi>7</span><span class=o>*</span><span class=mi>60</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span>
    <span class=s>&quot;PST&quot;</span><span class=p>:</span> <span class=o>-</span><span class=mi>8</span><span class=o>*</span><span class=mi>60</span><span class=o>*</span><span class=mi>60</span><span class=p>,</span>
<span class=p>}</span>
<span class=k>if</span> <span class=nx>offset</span><span class=p>,</span> <span class=nx>isKeyDefined</span> <span class=o>:=</span> <span class=nx>timeZone</span><span class=p>[</span><span class=s>&quot;EST&quot;</span><span class=p>];</span> <span class=nx>isKeyDefined</span> <span class=p>{</span>
  <span class=c1>// do something with offset</span>
<span class=p>}</span>
</code></pre></div> <p>formatted print functions <code>fmt.Fprint</code> and its friends take as a first argument any object that implements the <code>io.Writer</code> interface</p> <div class=highlight><pre><span></span><code><span class=c1>// prints same results</span>
<span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;Hello %d\n&quot;</span><span class=p>,</span> <span class=mi>23</span><span class=p>)</span>
<span class=nx>fmt</span><span class=p>.</span><span class=nx>Fprint</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=s>&quot;Hello &quot;</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=s>&quot;\n&quot;</span><span class=p>)</span>
<span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Hello&quot;</span><span class=p>,</span> <span class=mi>23</span><span class=p>)</span>
<span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprint</span><span class=p>(</span><span class=s>&quot;Hello &quot;</span><span class=p>,</span> <span class=mi>23</span><span class=p>))</span>
</code></pre></div> <p>Attach a method such as <code>String</code> to any <em>user-defined type</em> makes it possible for arbitrary values to format themselves automatically for printing</p> <p><br></p> <h3 id=initialization>Initialization<a class=headerlink href=#initialization title="Permanent link">&para;</a></h3> <p>Complex structures can be built during initialization and the ordering issues among initialized objects, even among different packages, are handled correctly</p> <p>Go's <strong>constants</strong> are created at <em>compile time</em> and can only be <code>numbers, characters (runes), strings or booleans</code>; expressions that define them must be constant expressions</p> <p><strong>Variables</strong> can be initialized just like constants but the initializer can be a general expression computed at <em>run time</em></p> <p>Each source file can define its own niladic <code>init</code> function(s) to set up whatever state is required</p> <ul> <li><code>init</code> is called after all the variable declarations in the package have evaluated their initializers</li> <li>evaluated only after all the imported packages have been initialized</li> <li><code>init</code> can also be used to verify or repair correctness of the program state before real execution begins</li> </ul> <p><br></p> <h3 id=methods>Methods<a class=headerlink href=#methods title="Permanent link">&para;</a></h3> <p><strong>Methods</strong> can be defined for any named type (except a pointer or an interface) and the receiver does not have to be a <code>struct</code>.</p> <p>The rule about pointers vs. values for receivers is that value methods can be invoked on pointers and values, but pointer methods can ONLY be invoked on pointers</p> <ul> <li>this rule arises because pointer methods can modify the receiver; invoking them on a value would cause the method to receive a copy of the value, so any modifications would be discarded</li> <li>when the value is addressable, the language takes care of the common case of invoking a pointer method on a value by inserting the address operator automatically</li> </ul> <p>The idea of using <code>Write</code> on a <code>slice</code> of bytes is central to the implementation of <code>bytes.Buffer</code></p> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ByteSlice</span><span class=p>)</span> <span class=nx>Append</span><span class=p>(</span><span class=nx>data</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>slice</span> <span class=o>:=</span> <span class=o>*</span><span class=nx>p</span>
    <span class=c1>// Body same as above Append function, without the return.</span>
    <span class=o>*</span><span class=nx>p</span> <span class=p>=</span> <span class=nx>slice</span>
<span class=p>}</span>
<span class=c1>// implements the io.Write interface</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ByteSlice</span><span class=p>)</span> <span class=nx>Write</span><span class=p>(</span><span class=nx>data</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>slice</span> <span class=o>:=</span> <span class=o>*</span><span class=nx>p</span>
    <span class=c1>// Body same as above Append method</span>
    <span class=o>*</span><span class=nx>p</span> <span class=p>=</span> <span class=nx>slice</span>
    <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=nx>data</span><span class=p>),</span> <span class=kc>nil</span>
<span class=p>}</span>
<span class=kd>var</span> <span class=nx>b</span> <span class=nx>ByteSlice</span>
<span class=nx>fmt</span><span class=p>.</span><span class=nx>Fprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>b</span><span class=p>,</span> <span class=s>&quot;This hour has %d days\n&quot;</span><span class=p>,</span> <span class=mi>7</span><span class=p>)</span> <span class=c1>// because we implemented the Write method</span>
</code></pre></div> <p><br></p> <h3 id=interfaces-and-other-types>Interfaces and other types<a class=headerlink href=#interfaces-and-other-types title="Permanent link">&para;</a></h3> <p><strong>Interfaces</strong> in Go provide a way to specify the behavior of an object: <em>if something can do this, then it can be used here</em>.</p> <ul> <li>a type can implement multiple interfaces<ul> <li>a collection can be sorted by the routines in package <code>sort</code> if it implements <code>sort.Interface</code>, which contains <code>Len(), Less(i, j int) bool, and Swap(i, j int)</code>, and it could also have a <code>custom formatter</code></li> </ul> </li> <li>Interfaces with only one or two methods are common in Go code, and are usually given a name derived from the method</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=nx>Sequence</span> <span class=p>[]</span><span class=kt>int</span>
<span class=c1>// Methods required by sort.Interface.</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>Len</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>Less</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>s</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>&lt;</span> <span class=nx>s</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>Swap</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>s</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>s</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>=</span> <span class=nx>s</span><span class=p>[</span><span class=nx>j</span><span class=p>],</span> <span class=nx>s</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
<span class=p>}</span>
<span class=c1>// Copy returns a copy of the Sequence.</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>Copy</span><span class=p>()</span> <span class=nx>Sequence</span> <span class=p>{</span>
    <span class=nx>copy</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=nx>Sequence</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>s</span><span class=p>))</span>
    <span class=k>return</span> <span class=nb>append</span><span class=p>(</span><span class=nx>copy</span><span class=p>,</span> <span class=nx>s</span><span class=o>...</span><span class=p>)</span>
<span class=p>}</span>
<span class=c1>// Method for printing - sorts the elements before printing.</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
    <span class=nx>s</span> <span class=p>=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Copy</span><span class=p>()</span> <span class=c1>// Make a copy; don&#39;t overwrite argument.</span>
    <span class=nx>sort</span><span class=p>.</span><span class=nx>Sort</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
    <span class=nx>str</span> <span class=o>:=</span> <span class=s>&quot;[&quot;</span>
    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>elem</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>s</span> <span class=p>{</span> <span class=c1>// Loop is O(N²); will fix that in next example.</span>
        <span class=k>if</span> <span class=nx>i</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
            <span class=nx>str</span> <span class=o>+=</span> <span class=s>&quot; &quot;</span>
        <span class=p>}</span>
        <span class=nx>str</span> <span class=o>+=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprint</span><span class=p>(</span><span class=nx>elem</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>str</span> <span class=o>+</span> <span class=s>&quot;]&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>If we convert the <code>Sequence</code> back to <code>[]int</code>, we can call <code>Sprint</code> directly on <code>s</code>. The <strong>conversion</strong> doesn't create a new value, it just temporarily acts as though the existing value has a new type.</p> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Sequence</span><span class=p>)</span> <span class=nx>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
    <span class=nx>s</span> <span class=p>=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Copy</span><span class=p>()</span>
    <span class=nx>sort</span><span class=p>.</span><span class=nx>IntSlice</span><span class=p>(</span><span class=nx>s</span><span class=p>).</span><span class=nx>Sort</span><span class=p>()</span>
    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprint</span><span class=p>([]</span><span class=nb>int</span><span class=p>(</span><span class=nx>s</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div> <p>It's an idiom in Go programs to convert the type of an expression to access a different set of methods.</p> <p><strong>Type switches</strong> are a form of conversion: they take an interface and, for each case in the switch, in a sense convert it to the type of that case.</p> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=nx>Stringer</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nx>String</span><span class=p>()</span> <span class=kt>string</span>
<span class=p>}</span>
<span class=kd>var</span> <span class=nx>value</span> <span class=kd>interface</span><span class=p>{}</span> <span class=c1>// Value provided by caller.</span>
<span class=k>switch</span> <span class=nx>str</span> <span class=o>:=</span> <span class=nx>value</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
<span class=k>case</span> <span class=kt>string</span><span class=p>:</span>
    <span class=k>return</span> <span class=nx>str</span>
<span class=k>case</span> <span class=nx>Stringer</span><span class=p>:</span>
    <span class=k>return</span> <span class=nx>str</span><span class=p>.</span><span class=nx>String</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div> <p>A <strong>type assertion</strong> takes an interface value and extracts from it a value of the specified explicit <em>type</em> and the result is a new value with the static type <code>&lt;typeName&gt;</code></p> <ul> <li>that <em>type</em> must either be the concrete type held by the interface, or a second interface type that the value can be converted to.</li> <li>i.e. <code>str := value.(string)</code><ul> <li>if the value does not contain a string, the program will crash with a run-time error.</li> <li>can guard against it with a "comma, ok" idiom to test</li> <li>if assertion fails, <code>str</code> will still be a string with its zero value</li> </ul> </li> </ul> <div class=highlight><pre><span></span><code><span class=nx>str</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>value</span><span class=p>.(</span><span class=kt>string</span><span class=p>)</span>
<span class=k>if</span> <span class=nx>ok</span> <span class=p>{</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;string value is: %q\n&quot;</span><span class=p>,</span> <span class=nx>str</span><span class=p>)</span>
<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;value is not a string\n&quot;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p>If a type exists only to implement an interface and will never have exported methods beyond that interface, there is no need to export the type itself</p> <ul> <li>its constructor should return an interface value rather than the implementing type<ul> <li>in this way, similar types that implements the same interfaces can be easily replaced for one another by changing the constructor call and the rest of the code is unaffected</li> </ul> </li> </ul> <p>Almost anything can have methods attached, almost anything can satisfy an interface. A simple http handler:</p> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=nx>Counter</span> <span class=kt>int</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>ctr</span> <span class=o>*</span><span class=nx>Counter</span><span class=p>)</span> <span class=nx>ServeHTTP</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
    <span class=o>*</span><span class=nx>ctr</span><span class=o>++</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&quot;counter = %d\n&quot;</span><span class=p>,</span> <span class=o>*</span><span class=nx>ctr</span><span class=p>)</span>
<span class=p>}</span>
<span class=o>...</span>
<span class=kn>import</span> <span class=s>&quot;net/http&quot;</span>
<span class=o>...</span>
<span class=nx>ctr</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Counter</span><span class=p>)</span>
<span class=nx>http</span><span class=p>.</span><span class=nx>Handle</span><span class=p>(</span><span class=s>&quot;/counter&quot;</span><span class=p>,</span> <span class=nx>ctr</span><span class=p>)</span>
</code></pre></div> <p><br></p> <h3 id=the-blank-identifier>The blank identifier<a class=headerlink href=#the-blank-identifier title="Permanent link">&para;</a></h3> <p>It's a bit like writing to the Unix /dev/null file: it represents a write-only value to be used as a place-holder where a variable is needed but the actual value is irrelevant. Some common use cases are</p> <ul> <li>multiple variable assignment as placeholder to take up a variable's value assignment i.e. <code>_, err := os.Stat(path)</code></li> <li>to silence compiler complaints about unused imports or variable assignments that would eventually be used i.e. <code>fd, err := os.Open("test.go"); _ = fd</code></li> <li>to rename a package that is imported only for its side effects i.e. <code>import _ "net/http/pprof"</code></li> <li>to check whether a type implements an interface i.e. <code>if _, ok := val.(json.Marshaler); ok {}</code></li> </ul> <p><br></p> <h3 id=embedding>Embedding<a class=headerlink href=#embedding title="Permanent link">&para;</a></h3> <p>Go allows a type to “borrow” pieces of an implementation by embedding types within a struct or interface</p> <ul> <li>you can directly include other interfaces in a type to form a new type, without specifying all of their methods</li> <li>only interfaces can be embedded within interfaces</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>// ReadWriter is the interface that combines the Reader and Writer interfaces.</span>
<span class=kd>type</span> <span class=nx>ReadWriter</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nx>Reader</span>
    <span class=nx>Writer</span>
<span class=p>}</span>
<span class=c1>// ReadWriter stores pointers to a Reader and a Writer.</span>
<span class=c1>// It implements io.ReadWriter.</span>
<span class=kd>type</span> <span class=nx>ReadWriter</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>reader</span> <span class=o>*</span><span class=nx>Reader</span>  <span class=c1>// *bufio.Reader</span>
    <span class=nx>writer</span> <span class=o>*</span><span class=nx>Writer</span>  <span class=c1>// *bufio.Writer</span>
<span class=p>}</span>
</code></pre></div> <p>When we embed a type, the methods of that type become methods of the outer type, but when they are invoked the receiver of the method is the inner type, not the outer one</p> <p>If we need to refer to an embedded field directly, the type name of the field, ignoring the package qualifier, can be served as a field name</p> <p>If embedding types introduces name conflicts, there are two rules</p> <ul> <li>if an embedded type introduces methods or fields that are defined by the same name at this struct, then the definition at this struct will dominate it (and suppress the conflicting methods/fields introduced by the embedded type)</li> <li>if embedded a type and also defined another type of method with the same name as the embedded type, it is an error unless neither one of them was used</li> </ul> <p><br></p> <h3 id=concurrency>Concurrency<a class=headerlink href=#concurrency title="Permanent link">&para;</a></h3> <blockquote> <p>Do not communicate by sharing memory; instead, share memory by communicating.</p> </blockquote> <p>The goal of concurrency, structuring a program as independently executing components and executing calculations in parallel for efficiency on multiple CPUs</p> <p>In Go, shared values are passed around on channels and never actively shared by separate threads of execution</p> <ul> <li>only one goroutine has access to the value at any given time</li> <li>data races cannot occur, by design</li> </ul> <p>A <strong>goroutine</strong> is a function executing concurrently with other goroutines in the same address space and when the call completes, the goroutine exits silently</p> <ul> <li>it is lightweight, costing little more than the allocation of stack space</li> <li>the stacks start small, cheap, and grow by allocating (and freeing) heap storage as required</li> <li>goroutines are multiplexed onto multiple OS threads so some can block and others can execute</li> </ul> <p><strong>Unbuffered channels</strong> combine communication(the exchange of a value) with synchronization(guaranteeing that the two ends are in a known state)</p> <p>A <strong>buffered channel</strong> can be used like a <em>semaphore</em>, for instance to limit throughput.</p> <p>A common use of channels is to implement safe, parallel demultiplexing by creating "channels of channels".</p> <ul> <li>can be done by creating structs that contains channels and pass struct objects to a channel</li> </ul> <p><br></p> <h3 id=errors>Errors<a class=headerlink href=#errors title="Permanent link">&para;</a></h3> <p>Library routines must often return some sort of error indication to the caller</p> <ul> <li>errors have type error, a simple built-in interface.</li> <li>when successful the error will be nil; when there is a problem, it should hold an error</li> <li>when feasible, error strings should identify their origin, such as by having a prefix naming the operation or package that generated the error</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>type</span> <span class=kt>error</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nx>Error</span><span class=p>()</span> <span class=kt>string</span>
<span class=p>}</span>
</code></pre></div> <p>Caller can use a type switch or a type assertion to look for specific errors and extract details</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=nx>try</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>try</span> <span class=p>&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=nx>try</span><span class=o>++</span> <span class=p>{</span>
    <span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Create</span><span class=p>(</span><span class=nx>filename</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=k>return</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=nx>e</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>err</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>PathError</span><span class=p>);</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>Err</span> <span class=o>==</span> <span class=nx>syscall</span><span class=p>.</span><span class=nx>ENOSPC</span> <span class=p>{</span>
        <span class=c1>// if the err was of type *os.PathError, and then so is e</span>
        <span class=nx>deleteTempFiles</span><span class=p>()</span>  <span class=c1>// Recover some space.</span>
        <span class=k>continue</span>
    <span class=p>}</span>
    <span class=k>return</span>
<span class=p>}</span>
</code></pre></div> <p>If an error is unrecoverable, it will be better to use <code>panic</code> to create a run-time error that will stop the program</p> <ul> <li><code>panic</code> takes a single argument of arbitrary type (often a string) to be printed as the program dies<ul> <li>when <code>panic</code> is called, it immediately stops execution of the current function and begins unwinding the stack of the goroutine, running any deferred functions along the way.</li> <li>if that unwinding reaches the top of the goroutine's stack, the program dies</li> <li>it is possible to use the built-in function <code>recover</code> to regain control of the goroutine and resume normal execution</li> </ul> </li> <li>it's also a way to indicate that something impossible has happened</li> <li>real library functions should avoid using <code>panic</code><ul> <li>it's always better to let things continue to run rather than taking down the whole program</li> <li>one exception is during initialization, if the library truly cannot set itself up, it might be reasonable to panic without further damage</li> </ul> </li> </ul> <p>A call to recover stops the unwinding and returns the argument passed to panic</p> <ul> <li><code>recover</code> is only useful inside <strong>deferred functions</strong> because the only code that runs while undergoing unwinding is inside deferred functions</li> <li>one application of recover is to shut down a failing goroutine inside a server without killing the other executing goroutines</li> <li>deferred code can call library routines that themselves use panic and recover without failing</li> <li>deferred functions can modify named return values</li> </ul> <div class=highlight><pre><span></span><code><span class=kd>func</span> <span class=nx>server</span><span class=p>(</span><span class=nx>workChan</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=o>*</span><span class=nx>Work</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>for</span> <span class=nx>work</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>workChan</span> <span class=p>{</span>
        <span class=k>go</span> <span class=nx>safelyDo</span><span class=p>(</span><span class=nx>work</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=nx>safelyDo</span><span class=p>(</span><span class=nx>work</span> <span class=o>*</span><span class=nx>Work</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
            <span class=nx>log</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;work failed:&quot;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}()</span>
    <span class=nx>do</span><span class=p>(</span><span class=nx>work</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p>A more complete example, with deferred function modifying the named return values</p> <div class=highlight><pre><span></span><code><span class=c1>// Error is the type of a parse error; it satisfies the error interface.</span>
<span class=kd>type</span> <span class=nx>Error</span> <span class=kt>string</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=nx>Error</span><span class=p>)</span> <span class=nx>Error</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nb>string</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span>
<span class=p>}</span>
<span class=c1>// error is a method of *Regexp that reports parsing errors by</span>
<span class=c1>// panicking with an Error.</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>regexp</span> <span class=o>*</span><span class=nx>Regexp</span><span class=p>)</span> <span class=nb>error</span><span class=p>(</span><span class=nx>err</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
    <span class=nb>panic</span><span class=p>(</span><span class=nx>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
<span class=p>}</span>
<span class=c1>// Compile returns a parsed representation of the regular expression.</span>
<span class=kd>func</span> <span class=nx>Compile</span><span class=p>(</span><span class=nx>str</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>regexp</span> <span class=o>*</span><span class=nx>Regexp</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>regexp</span> <span class=p>=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Regexp</span><span class=p>)</span>
    <span class=c1>// doParse will panic if there is a parse error.</span>
    <span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nx>e</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>e</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
            <span class=nx>regexp</span> <span class=p>=</span> <span class=kc>nil</span>    <span class=c1>// Clear return value.</span>
            <span class=nx>err</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.(</span><span class=nx>Error</span><span class=p>)</span> <span class=c1>// Will re-panic if not a parse error.</span>
        <span class=p>}</span>
    <span class=p>}()</span>
    <span class=k>return</span> <span class=nx>regexp</span><span class=p>.</span><span class=nx>doParse</span><span class=p>(</span><span class=nx>str</span><span class=p>),</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div> <p><br></p> <h3 id=web-server>Web Server<a class=headerlink href=#web-server title="Permanent link">&para;</a></h3> <p>An simple example</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nx>main</span>
<span class=kn>import</span> <span class=p>(</span>
    <span class=s>&quot;flag&quot;</span>
    <span class=s>&quot;html/template&quot;</span>
    <span class=s>&quot;log&quot;</span>
    <span class=s>&quot;net/http&quot;</span>
<span class=p>)</span>
<span class=kd>var</span> <span class=nx>addr</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nx>String</span><span class=p>(</span><span class=s>&quot;addr&quot;</span><span class=p>,</span> <span class=s>&quot;:1718&quot;</span><span class=p>,</span> <span class=s>&quot;http service address&quot;</span><span class=p>)</span> <span class=c1>// Q=17, R=18</span>
<span class=kd>var</span> <span class=nx>templ</span> <span class=p>=</span> <span class=nx>template</span><span class=p>.</span><span class=nx>Must</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;qr&quot;</span><span class=p>).</span><span class=nx>Parse</span><span class=p>(</span><span class=nx>templateStr</span><span class=p>))</span>

<span class=kd>func</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>flag</span><span class=p>.</span><span class=nx>Parse</span><span class=p>()</span>
    <span class=nx>http</span><span class=p>.</span><span class=nx>Handle</span><span class=p>(</span><span class=s>&quot;/&quot;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=p>(</span><span class=nx>QR</span><span class=p>))</span>
    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ListenAndServe</span><span class=p>(</span><span class=o>*</span><span class=nx>addr</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nx>log</span><span class=p>.</span><span class=nx>Fatal</span><span class=p>(</span><span class=s>&quot;ListenAndServe:&quot;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=nx>QR</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>templ</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>FormValue</span><span class=p>(</span><span class=s>&quot;s&quot;</span><span class=p>))</span>
<span class=p>}</span>
<span class=kd>const</span> <span class=nx>templateStr</span> <span class=p>=</span> <span class=s>`</span>
<span class=s>&lt;html&gt;</span>
<span class=s>&lt;head&gt;</span>
<span class=s>&lt;title&gt;QR Link Generator&lt;/title&gt;</span>
<span class=s>&lt;/head&gt;</span>
<span class=s>&lt;body&gt;</span>
<span class=s>{{if .}}</span>
<span class=s>&lt;img src=&quot;http://chart.apis.google.com/chart?chs=300x300&amp;cht=qr&amp;choe=UTF-8&amp;chl={{.}}&quot; /&gt;</span>
<span class=s>&lt;br&gt;</span>
<span class=s>{{.}}</span>
<span class=s>&lt;br&gt;</span>
<span class=s>&lt;br&gt;</span>
<span class=s>{{end}}</span>
<span class=s>&lt;form action=&quot;/&quot; name=f method=&quot;GET&quot;&gt;</span>
<span class=s>    &lt;input maxLength=1024 size=70 name=s value=&quot;&quot; title=&quot;Text to QR Encode&quot;&gt;</span>
<span class=s>    &lt;input type=submit value=&quot;Show QR&quot; name=qr&gt;</span>
<span class=s>&lt;/form&gt;</span>
<span class=s>&lt;/body&gt;</span>
<span class=s>&lt;/html&gt;</span>
<span class=s>`</span>
</code></pre></div> <p>The <code>html/template</code> package is very powerful. Documentation to it is <a href=https://golang.org/pkg/html/template/ >here</a></p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../Golang-Specs/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Golang Language Reference </div> </div> </a> <a href=../Freq-Used-Libs/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Go libraries and examples </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.53cc9318.min.js></script> <script src=../../../assets/javascripts/bundle.e9c9f54f.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>